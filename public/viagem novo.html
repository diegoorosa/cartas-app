<!doctype html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <title>Autoriza√ß√£o de Viagem para Menor | Evite ser barrado no embarque</title>

    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" href="/logo.png" />
    <link rel="apple-touch-icon" href="/logo.png" />

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [{
        "@type": "Question",
        "name": "Preciso reconhecer firma da autoriza√ß√£o de viagem?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Sim. Para que a autoriza√ß√£o tenha validade legal no embarque (nacional ou internacional), a assinatura dos respons√°veis deve ter firma reconhecida em cart√≥rio, por autenticidade ou semelhan√ßa."
        }
      }, {
        "@type": "Question",
        "name": "Qual a validade da autoriza√ß√£o de viagem para menor?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Se n√£o houver prazo estipulado no documento, a autoriza√ß√£o √© v√°lida por 2 anos. No entanto, o nosso gerador permite que voc√™ defina as datas exatas de ida e volta, o que √© mais seguro."
        }
      }]
    }
    </script>

    <meta name="description"
        content="Gere a autoriza√ß√£o de viagem oficial (CNJ) para menor desacompanhado. Documento pronto para imprimir e reconhecer firma. Evite problemas no embarque." />
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <script src="/theme.js"></script>
    <link rel="stylesheet" href="/style.css" />

    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-1021062139"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'AW-1021062139');
        gtag('config', 'G-D40QPP9KNP');
    </script>
    <script src="/gtag.js"></script>

    <script type="text/javascript">
        (function (c, l, a, r, i, t, y) { c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) }; t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i; y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y); })(window, document, "clarity", "script", "u4x90t35gk");
    </script>

    <link rel="canonical" href="https://www.cartasapp.com.br/viagem.html" />

    <style>
        .radio-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .radio-card {
            position: relative;
        }

        .radio-card input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .radio-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 16px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            height: 100%;
            min-height: 80px;
        }

        .radio-label:hover {
            background: var(--card-hover);
            border-color: var(--accent-primary);
        }

        .radio-card input[type="radio"]:checked+.radio-label {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
            font-weight: 700;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.2);
        }

        .radio-icon {
            font-size: 24px;
            margin-bottom: 8px;
            display: block;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 20px;
        }

        .steps-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 32px 0;
            padding: 24px;
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 2px solid var(--border);
        }

        .step-box {
            text-align: center;
            padding: 16px;
        }

        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: var(--accent-primary);
            color: white;
            border-radius: 50%;
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 12px;
        }

        .testimonial-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .testimonial-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .testimonial-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .testimonial-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .testimonial-location {
            font-size: 12px;
            color: var(--text-muted);
        }

        .testimonial-stars {
            color: #fbbf24;
            font-size: 14px;
        }

        .testimonial-text {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
            margin: 0;
        }

        .info-tooltip {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: var(--accent-primary);
            color: white;
            border-radius: 50%;
            text-align: center;
            font-size: 11px;
            font-weight: bold;
            cursor: help;
            line-height: 16px;
        }

        @media (max-width: 768px) {
            .steps-container {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }

        @media (max-width: 480px) {
            .radio-group.full-mobile {
                grid-template-columns: 1fr;
            }

            .input-row {
                grid-template-columns: 1fr !important;
                gap: 12px;
                margin-top: 12px;
            }
        }

        /* WhatsApp menor no mobile */
        @media (max-width: 768px) {
            .whatsapp-float {
                width: 50px !important;
                height: 50px !important;
                bottom: 15px !important;
                right: 15px !important;
            }

            .whatsapp-icon {
                width: 26px !important;
                height: 26px !important;
            }
        }
    </style>
</head>

<body>
    <nav class="navbar" style="box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
        <div class="container">
            <div class="navbar-content"
                style="display: flex; justify-content: space-between; align-items: center; height: 60px;">
                <a href="/" class="logo" style="display: flex; align-items: center; gap: 10px; text-decoration: none;">
                    <img src="/logo.png" alt="CartasApp" style="height: 42px; width: auto;"
                        onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <span
                        style="font-weight: 800; font-size: 20px; color: var(--text-primary); letter-spacing: -0.5px;">CartasApp</span>
                </a>
                <div class="nav-actions">
                    <button class="btn-theme" onclick="toggleTheme()" aria-label="Alternar tema"
                        style="background: transparent; border: 1px solid var(--border); color: var(--text-primary); width: 38px; height: 38px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s;">üåô</button>
                </div>
            </div>
        </div>
    </nav>

    <section class="hero" style="padding: 40px 0 20px;">
        <div class="container">
            <div class="hero-content">
                <div class="hero-badge"
                    style="background: #dbeafe; color: #1e40af; border: 1px solid #93c5fd; font-weight: bold;">
                    üìã Conforme Resolu√ß√£o CNJ n¬∫ 295/2019
                </div>

                <h1
                    style="font-size: 36px; line-height: 1.2; font-weight: 800; color: var(--text-primary); margin-top: 16px;">
                    Gere o modelo de Autoriza√ß√£o de Viagem para Menor
                </h1>

                <p class="hero-subtitle"
                    style="font-size: 18px; margin-top: 16px; line-height: 1.5; color: var(--text-secondary);">
                    Preencha em 2 minutos, veja a <strong>pr√©via gr√°tis</strong>, baixe o PDF e leve ao cart√≥rio para
                    reconhecer firma quando exigido.
                </p>

                <div class="steps-container">
                    <div class="step-box">
                        <div class="step-number">1</div>
                        <strong style="display: block; margin-bottom: 4px;">Preencha</strong>
                        <span style="font-size: 14px; color: var(--text-muted);">Leva 2 minutos</span>
                    </div>
                    <div class="step-box">
                        <div class="step-number">2</div>
                        <strong style="display: block; margin-bottom: 4px;">Baixe o PDF</strong>
                        <span style="font-size: 14px; color: var(--text-muted);">Veja pr√©via gr√°tis</span>
                    </div>
                    <div class="step-box">
                        <div class="step-number">3</div>
                        <strong style="display: block; margin-bottom: 4px;">Assine</strong>
                        <span style="font-size: 14px; color: var(--text-muted);">Reconhe√ßa firma se necess√°rio</span>
                    </div>
                </div>

                <div class="hero-actions" style="margin-top: 24px;">
                    <a href="#formArea" class="btn btn-primary" onclick="scrollToForm(event)"
                        style="font-size: 18px; padding: 14px 32px;">
                        GERAR AUTORIZA√á√ÉO AGORA
                    </a>
                </div>

                <p class="small" style="margin-top: 12px; color: var(--text-muted); font-size: 14px;">
                    ‚ö° Documento pronto em 2 minutos ‚Ä¢ <strong>Apenas R$ 9,90</strong>
                </p>

                <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px; flex-wrap: wrap;">
                    <span
                        style="background: rgba(16, 185, 129, 0.1); color: #10b981; padding: 6px 12px; border-radius: 6px; font-size: 13px; font-weight: 600;">
                        üîí Dados Protegidos (LGPD)
                    </span>
                    <span
                        style="background: rgba(59, 130, 246, 0.1); color: #3b82f6; padding: 6px 12px; border-radius: 6px; font-size: 13px; font-weight: 600;">
                        ‚úÖ Mais de 50 autoriza√ß√µes geradas
                    </span>
                    <span
                        style="background: rgba(139, 92, 246, 0.1); color: #8b5cf6; padding: 6px 12px; border-radius: 6px; font-size: 13px; font-weight: 600;">
                        üíØ Garantia de reembolso
                    </span>
                </div>
            </div>
        </div>
    </section>

    <section class="section" style="padding-top: 0;">
        <div class="container">
            <div style="max-width: 800px; margin: 0 auto;">

                <!-- Depoimentos -->
                <div style="margin-bottom: 32px;">
                    <h2 style="text-align: center; font-size: 24px; margin-bottom: 20px; color: var(--text-primary);">
                        ‚≠ê O que dizem quem j√° usou
                    </h2>

                    <div class="testimonial-box">
                        <div class="testimonial-header">
                            <div class="testimonial-avatar">M</div>
                            <div>
                                <div class="testimonial-name">Mariana S.</div>
                                <div class="testimonial-location">S√£o Paulo/SP</div>
                            </div>
                            <div style="margin-left: auto;" class="testimonial-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        </div>
                        <p class="testimonial-text">"Precisava da autoriza√ß√£o pra minha filha viajar com a av√≥. Achei
                            que ia ser mais complicado, mas foi super r√°pido. Levei no cart√≥rio e foi aceito na
                            rodovi√°ria sem problema!"</p>
                    </div>

                    <div class="testimonial-box">
                        <div class="testimonial-header">
                            <div class="testimonial-avatar">R</div>
                            <div>
                                <div class="testimonial-name">Roberto C.</div>
                                <div class="testimonial-location">Curitiba/PR</div>
                            </div>
                            <div style="margin-left: auto;" class="testimonial-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        </div>
                        <p class="testimonial-text">"Meu filho foi viajar com a m√£e pro Nordeste e eu precisava
                            autorizar. Fiz tudo online, imprimi, assinei e reconheci firma. Perfeito, economizei tempo e
                            dinheiro."</p>
                    </div>

                    <div class="testimonial-box">
                        <div class="testimonial-header">
                            <div class="testimonial-avatar">J</div>
                            <div>
                                <div class="testimonial-name">Juliana P.</div>
                                <div class="testimonial-location">Florian√≥polis/SC</div>
                            </div>
                            <div style="margin-left: auto;" class="testimonial-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        </div>
                        <p class="testimonial-text">"Estava com medo de n√£o ser aceito, mas o documento est√° certinho
                            conforme a lei. A empresa a√©rea nem questionou. Recomendo!"</p>
                    </div>
                </div>

                <div class="card">
                    <div
                        style="background: #fff3cd; border: 1px solid #ffc107; padding: 16px; border-radius: 12px; margin-bottom: 24px;">
                        <p style="margin: 0; font-size: 14px; color: #856404; line-height: 1.5;">
                            <strong>üí° Voc√™ vai ao cart√≥rio apenas para reconhecer assinatura</strong><br>
                            O CartasApp gera o texto completo e preenchido conforme a Resolu√ß√£o CNJ. Voc√™ economiza
                            tempo e evita pagar escritura p√∫blica. Basta imprimir, assinar e levar ao cart√≥rio para
                            reconhecer firma quando for exigido pela companhia de transporte.
                        </p>
                    </div>

                    <div id="formArea">
                        <div
                            style="display: flex; gap: 15px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap;">
                            <div
                                style="display: flex; align-items: center; gap: 6px; font-size: 13px; color: #059669; background: #d1fae5; padding: 6px 12px; border-radius: 20px;">
                                üîí Dados Criptografados</div>
                            <div
                                style="display: flex; align-items: center; gap: 6px; font-size: 13px; color: #2563eb; background: #dbeafe; padding: 6px 12px; border-radius: 20px;">
                                ‚úÖ Modelo CNJ 295/2019</div>
                            <div
                                style="display: flex; align-items: center; gap: 6px; font-size: 13px; color: #7c3aed; background: #ede9fe; padding: 6px 12px; border-radius: 20px;">
                                üîÑ Pr√©via Gr√°tis</div>
                        </div>

                        <div class="step-indicator">
                            <div class="step-item" data-step="1">1. Menor e viagem</div>
                            <div class="step-item" data-step="2">2. Acompanhante</div>
                            <div class="step-item" data-step="3">3. Respons√°veis</div>
                            <div class="step-item" data-step="4">4. Local e contatos</div>
                        </div>

                        <div class="form-step" data-step="1" id="step-1">
                            <div
                                style="background-color: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px; padding: 12px; margin-bottom: 24px; display: flex; align-items: start; gap: 10px;">
                                <span style="font-size: 18px; margin-top: 2px;">üîê</span>
                                <p style="margin: 0; font-size: 14px; color: #0284c7; line-height: 1.4;">
                                    <strong>Privacidade:</strong> Seus dados s√£o usados apenas para gerar o documento.
                                    Voc√™ pode solicitar exclus√£o a qualquer momento pelo e-mail contato@cartasapp.com.br
                                </p>
                            </div>

                            <h2 class="section-title" style="font-size: 20px; margin-bottom: 12px;">Para onde √© a
                                viagem?</h2>

                            <select id="viagem_tipo" style="display:none">
                                <option value="nacional" selected>Nacional</option>
                                <option value="internacional">Internacional</option>
                            </select>

                            <div class="radio-group">
                                <div class="radio-card">
                                    <input type="radio" name="viagem_visual" id="v_nacional" value="nacional" checked
                                        onchange="updateViagem(this.value)">
                                    <label for="v_nacional" class="radio-label"><span
                                            class="radio-icon">üáßüá∑</span>Viagem Nacional</label>
                                </div>
                                <div class="radio-card">
                                    <input type="radio" name="viagem_visual" id="v_internacional" value="internacional"
                                        onchange="updateViagem(this.value)">
                                    <label for="v_internacional" class="radio-label"><span
                                            class="radio-icon">‚úàÔ∏è</span>Internacional</label>
                                </div>
                            </div>
                            <p id="viagem_tipo_aviso" class="small"
                                style="margin-top:-10px; margin-bottom: 24px; color:var(--text-muted);"></p>

                            <h2 class="section-title" style="font-size: 20px; margin-bottom: 16px;">Quem vai viajar?
                                (Crian√ßa/Adolescente)</h2>
                            <label class="label">Nome completo <span class="required-star">*</span></label>
                            <input class="input" id="menor_nome" placeholder="Ex.: Ana Souza" />

                            <div class="input-row">
                                <div>
                                    <label class="label">
                                        Nascimento <span class="required-star">*</span>
                                        <span class="info-tooltip"
                                            title="Usamos para calcular a idade e verificar se precisa de autoriza√ß√£o">?</span>
                                    </label>
                                    <input class="input" type="date" id="menor_nascimento" required />
                                    <div id="err_menor_nascimento" class="small"
                                        style="display:none;color:#fca5a5;margin-top:4px;">Data inv√°lida.</div>
                                </div>
                                <div>
                                    <label class="label">
                                        Documento (Opcional)
                                        <span class="info-tooltip"
                                            title="RG, Certid√£o ou Passaporte que ser√° usado no embarque">?</span>
                                    </label>
                                    <input class="input" id="menor_doc" placeholder="RG ou Certid√£o" />
                                </div>
                            </div>

                            <h2 class="section-title" style="font-size: 20px; margin: 24px 0 16px;">Detalhes do Destino
                            </h2>
                            <label class="label">Cidade de Destino <span class="required-star">*</span></label>
                            <input class="input" id="destino" list="lista_cidades"
                                placeholder="Ex.: S√£o Paulo/SP ou Orlando/EUA" autocomplete="off" />

                            <div class="input-row">
                                <div>
                                    <label class="label">Data de ida <span class="required-star">*</span></label>
                                    <input class="input" type="date" id="data_ida" required />
                                    <div id="err_data_ida" class="small"
                                        style="display:none;color:#fca5a5;margin-top:4px;">Data inv√°lida.</div>
                                </div>
                                <div>
                                    <label class="label">Data de volta <span class="required-star">*</span></label>
                                    <input class="input" type="date" id="data_volta" required />
                                    <div id="err_data_volta" class="small"
                                        style="display:none;color:#fca5a5;margin-top:4px;">Data inv√°lida.</div>
                                </div>
                            </div>

                            <div class="form-navigation">
                                <button type="button" class="btn btn-primary" id="nextStep1"
                                    style="width:100%;">Continuar para o Acompanhante ‚Üí</button>
                            </div>
                        </div>

                        <div class="form-step" data-step="2" id="step-2">
                            <h2 class="section-title" style="font-size: 24px; margin-bottom: 16px;">Com quem a crian√ßa
                                vai viajar?</h2>

                            <select id="acompanhante_tipo" style="display:none">
                                <option value="outro_responsavel">A M√£e / O Pai</option>
                                <option value="terceiro">Parente / Terceiro</option>
                                <option value="desacompanhado">Sozinho (Desacompanhado)</option>
                            </select>

                            <div class="radio-group full-mobile">
                                <div class="radio-card">
                                    <input type="radio" name="acomp_visual" id="opt_resp" value="outro_responsavel"
                                        onchange="updateAcompVisibility(this.value)">
                                    <label for="opt_resp" class="radio-label">
                                        <span class="radio-icon">üë®‚Äçüë©‚Äçüëß</span>
                                        Com o Pai ou M√£e<br><span style="font-size:12px; font-weight:normal;">(O outro
                                            assina)</span>
                                    </label>
                                </div>
                                <div class="radio-card">
                                    <input type="radio" name="acomp_visual" id="opt_terceiro" value="terceiro"
                                        onchange="updateAcompVisibility(this.value)">
                                    <label for="opt_terceiro" class="radio-label">
                                        <span class="radio-icon">üëµ</span>
                                        Av√≥s / Tios / Outros<br><span style="font-size:12px; font-weight:normal;">(Pai e
                                            M√£e assinam)</span>
                                    </label>
                                </div>
                                <div class="radio-card" style="grid-column: span 2;">
                                    <input type="radio" name="acomp_visual" id="opt_sozinho" value="desacompanhado"
                                        onchange="updateAcompVisibility(this.value)">
                                    <label for="opt_sozinho" class="radio-label">
                                        <span class="radio-icon">üôã‚Äç‚ôÇÔ∏è</span>
                                        Viajar Sozinho<br><span
                                            style="font-size:12px; font-weight:normal;">(Desacompanhado)</span>
                                    </label>
                                </div>
                            </div>

                            <div id="acompanhanteBox"
                                style="margin-top:20px; background: var(--bg-secondary); padding: 16px; border-radius: 12px; display:none;">
                                <h3 style="font-size: 16px; margin-bottom: 12px;">Dados do Acompanhante</h3>
                                <label class="label">Nome completo <span class="required-star">*</span></label>
                                <input class="input" id="acomp_nome" placeholder="Ex.: Maria Souza" />
                                <label class="label">Parentesco <span class="required-star">*</span></label>
                                <input class="input" id="acomp_parentesco" placeholder="Ex.: Av√≥, Tia, Irm√£o" />
                                <label class="label">CPF (Opcional)</label>
                                <input class="input" id="acomp_cpf" placeholder="000.000.000-00" inputmode="numeric"
                                    maxlength="14" />
                                <div id="err_acomp_cpf" class="small"
                                    style="display:none;color:#fca5a5;margin-top:4px;">CPF inv√°lido.</div>
                                <label class="label">RG/Documento (Opcional)</label>
                                <input class="input" id="acomp_doc" placeholder="RG do acompanhante" />
                            </div>

                            <div class="form-navigation">
                                <button type="button" class="btn btn-secondary" id="prevStep2">Voltar</button>
                                <button type="button" class="btn btn-primary" id="nextStep2">Pr√≥ximo Passo ‚Üí</button>
                            </div>
                        </div>

                        <div class="form-step" data-step="3" id="step-3">
                            <h2 class="section-title" style="font-size: 24px; margin-bottom: 16px;">Quem est√°
                                autorizando?</h2>

                            <div class="radio-group full-mobile">
                                <div class="radio-card">
                                    <input type="radio" name="resps_visual" id="um_resp" value="1" checked
                                        onchange="toggleResps(1)">
                                    <label for="um_resp" class="radio-label">
                                        <span class="radio-icon">üë§</span>
                                        Apenas 1 Respons√°vel<br><span style="font-size:12px; font-weight:normal;">(Ex:
                                            Viagem com o outro pai)</span>
                                    </label>
                                </div>
                                <div class="radio-card">
                                    <input type="radio" name="resps_visual" id="dois_resps_visual" value="2"
                                        onchange="toggleResps(2)">
                                    <label for="dois_resps_visual" class="radio-label">
                                        <span class="radio-icon">üë•</span>
                                        Pai e M√£e (Ambos)<br><span style="font-size:12px; font-weight:normal;">(Ou dois
                                            guardi√µes)</span>
                                    </label>
                                </div>
                            </div>
                            <input type="checkbox" id="dois_resps" style="display:none">

                            <div
                                style="margin-top:20px; background: var(--bg-secondary); padding: 16px; border-radius: 12px;">
                                <h3 style="font-size: 18px; margin-bottom: 12px; color: var(--accent-primary);">
                                    Respons√°vel 1</h3>
                                <label class="label">Nome completo <span class="required-star">*</span></label>
                                <input class="input" id="resp1_nome" placeholder="Ex.: Jo√£o Souza" />

                                <div class="input-row">
                                    <div>
                                        <label class="label">Parentesco <span class="required-star">*</span></label>
                                        <select class="input" id="resp1_parentesco">
                                            <option>Pai</option>
                                            <option>M√£e</option>
                                            <option>Respons√°vel legal</option>
                                            <option>Tutor(a)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="label">
                                            CPF (Opcional)
                                            <span class="info-tooltip"
                                                title="Usado para identifica√ß√£o no documento. Pode preencher √† m√£o depois">?</span>
                                        </label>
                                        <input class="input" id="resp1_cpf" placeholder="000.000.000-00"
                                            inputmode="numeric" maxlength="14" />
                                        <div id="err_resp1_cpf" class="small"
                                            style="display:none;color:#fca5a5;margin-top:4px;">CPF inv√°lido.</div>
                                    </div>
                                </div>
                                <label class="label">RG/Documento (Opcional)</label>
                                <input class="input" id="resp1_doc" placeholder="RG ou CNH (S√≥ n√∫meros)" />
                            </div>

                            <div id="resp2Box"
                                style="margin-top:20px; background: var(--bg-secondary); padding: 16px; border-radius: 12px; display:none;">
                                <h3 style="font-size: 18px; margin-bottom: 12px; color: var(--accent-primary);">
                                    Respons√°vel 2</h3>
                                <label class="label">Nome completo <span class="required-star">*</span></label>
                                <input class="input" id="resp2_nome" placeholder="Ex.: Maria Souza" />

                                <div class="input-row">
                                    <div>
                                        <label class="label">Parentesco</label>
                                        <select class="input" id="resp2_parentesco">
                                            <option>M√£e</option>
                                            <option>Pai</option>
                                            <option>Respons√°vel legal</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="label">CPF (Opcional)</label>
                                        <input class="input" id="resp2_cpf" placeholder="000.000.000-00"
                                            inputmode="numeric" maxlength="14" />
                                        <div id="err_resp2_cpf" class="small"
                                            style="display:none;color:#fca5a5;margin-top:4px;">CPF inv√°lido.</div>
                                    </div>
                                </div>
                                <label class="label">RG/Documento (Opcional)</label>
                                <input class="input" id="resp2_doc" placeholder="RG ou CNH" />
                            </div>

                            <div class="form-navigation">
                                <button type="button" class="btn btn-secondary" id="prevStep3">Voltar</button>
                                <button type="button" class="btn btn-primary" id="nextStep3">Pr√≥ximo Passo ‚Üí</button>
                            </div>
                        </div>

                        <div class="form-step" data-step="4" id="step-4">
                            <h2 class="section-title" style="font-size: 24px; margin-bottom: 16px;">Local e Contato</h2>
                            <label class="label">Onde voc√™ vai assinar? (Cidade/Estado) <span
                                    class="required-star">*</span></label>
                            <input class="input" id="cidade_uf_emissao" list="lista_cidades"
                                placeholder="Digite sua cidade..." autocomplete="off">
                            <datalist id="lista_cidades"></datalist>

                            <div class="input-row">
                                <div>
                                    <label class="label">Seu WhatsApp (Opcional)</label>
                                    <input class="input" id="telefone" placeholder="(DD) 99999-9999" type="tel"
                                        inputmode="numeric" maxlength="15" onkeyup="mascaraTelefone(this)" />
                                </div>
                                <div>
                                    <label class="label">Seu E-mail (Opcional)</label>
                                    <input class="input" id="email" placeholder="Para receber o PDF" type="email" />
                                </div>
                            </div>
                            <p class="small" style="margin-top:12px;">Seus dados de contato s√£o usados apenas para
                                enviar o backup do documento. <a href="/termos.html" target="_blank"
                                    style="color: var(--accent-primary);">Ver pol√≠tica de privacidade</a></p>

                            <div class="form-navigation">
                                <button type="button" class="btn btn-secondary" id="prevStep4">Voltar</button>
                                <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:flex-end;">
                                    <button class="btn btn-primary" id="btnPreview"
                                        style="background-color: #28a745; border-color: #28a745; font-size: 1.1em; padding: 12px 24px;">üìÑ
                                        Ver Pr√©via Gratuita</button>
                                </div>
                            </div>

                            <div id="paySection"
                                style="display:none; margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border);">
                                <input type="hidden" id="terms_version" value="viagem-2025-02-v1">
                                <div class="price-badge" style="margin-bottom: 20px;">
                                    <span class="price-new">R$ 9,90</span> <span
                                        style="font-size: 14px; color: var(--text-muted);">pagamento √∫nico</span>
                                </div>
                                <button class="btn btn-primary" id="btnPagar" style="width: 100%;">Gerar documento
                                    completo (R$ 9,90)</button>
                                <div class="guarantee-badge">
                                    <span class="guarantee-icon">üîí</span>
                                    <div><strong>Garantia de reembolso:</strong> Se n√£o ficar satisfeito, devolvemos seu
                                        dinheiro sem complica√ß√£o. Suporte: contato@cartasapp.com.br</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="previewWrap"
                    style="display:none; margin-top:32px; padding-top:32px; border-top:1px dashed var(--border);">
                    <div style="display:flex; align-items:center; gap:10px; margin-bottom: 16px;">
                        <span style="font-size: 24px;">üëÄ</span>
                        <h2 class="section-title" style="margin:0; font-size: 22px; color: var(--text-primary);">Confira
                            abaixo como ficou:</h2>
                    </div>
                    <div
                        style="background:#f8fafc; border:2px solid #e2e8f0; border-radius:12px; padding:24px; position:relative;">
                        <div
                            style="position:absolute; top:10px; right:10px; background:#e2e8f0; color:#64748b; padding:4px 8px; font-size:10px; border-radius:4px; font-weight:bold; text-transform:uppercase;">
                            Pr√©via</div>
                        <div id="previewBox"
                            style="white-space:pre-wrap; font-family:'Courier New', Courier, monospace; font-size:14px; line-height:1.6; color:#334155;">
                        </div>
                    </div>
                    <div
                        style="background-color: #fffbeb; color: #92400e; padding: 16px; border-radius: 8px; margin-top: 16px; font-size: 14px; border: 1px solid #fcd34d; display:flex; gap:12px; align-items:start;">
                        <span style="font-size: 18px;">üîí</span>
                        <div><strong>Esta √© uma visualiza√ß√£o parcial.</strong><br>O documento final (completo, sem
                            cortes e pronto para imprimir em PDF/Word) ser√° liberado imediatamente ap√≥s a confirma√ß√£o do
                            pagamento acima.</div>
                    </div>
                </div>

                <div style="margin-top:32px; padding-top:24px; border-top:1px solid var(--border);">
                    <div
                        style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                        <p class="small" style="margin: 0; color: var(--text-secondary);">
                            <strong>Documentos aceitos para embarque (em regra):</strong><br>
                            ‚Ä¢ Crian√ßa (Nacional): Certid√£o de Nascimento ou RG.<br>
                            ‚Ä¢ Crian√ßa (Internacional): Passaporte (ou RG para Mercosul).<br>
                            ‚Ä¢ Adultos: RG, CNH, Passaporte ou Carteira de Trabalho.<br>
                            <span style="opacity:.8;">As exig√™ncias podem variar conforme a companhia de transporte
                                e as autoridades do pa√≠s de destino.</span>
                        </p>
                    </div>

                    <div class="small legal-note" style="margin-bottom: 16px;">
                        <p class="small" style="margin: 0;">
                            ‚Ä¢ Texto elaborado com base na <strong>Resolu√ß√£o CNJ n¬∫ 295/2019</strong> e nas
                            exig√™ncias da
                            <strong>Pol√≠cia Federal</strong> (modelo de uso geral, que n√£o substitui orienta√ß√£o
                            jur√≠dica
                            individual).<br>
                            ‚Ä¢ Serve para viagens <strong>nacionais e internacionais</strong>, com um dos pais,
                            terceiros
                            ou desacompanhado, desde que respeitadas as regras espec√≠ficas de cada √≥rg√£o.<br>
                            ‚Ä¢ Documento em <strong>PDF e Word</strong>, pronto para imprimir, assinar e reconhecer
                            firma
                            em cart√≥rio.
                        </p>
                    </div>

                    <div class="small"
                        style="margin-bottom: 24px; padding: 12px 14px; border-radius: 10px; background: var(--card-hover); border: 1px solid var(--border);">
                        <strong>Por R$ 9,90 (pagamento √∫nico)</strong>, voc√™ recebe:<br>
                        ‚Ä¢ Autoriza√ß√£o personalizada com os seus dados.<br>
                        ‚Ä¢ Arquivos em PDF e Word para editar, imprimir e assinar.<br>
                        ‚Ä¢ Suporte por WhatsApp/e-mail em caso de d√∫vidas sobre o uso do modelo.
                    </div>
                </div>

                <div style="margin-top:32px;border-top:1px solid var(--border);padding-top:24px;">
                    <h2 class="section-title" style="font-size: 22px; margin-bottom: 12px;">
                        ‚ùì Perguntas frequentes
                    </h2>

                    <p class="small">
                        <strong>Preciso ir ao cart√≥rio depois de gerar?</strong><br>
                        Sim. O CartasApp entrega o documento pronto (redigido e formatado). Voc√™ deve imprimir e
                        levar ao cart√≥rio apenas para <strong>reconhecer a firma</strong> da sua assinatura. Esse
                        "selo" do cart√≥rio √© o que garante a validade legal para o embarque em viagens
                        interestaduais ou internacionais.
                    </p>

                    <p class="small" style="margin-top:12px;">
                        <strong>Quantas vias (c√≥pias) devo imprimir?</strong><br>
                        Na pr√°tica, recomenda-se ter <strong>2 vias originais</strong>.
                        <br>‚Ä¢ <strong>1¬™ Via:</strong> Fica retida com a companhia de transporte no momento do
                        embarque (arquivo deles).
                        <br>‚Ä¢ <strong>2¬™ Via:</strong> Segue viagem com a crian√ßa/acompanhante para servir de
                        documento de porte obrigat√≥rio (para fiscaliza√ß√£o policial ou retorno).
                    </p>

                    <p class="small" style="margin-top:12px;">
                        <strong>Este modelo √© aceito pela Pol√≠cia Federal?</strong><br>
                        O texto √© elaborado com base na <strong>Resolu√ß√£o CNJ n¬∫ 295/2019</strong> e nas orienta√ß√µes
                        divulgadas pela Pol√≠cia Federal. Na pr√°tica, costuma ser aceito quando apresentado
                        <strong>impresso, em duas vias e com firmas reconhecidas</strong>. Por√©m, a aceita√ß√£o final
                        cabe sempre √† autoridade do embarque.
                    </p>

                    <p class="small" style="margin-top:12px;">
                        <strong>Por que os dados de CPF e documento s√£o opcionais?</strong><br>
                        Voc√™ pode deix√°-los em branco e preencher √† caneta no documento impresso antes de reconhecer
                        firma. Isso d√° flexibilidade caso n√£o tenha os documentos em m√£os no momento do preenchimento.
                    </p>

                    <p class="small" style="margin-top:12px;">
                        <strong>Como funciona o reembolso?</strong><br>
                        Se voc√™ n√£o ficar satisfeito com o documento gerado ou houver algum problema, entre em contato
                        pelo e-mail contato@cartasapp.com.br ou WhatsApp e faremos o reembolso sem complica√ß√£o.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p>
                    Este site n√£o presta aconselhamento jur√≠dico. Leia os
                    <a href="/termos.html" class="footer-link">Termos de Uso</a> e
                    <a href="/termos.html" class="footer-link">Pol√≠tica de Privacidade</a>.
                    <br>
                    <strong>Suporte:</strong> contato@cartasapp.com.br | WhatsApp dispon√≠vel durante hor√°rio comercial
                </p>
            </div>
        </div>
    </footer>

    <a href="https://wa.me/5547988616874?text=Ol%C3%A1!%20Preciso%20de%20ajuda%20com%20a%20Autoriza%C3%A7%C3%A3o%20de%20Viagem."
        class="whatsapp-float" target="_blank" aria-label="Falar no WhatsApp">
        <svg viewBox="0 0 24 24" class="whatsapp-icon">
            <path
                d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z" />
        </svg>
    </a>

    <div id="modalTermos"
        style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:99999; align-items:center; justify-content:center; padding:20px; backdrop-filter: blur(4px);">
        <div
            style="background:var(--bg-primary); border:1px solid var(--border); border-radius:16px; max-width:500px; width:100%; padding:24px; position:relative; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);">
            <h3 style="margin-top:0; font-size:20px; color:var(--text-primary);">‚ö†Ô∏è Aviso Importante</h3>
            <div
                style="max-height:300px; overflow-y:auto; margin:16px 0; font-size:14px; color:var(--text-secondary); line-height:1.5; padding-right:8px;">
                <p style="margin-bottom:10px;">Para prosseguir e gerar o documento, voc√™ precisa estar ciente de que:
                </p>
                <ul style="padding-left:18px; margin:0;">
                    <li style="margin-bottom:8px;">o CartasApp fornece apenas um <strong>modelo de autoriza√ß√£o de
                            viagem</strong>, preenchido com os dados informados por voc√™. N√£o fazemos an√°lise jur√≠dica
                        do seu caso;</li>
                    <li style="margin-bottom:8px;">a <strong>aceita√ß√£o do documento</strong> e a autoriza√ß√£o de embarque
                        <strong>dependem exclusivamente</strong> da Pol√≠cia Federal, das empresas de transporte, dos
                        cart√≥rios e, em viagens internacionais, tamb√©m de consulados e autoridades do pa√≠s de destino;
                    </li>
                    <li style="margin-bottom:8px;">para viagens internacionais podem ser exigidos documentos adicionais
                        (passaporte v√°lido, autoriza√ß√£o de ambos os pais, tradu√ß√£o, autoriza√ß√£o judicial etc.), conforme
                        o caso;</li>
                    <li>o servi√ßo n√£o inclui reconhecimento de firma em cart√≥rio (que deve ser feito presencialmente
                        pelos respons√°veis).</li>
                </ul>
            </div>
            <label class="small"
                style="display:flex; align-items:flex-start; gap:10px; cursor:pointer; background:var(--bg-secondary); padding:12px; border-radius:8px; border:1px solid var(--border);">
                <input type="checkbox" id="aceite_termos"
                    style="margin-top:2px; min-width:20px; min-height:20px; cursor:pointer;" />
                <span style="font-weight:600; color:var(--text-primary); line-height: 1.4;">
                    Li, compreendi e concordo com as informa√ß√µes acima e com os
                    <a href="/termos.html" target="_blank" style="color:#3b82f6; text-decoration:underline;">Termos de
                        Uso</a>.
                </span>
            </label>
            <div style="display:flex; gap:10px; margin-top:20px;">
                <button id="btnCancelarTermos" class="btn btn-secondary" style="flex:1;">Cancelar</button>
                <button id="btnConfirmarTermos" class="btn btn-primary" style="flex:1;">Confirmar e Pagar</button>
            </div>
        </div>
    </div>

    <script src="/utm.js"></script>
    <script src="/recovery.js"></script>

    <script>
        // ========== FUN√á√ïES UTILIT√ÅRIAS ==========
        function scrollToForm(e) {
            e.preventDefault();
            const formArea = document.getElementById('formArea');
            if (formArea) { formArea.scrollIntoView({ behavior: 'smooth', block: 'start' }); }
        }

        function maskCPF(v) {
            v = (v || '').replace(/\D/g, '').slice(0, 11);
            v = v.replace(/(\d{3})(\d)/, '$1.$2');
            v = v.replace(/(\d{3})(\d)/, '$1.$2');
            v = v.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            return v;
        }

        function isValidCPF(cpf) {
            var s = (cpf || '').replace(/\D/g, '');
            if (s.length !== 11) return false;
            if (/^(\d)\1{10}$/.test(s)) return false;
            var i, sum = 0, rest;
            for (i = 1; i <= 9; i++) sum += parseInt(s.substring(i - 1, i)) * (11 - i);
            rest = (sum * 10) % 11;
            if (rest === 10 || rest === 11) rest = 0;
            if (rest !== parseInt(s.substring(9, 10))) return false;
            sum = 0;
            for (i = 1; i <= 10; i++) sum += parseInt(s.substring(i - 1, i)) * (12 - i);
            rest = (sum * 10) % 11;
            if (rest === 10 || rest === 11) rest = 0;
            if (rest !== parseInt(s.substring(10, 11))) return false;
            return true;
        }

        function mascaraTelefone(input) {
            var v = input.value.replace(/\D/g, "");
            v = v.replace(/^(\d\d)(\d)/g, "($1) $2");
            v = v.replace(/(\d{5})(\d)/, "$1-$2");
            input.value = v.substring(0, 15);
        }

        function formatDateBR(dateVal) {
            if (!dateVal) return '';
            if (dateVal.includes('/')) return dateVal;
            const parts = dateVal.split('-');
            if (parts.length === 3) return `${parts[2]}/${parts[1]}/${parts[0]}`;
            return dateVal;
        }

        function dateToISO(s) {
            if (!s) return '';
            if (s.includes('-')) return s;
            var d = s.substr(0, 2), m = s.substr(3, 2), y = s.substr(6, 4);
            return y + '-' + m + '-' + d;
        }

        function isValidDateBR(s) {
            if (!/^\d{2}\/\d{2}\/\d{4}$/.test(s || '')) return false;
            var d = parseInt(s.substr(0, 2), 10),
                m = parseInt(s.substr(3, 2), 10),
                y = parseInt(s.substr(6, 4), 10);
            if (y < 1900 || y > 2100 || m < 1 || m > 12 || d < 1 || d > 31) return false;
            var md = [31, (y % 4 === 0 && y % 100 !== 0) || y % 400 === 0 ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            if (d > md[m - 1]) return false;
            return true;
        }

        // ========== CONTROLES VISUAIS ==========
        function updateViagem(val) {
            var sel = document.getElementById('viagem_tipo');
            if (sel) {
                sel.value = val;
                var aviso = document.getElementById('viagem_tipo_aviso');
                if (aviso) {
                    if (val === 'internacional') {
                        aviso.textContent = 'Para viagens internacionais, al√©m da autoriza√ß√£o, costumam ser exigidos passaporte v√°lido (ou RG para alguns pa√≠ses) e, em certos casos, documentos adicionais. Sempre confirme com a Pol√≠cia Federal, a companhia a√©rea e o consulado do pa√≠s de destino.';
                    } else {
                        aviso.textContent = 'Para viagens nacionais, verifique tamb√©m as regras da companhia a√©rea/rodovi√°ria e tenha em m√£os os documentos originais do menor e dos respons√°veis.';
                    }
                }
            }
        }

        function updateAcompVisibility(val) {
            var sel = document.getElementById('acompanhante_tipo');
            if (sel) sel.value = val;
            var box = document.getElementById('acompanhanteBox');
            if (box) {
                if (val === 'terceiro' || val === 'outro_responsavel') {
                    box.style.display = 'block';
                } else {
                    box.style.display = 'none';
                }
            }
        }

        function toggleResps(num) {
            var check = document.getElementById('dois_resps');
            var box = document.getElementById('resp2Box');
            if (num == 2) {
                if (check) check.checked = true;
                if (box) box.style.display = 'block';
            } else {
                if (check) check.checked = false;
                if (box) box.style.display = 'none';
            }
        }

        // ========== AUTOSAVE E RESTORE ==========
        var ids = ['menor_nome', 'menor_nascimento', 'menor_doc', 'viagem_tipo', 'destino', 'data_ida', 'data_volta', 'acompanhante_tipo', 'acomp_nome', 'acomp_cpf', 'acomp_doc', 'acomp_parentesco', 'resp1_nome', 'resp1_cpf', 'resp1_doc', 'resp1_parentesco', 'dois_resps', 'resp2_nome', 'resp2_cpf', 'resp2_doc', 'resp2_parentesco', 'cidade_uf_emissao', 'email', 'telefone'];
        var SAVE_KEY = 'viagem_form_v4';

        function saveForm() {
            var o = {};
            for (var i = 0; i < ids.length; i++) {
                var el = document.getElementById(ids[i]);
                if (!el) continue;
                if (el.type === 'checkbox') o[ids[i]] = el.checked;
                else o[ids[i]] = el.value;
            }
            localStorage.setItem(SAVE_KEY, JSON.stringify(o));
        }

        function loadForm() {
            try {
                var o = JSON.parse(localStorage.getItem(SAVE_KEY) || '{}');
                for (var k in o) {
                    var el = document.getElementById(k);
                    if (!el) continue;
                    if (el.type === 'checkbox') { el.checked = !!o[k]; }
                    else if (el.type === 'date') { el.value = dateToISO(o[k]); }
                    else { el.value = o[k]; }
                }

                setTimeout(() => {
                    var vTipo = document.getElementById('viagem_tipo').value;
                    if (vTipo === 'internacional') document.getElementById('v_internacional').checked = true;
                    updateViagem(vTipo);

                    var aTipo = document.getElementById('acompanhante_tipo').value;
                    if (aTipo === 'outro_responsavel') document.getElementById('opt_resp').checked = true;
                    if (aTipo === 'terceiro') document.getElementById('opt_terceiro').checked = true;
                    if (aTipo === 'desacompanhado') document.getElementById('opt_sozinho').checked = true;
                    updateAcompVisibility(aTipo);

                    if (document.getElementById('dois_resps').checked) {
                        document.getElementById('dois_resps_visual').checked = true;
                        toggleResps(2);
                    }
                }, 300);
            } catch (e) { }
        }

        function attachAutosave() {
            for (var i = 0; i < ids.length; i++) {
                var el = document.getElementById(ids[i]);
                if (!el) continue;
                el.addEventListener('input', saveForm);
                el.addEventListener('change', saveForm);
            }
        }

        // ========== PAYLOAD E VALIDA√á√ÉO ==========
        function getPayload() {
            return {
                slug: 'autorizacao-viagem-menor',
                tipo: 'autorizacao_viagem',
                entidade: 'Viagem',
                menor_nome: document.getElementById('menor_nome').value.trim(),
                menor_nascimento: formatDateBR(document.getElementById('menor_nascimento').value),
                menor_doc: document.getElementById('menor_doc').value.trim(),
                viagem_tipo: document.getElementById('viagem_tipo').value,
                destino: document.getElementById('destino').value.trim(),
                data_ida: formatDateBR(document.getElementById('data_ida').value),
                data_volta: formatDateBR(document.getElementById('data_volta').value),
                acompanhante_tipo: document.getElementById('acompanhante_tipo').value,
                acompanhante_nome: document.getElementById('acomp_nome').value.trim(),
                acompanhante_cpf: document.getElementById('acomp_cpf').value.trim(),
                acompanhante_doc: document.getElementById('acomp_doc').value.trim(),
                acompanhante_parentesco: document.getElementById('acomp_parentesco').value.trim(),
                resp1_nome: document.getElementById('resp1_nome').value.trim(),
                resp1_cpf: document.getElementById('resp1_cpf').value.trim(),
                resp1_doc: document.getElementById('resp1_doc').value.trim(),
                resp1_parentesco: document.getElementById('resp1_parentesco').value,
                dois_resps: document.getElementById('dois_resps').checked,
                resp2_nome: document.getElementById('resp2_nome').value.trim(),
                resp2_cpf: document.getElementById('resp2_cpf').value.trim(),
                resp2_doc: document.getElementById('resp2_doc').value.trim(),
                resp2_parentesco: document.getElementById('resp2_parentesco').value,
                cidade_uf_emissao: document.getElementById('cidade_uf_emissao').value.trim(),
                email: document.getElementById('email').value.trim(),
                telefone: document.getElementById('telefone').value.trim(),
                observacoes: '',
                accepted_terms: document.getElementById('aceite_termos') ? document.getElementById('aceite_termos').checked : false,
                terms_version: document.getElementById('terms_version') ? document.getElementById('terms_version').value : null,
                accepted_at: new Date().toISOString(),
                utm: (window.LMUTM ? LMUTM.get() : {})
            };
        }

        function validateAll(p) {
            var ok = true;
            function show(id, showFlag) { var el = document.getElementById(id); if (el) el.style.display = showFlag ? 'block' : 'none'; }

            var menorNasc = formatDateBR(document.getElementById('menor_nascimento').value);
            if (!isValidDateBR(menorNasc)) { show('err_menor_nascimento', true); ok = false; }
            else show('err_menor_nascimento', false);

            var dataIda = formatDateBR(document.getElementById('data_ida').value);
            if (!isValidDateBR(dataIda)) { show('err_data_ida', true); ok = false; }
            else show('err_data_ida', false);

            var dataVolta = formatDateBR(document.getElementById('data_volta').value);
            if (!isValidDateBR(dataVolta)) { show('err_data_volta', true); ok = false; }
            else {
                var di = new Date(dateToISO(dataIda));
                var dv = new Date(dateToISO(dataVolta));
                if (isNaN(di.getTime()) || isNaN(dv.getTime()) || dv.getTime() < di.getTime()) {
                    show('err_data_volta', true); ok = false;
                } else show('err_data_volta', false);
            }

            if (p.resp1_cpf && !isValidCPF(p.resp1_cpf)) { show('err_resp1_cpf', true); ok = false; }
            else show('err_resp1_cpf', false);

            if (p.resp2_cpf && !isValidCPF(p.resp2_cpf)) { show('err_resp2_cpf', true); ok = false; }
            else show('err_resp2_cpf', false);

            if (p.acompanhante_cpf && !isValidCPF(p.acompanhante_cpf)) { show('err_acomp_cpf', true); ok = false; }
            else show('err_acomp_cpf', false);

            if (p.acompanhante_tipo !== 'desacompanhado') {
                if (!p.acompanhante_nome || !p.acompanhante_parentesco) { ok = false; }
            }

            if (!p.menor_nome || !p.resp1_nome || !p.destino || !p.cidade_uf_emissao) ok = false;

            return ok;
        }

        function validateStep(step) {
            var p = getPayload();
            var msg = '';
            if (step === 1) {
                if (!p.menor_nome || !p.menor_nascimento || !p.destino || !p.data_ida || !p.data_volta) {
                    msg = 'Preencha os dados da crian√ßa e da viagem.';
                }
            } else if (step === 2) {
                if (p.acompanhante_tipo !== 'desacompanhado') {
                    if (!p.acompanhante_nome || !p.acompanhante_parentesco) msg = 'Informe os dados do acompanhante.';
                }
            } else if (step === 3) {
                if (!p.resp1_nome) msg = 'Informe o nome do respons√°vel.';
                if (p.dois_resps && !p.resp2_nome) msg = 'Informe o nome do segundo respons√°vel.';
            } else if (step === 4) {
                if (!p.cidade_uf_emissao) msg = 'Informe sua cidade.';
            }
            if (msg) { alert(msg); return false; }
            return true;
        }

        // ========== NAVEGA√á√ÉO ENTRE STEPS ==========
        var currentStep = 1;
        function showStep(step, autoScroll = true) {
            currentStep = step;
            document.querySelectorAll('.form-step').forEach(s => {
                s.style.display = (parseInt(s.getAttribute('data-step')) === step) ? 'block' : 'none';
            });
            document.querySelectorAll('.step-item').forEach(it => {
                var n = parseInt(it.getAttribute('data-step'));
                it.classList.toggle('active', n === step);
                it.classList.toggle('completed', n < step);
            });
            if (autoScroll) {
                setTimeout(() => {
                    var fa = document.getElementById('formArea');
                    if (fa) fa.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 50);
            }
        }

        document.getElementById('nextStep1').onclick = function () { if (validateStep(1)) showStep(2); };
        document.getElementById('nextStep2').onclick = function () { if (validateStep(2)) showStep(3); };
        document.getElementById('nextStep3').onclick = function () { if (validateStep(3)) showStep(4); };
        document.getElementById('prevStep2').onclick = function () { showStep(1); };
        document.getElementById('prevStep3').onclick = function () { showStep(2); };
        document.getElementById('prevStep4').onclick = function () { showStep(3); };

        // ========== INICIALIZA√á√ÉO ==========
        document.addEventListener('DOMContentLoaded', function () {
            const principaisCidades = ["S√£o Paulo/SP", "Rio de Janeiro/RJ", "Bras√≠lia/DF", "Salvador/BA", "Belo Horizonte/MG", "Curitiba/PR", "Manaus/AM", "Recife/PE", "Porto Alegre/RS", "Florian√≥polis/SC", "Blumenau/SC", "Balne√°rio Cambori√∫/SC", "Indaial/SC", "Itaja√≠/SC", "Joinville/SC", "Campinas/SP", "Guarulhos/SP", "Goi√¢nia/GO", "Bel√©m/PA"];
            const datalist = document.getElementById('lista_cidades');
            if (datalist) {
                principaisCidades.forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c;
                    datalist.appendChild(opt);
                });
            }

            ['resp1_cpf', 'resp2_cpf', 'acomp_cpf'].forEach(id => {
                var el = document.getElementById(id);
                if (el) el.addEventListener('input', function () { this.value = maskCPF(this.value); });
            });
        });

        loadForm();
        attachAutosave();
        showStep(1, false);
        updateViagem('nacional');

        // ========== PREVIEW E PAGAMENTO ==========
        var btnPreview = document.getElementById('btnPreview');
        var btnPagar = document.getElementById('btnPagar');
        var previewWrap = document.getElementById('previewWrap');
        var previewBox = document.getElementById('previewBox');
        var paySection = document.getElementById('paySection');

        function checkCooldown() {
            var last = localStorage.getItem('last_preview_ts');
            if (last && (Date.now() - parseInt(last)) < 30000) {
                alert('Por favor, aguarde alguns segundos antes de gerar outra pr√©via.');
                return false;
            }
            return true;
        }

        function captureLead(p) {
            fetch('/.netlify/functions/capture-lead', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    email: p.email,
                    telefone: p.telefone,
                    nome: p.resp1_nome || p.menor_nome,
                    slug: 'autorizacao-viagem-menor',
                    payload: p
                })
            }).catch(err => console.log('Lead capture bg error', err));
        }

        if (btnPreview) {
            btnPreview.addEventListener('click', async function () {
                if (!checkCooldown()) return;
                var payload = getPayload();
                if (!validateAll(payload)) {
                    alert('Verifique os campos obrigat√≥rios (destacados em vermelho).');
                    return;
                }
                btnPreview.disabled = true;
                btnPreview.textContent = '‚è≥ Gerando...';

                async function tentarGerar(tentativa) {
                    var vaiTentarDeNovo = false;
                    try {
                        saveForm();
                        if (tentativa === 1 && (payload.email || payload.telefone)) {
                            captureLead(payload);
                        }
                        var r = await fetch('/.netlify/functions/generate-doc', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ payload: payload, preview: true })
                        });

                        if (r.status === 503 && tentativa === 1) {
                            console.log('Servidor ocupado (503), tentando novamente...');
                            btnPreview.textContent = '‚Üª Reconectando...';
                            vaiTentarDeNovo = true;
                            await new Promise(res => setTimeout(res, 2000));
                            return tentarGerar(2);
                        }

                        if (!r.ok) {
                            var errText = 'Falha ao gerar';
                            try { var errData = await r.json(); if (errData.body) errText = errData.body; } catch (e) { }
                            throw new Error(errText);
                        }

                        var data = await r.json();
                        var out = data.output || data;
                        var pars = out.corpo_paragrafos || [];
                        var keep = Math.max(1, Math.min(2, pars.length));
                        var parcialText = pars.slice(0, keep).join('\n\n') + '\n\n[...]';
                        var saud = out.saudacao || '';
                        var checklist = out.check_list_anexos || [];
                        var chkShow = checklist.slice(0, 2);
                        if (checklist.length > 2) chkShow.push('...');
                        var finalPreview = (saud ? saud + '\n\n' : '') + parcialText + '\n\nChecklist de anexos (parcial): ' + chkShow.join('; ');

                        previewBox.textContent = finalPreview;
                        previewWrap.style.display = 'block';
                        paySection.style.display = 'block';
                        btnPreview.style.display = 'none';

                        setTimeout(function () {
                            var paySec = document.getElementById('paySection');
                            if (paySec) {
                                paySec.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }
                        }, 100);

                        if (typeof gtag === 'function') {
                            gtag('event', 'generate_lead', {
                                'send_to': 'AW-1021062139/Ri4bCICS88IbEPvX8OYD',
                                'event_category': 'engagement',
                                'event_label': 'viagem_nacional',
                                'value': 2.00,
                                'currency': 'BRL'
                            });
                        }

                        localStorage.setItem('pendingPayload', JSON.stringify(payload));
                        localStorage.setItem('last_preview_ts', Date.now());
                        btnPagar.disabled = false;

                    } catch (e) {
                        if (!vaiTentarDeNovo) {
                            if (e.message !== 'Campos inv√°lidos') { alert('Erro ao gerar: ' + e.message); }
                            btnPreview.disabled = false;
                            btnPreview.style.opacity = '1';
                            btnPreview.style.cursor = 'pointer';
                            btnPreview.textContent = 'üìÑ Ver Pr√©via Gratuita';
                        }
                    }
                }
                tentarGerar(1);
            });
        }

        if (btnPagar) btnPagar.addEventListener('click', function () {
            document.getElementById('modalTermos').style.display = 'flex';
        });

        document.getElementById('btnCancelarTermos').onclick = function () {
            document.getElementById('modalTermos').style.display = 'none';
        };

        document.getElementById('btnConfirmarTermos').onclick = async function () {
            var btnConfirm = document.getElementById('btnConfirmarTermos');
            var checkbox = document.getElementById('aceite_termos');
            if (!checkbox.checked) {
                alert('Voc√™ precisa marcar a caixa "Li e concordo" para continuar.');
                return;
            }
            btnConfirm.disabled = true;
            btnConfirm.textContent = 'Processando...';

            try {
                var payload = getPayload();
                saveForm();
                localStorage.setItem('pendingPayload', JSON.stringify(payload));
                var slugStr = 'autorizacao-viagem-menor';
                var r = await fetch('/.netlify/functions/mp-checkout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        slug: slugStr,
                        payload: payload,
                        utm: (window.LMUTM ? LMUTM.get() : {})
                    })
                });
                var data = await r.json();
                if (!r.ok) throw new Error(data.error || 'Erro no pagamento');
                document.getElementById('modalTermos').style.display = 'none';
                localStorage.setItem('lastOrderId', data.order_id || '');
                if (typeof gtag === 'function') {
                    gtag('event', 'begin_checkout', {
                        value: 9.9,
                        currency: 'BRL',
                        items: [{ item_id: slugStr }]
                    });
                }
                showPaymentModal(data.init_point, data.order_id, slugStr);
            } catch (e) {
                alert('Erro: ' + e.message);
            } finally {
                btnConfirm.disabled = false;
                btnConfirm.textContent = 'Confirmar e Pagar';
            }
        };

        function showPaymentModal(initPoint, orderId, slug) {
            var isLight = (document.documentElement.getAttribute('data-theme') === 'light');
            var cardBG = isLight ? '#ffffff' : '#111827';
            var cardText = isLight ? '#0f172a' : '#e6eefb';
            var overlay = document.createElement('div');
            overlay.style = 'position:fixed;inset:0;background:rgba(2,6,23,.85);backdrop-filter:blur(4px);z-index:9999;display:flex;align-items:center;justify-content:center';
            overlay.innerHTML =
                '<div style="background:' + cardBG + ';color:' + cardText + ';border:1px solid var(--border);border-radius:16px;max-width:400px;width:90%;padding:24px;box-shadow:0 20px 50px rgba(0,0,0,.4);text-align:center;">' +
                '<div style="font-size:40px;margin-bottom:16px;">üí∏</div>' +
                '<h3 style="margin:0 0 12px;font-size:20px;">Quase l√°!</h3>' +
                '<p style="margin:0 0 20px;line-height:1.5;color:var(--text-secondary);">Clique no bot√£o abaixo para finalizar o pagamento com seguran√ßa no Mercado Pago.</p>' +
                '<div style="display:flex;flex-direction:column;gap:12px;">' +
                '<button id="lm-goPay" class="btn btn-primary" style="width:100%;padding:14px;font-size:16px;justify-content:center;">Ir para Pagamento (Pix ou Cart√£o)</button>' +
                '<button id="lm-close" class="btn btn-outline" style="width:100%;justify-content:center;border:none;">Fechar e corrigir dados</button>' +
                '</div>' +
                '<p id="lm-statusPay" class="small" style="margin-top:16px;font-size:12px;opacity:0.8;"></p>' +
                '</div>';
            document.body.appendChild(overlay);

            document.getElementById('lm-close').onclick = function () {
                overlay.remove();
                try { grecaptcha.reset(); } catch (e) { }
                var btnPagar = document.getElementById('btnPagar');
                if (btnPagar) {
                    btnPagar.disabled = false;
                    btnPagar.textContent = 'Gerar documento completo (R$ 9,90)';
                }
            };

            async function docReady() {
                try {
                    var r = await fetch('/.netlify/functions/generate-doc', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ payload: { order_id: orderId }, preview: false })
                    });
                    if (!r.ok) return false;
                    var j = await r.json();
                    return !!(j && j.output);
                } catch (e) { return false; }
            }

            document.getElementById('lm-goPay').onclick = function () {
                window.open(initPoint, '_blank', 'noopener');
                var btn = this;
                btn.textContent = 'Verificando pagamento...';
                document.getElementById('lm-statusPay').textContent = 'Aguarde, estamos confirmando seu pagamento...';
                var iv = setInterval(async function () {
                    try {
                        if (await docReady()) {
                            clearInterval(iv);
                            location.href = '/success.html?o=' + encodeURIComponent(orderId) + '&slug=' + encodeURIComponent(slug) + '&s=success';
                            return;
                        }
                        var rr = await fetch('/.netlify/functions/order-status?o=' + encodeURIComponent(orderId));
                        var jj = rr.ok ? await rr.json() : null;
                        if (jj && jj.status === 'paid') {
                            clearInterval(iv);
                            location.href = '/success.html?o=' + encodeURIComponent(orderId) + '&slug=' + encodeURIComponent(slug) + '&s=success';
                        }
                    } catch (e) { }
                }, 3000);
            };
        }

        // ========== MODO ADMIN ==========
        (function () {
            const params = new URLSearchParams(window.location.search);
            if (params.get('modo') === 'admin') {
                const btnPagar = document.querySelector('[id*="Pagar"], [id*="pagar"]') || document.getElementById('btnPagar');
                if (!btnPagar) return;
                const btnArea = btnPagar.parentElement;
                const btnAdmin = document.createElement('button');
                btnAdmin.className = 'btn';
                btnAdmin.style.backgroundColor = '#8b5cf6';
                btnAdmin.style.color = 'white';
                btnAdmin.style.border = 'none';
                btnAdmin.style.marginTop = '10px';
                btnAdmin.style.width = '100%';
                btnAdmin.innerText = 'üëë Gerar Admin';
                btnAdmin.onclick = async function () {
                    const senha = prompt("Digite a senha de Admin:");
                    if (!senha) return;
                    btnAdmin.innerText = 'Gerando...';
                    btnAdmin.disabled = true;
                    try {
                        var p = getPayload();
                        p.admin_key = senha;
                        var r = await fetch('/.netlify/functions/generate-doc', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ payload: p, preview: false })
                        });
                        if (!r.ok) throw new Error('Senha errada');
                        var data = await r.json();
                        if (data.output) {
                            let fullText = '';
                            if (data.output.saudacao) fullText += data.output.saudacao + '\n\n';
                            if (Array.isArray(data.output.corpo_paragrafos)) fullText += data.output.corpo_paragrafos.join('\n\n');
                            else fullText += String(data.output.corpo_paragrafos);
                            if (data.output.fechamento) fullText += '\n\n' + data.output.fechamento;
                            const previewBox = document.getElementById('previewBox');
                            const previewWrap = document.getElementById('previewWrap');
                            if (previewBox && previewWrap) {
                                previewBox.textContent = fullText;
                                previewBox.style.whiteSpace = 'pre-wrap';
                                previewWrap.style.display = 'block';
                                const oldCopyBtn = document.getElementById('admin-copy-btn');
                                if (oldCopyBtn) oldCopyBtn.remove();
                                const copyBtn = document.createElement('button');
                                copyBtn.id = 'admin-copy-btn';
                                copyBtn.className = 'btn btn-primary';
                                copyBtn.style.marginTop = '16px';
                                copyBtn.innerText = 'üìã Copiar Documento';
                                copyBtn.onclick = async function () {
                                    await navigator.clipboard.writeText(fullText);
                                    copyBtn.innerText = '‚úÖ Copiado!';
                                    setTimeout(() => { copyBtn.innerText = 'üìã Copiar Documento'; }, 2000);
                                };
                                previewWrap.appendChild(copyBtn);
                                previewWrap.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                alert("‚úÖ Documento Admin Gerado!");
                            }
                        }
                    } catch (e) { alert('‚ùå Erro: ' + e.message); }
                    finally { btnAdmin.innerText = 'üëë Gerar Admin'; btnAdmin.disabled = false; }
                };
                btnArea.appendChild(btnAdmin);
            }
        })();
    </script>
</body>

</html>
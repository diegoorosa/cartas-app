<!doctype html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <title>Carta – Reclamação de Compra Online</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="/style.css" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-1021062139"></script>
    <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'AW-1021062139'); </script>
</head>

<body>
    <div class="container">
        <div class="header"> <a href="/" class="small" style="text-decoration:none;color:#93c5fd">← Voltar</a> <span
                class="badge">E‑commerce</span> </div>
        <div class="card">
            <h1>Carta – Reclamação de Compra Online</h1>
            <p class="small">Preencha os dados do pedido e gere a carta em .DOC para enviar à loja/marketplace. Prévia
                grátis.</p>

            <div id="formArea">
                <h2>Consumidor</h2>
                <label class="label">Nome completo</label>
                <input class="input" id="nome" placeholder="Ex.: Diego Rosa" />
                <label class="label">CPF</label>
                <input class="input" id="cpf" placeholder="000.000.000-00" inputmode="numeric" maxlength="14" />
                <div id="err_cpf" class="small" style="display:none;color:#fca5a5">CPF inválido.</div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
                    <div>
                        <label class="label">E-mail</label>
                        <input class="input" id="email" placeholder="seu@email.com" />
                    </div>
                    <div>
                        <label class="label">Telefone</label>
                        <input class="input" id="telefone" placeholder="(00) 00000-0000" />
                    </div>
                </div>

                <h2>Pedido</h2>
                <label class="label">Loja/Marketplace</label>
                <input class="input" id="loja" placeholder="Ex.: Amazon, Shopee, Magalu, Mercado Livre" />

                <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
                    <div>
                        <label class="label">Nº do pedido</label>
                        <input class="input" id="pedido" placeholder="Ex.: 123456789" />
                    </div>
                    <div>
                        <label class="label">Valor total (opcional)</label>
                        <input class="input" id="valor" placeholder="Ex.: R$ 249,90" />
                    </div>
                </div>

                <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
                    <div>
                        <label class="label">Data da compra</label>
                        <input class="input" id="data_compra" placeholder="DD/MM/AAAA" inputmode="numeric"
                            maxlength="10" />
                        <div id="err_data_compra" class="small" style="display:none;color:#fca5a5">Data da compra
                            inválida.</div>
                    </div>
                    <div>
                        <label class="label">Previsão de entrega (opcional)</label>
                        <input class="input" id="previsao_entrega" placeholder="DD/MM/AAAA" inputmode="numeric"
                            maxlength="10" />
                    </div>
                </div>

                <h2>Motivo</h2>
                <label class="label">Selecione o motivo</label>
                <select class="input" id="motivo">
                    <option value="nao_entregue">Produto não entregue</option>
                    <option value="atraso">Atraso na entrega</option>
                    <option value="produto_errado">Produto errado</option>
                    <option value="produto_defeituoso">Produto com defeito</option>
                    <option value="arrependimento">Direito de arrependimento (7 dias)</option>
                </select>

                <label class="label">Forma de pagamento</label>
                <select class="input" id="forma_pagto">
                    <option>Cartão</option>
                    <option>PIX</option>
                    <option>Boleto</option>
                    <option>Outro</option>
                </select>

                <label class="label">Itens / resumo</label>
                <textarea class="input" id="itens" rows="3" placeholder="Ex.: 1x Fone XYZ, 1x Capa ABC"></textarea>

                <h2>Local</h2>
                <label class="label">Cidade/UF</label>
                <input class="input" id="cidade_uf" placeholder="Ex.: Blumenau/SC" />

                <label class="label">Observações (opcional)</label>
                <textarea class="input" id="observacoes" rows="3"
                    placeholder="Ex.: Informações adicionais relevantes."></textarea>

                <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap">
                    <button class="btn" id="btnPreview">Gerar prévia</button>
                    <button class="btn btn-outline" id="btnPagar" disabled>Gerar documento completo (R$ 6,90)</button>
                </div>
            </div>

            <div id="previewWrap" style="display:none; margin-top:16px">
                <h2>Prévia do documento</h2>
                <div class="preview" id="previewBox"></div>
                <p class="small" style="margin-top:8px">Prévia parcial. Na versão completa você poderá copiar, baixar
                    .DOC e enviar no WhatsApp.</p>
            </div>
        </div>
    </div>
    <script> function maskCPF(v) { v = (v || '').replace(/\D/g, '').slice(0, 11); v = v.replace(/(\d{3})(\d)/, '$1.$2'); v = v.replace(/(\d{3})(\d)/, '$1.$2'); v = v.replace(/(\d{3})(\d{1,2})$/, '$1-$2'); return v; } function isValidCPF(cpf) { var s = (cpf || '').replace(/\D/g, ''); if (s.length !== 11) return false; if (/^(\d)\1{10}$/.test(s)) return false; var i, sum = 0, rest; for (i = 1; i <= 9; i++) sum += parseInt(s.substring(i - 1, i)) * (11 - i); rest = (sum * 10) % 11; if (rest === 10 || rest === 11) rest = 0; if (rest !== parseInt(s.substring(9, 10))) return false; sum = 0; for (i = 1; i <= 10; i++) sum += parseInt(s.substring(i - 1, i)) * (12 - i); rest = (sum * 10) % 11; if (rest === 10 || rest === 11) rest = 0; if (rest !== parseInt(s.substring(10, 11))) return false; return true; } function maskDate(v) { v = (v || '').replace(/\D/g, '').slice(0, 8); if (v.length >= 5) v = v.replace(/(\d{2})(\d{2})(\d{1,4})/, '$1/$2/$3'); else if (v.length >= 3) v = v.replace(/(\d{2})(\d{1,2})/, '$1/$2'); return v; } function isValidDateBR(s) { if (!/^\d{2}\/\d{2}\/\d{4}$/.test(s || '')) return false; var d = parseInt(s.substr(0, 2), 10), m = parseInt(s.substr(3, 2), 10), y = parseInt(s.substr(6, 4), 10); if (y < 1900 || y > 2100 || m < 1 || m > 12 || d < 1 || d > 31) return false; var md = [31, (y % 4 === 0 && y % 100 !== 0) || y % 400 === 0 ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]; if (d > md[m - 1]) return false; return true; } var ids = ['nome', 'cpf', 'email', 'telefone', 'loja', 'pedido', 'valor', 'data_compra', 'previsao_entrega', 'motivo', 'forma_pagto', 'itens', 'cidade_uf', 'observacoes']; var SAVE_KEY = 'ecomm_form_v1'; function saveForm() { var o = {}; for (var i = 0; i < ids.length; i++) { var el = document.getElementById(ids[i]); if (el) o[ids[i]] = el.value; } localStorage.setItem(SAVE_KEY, JSON.stringify(o)); } function loadForm() { try { var o = JSON.parse(localStorage.getItem(SAVE_KEY) || '{}'); for (var k in o) { if (document.getElementById(k)) document.getElementById(k).value = o[k]; } } catch (e) { } } function attachAutosave() { for (var i = 0; i < ids.length; i++) { var el = document.getElementById(ids[i]); if (el) { el.addEventListener('input', saveForm); el.addEventListener('change', saveForm); } } } document.getElementById('cpf').addEventListener('input', function () { this.value = maskCPF(this.value); }); var dateIds = ['data_compra', 'previsao_entrega']; for (var i = 0; i < dateIds.length; i++) { var e = document.getElementById(dateIds[i]); if (e) { e.addEventListener('input', function (ev) { ev.target.value = maskDate(ev.target.value); }); } } function getPayload() { var cpfEl = document.getElementById('cpf'); cpfEl.value = maskCPF(cpfEl.value); return { tipo: 'ecommerce', slug: 'carta-ecommerce', nome: document.getElementById('nome').value.trim(), cpf: document.getElementById('cpf').value.trim(), email: document.getElementById('email').value.trim(), telefone: document.getElementById('telefone').value.trim(), loja: document.getElementById('loja').value.trim(), pedido: document.getElementById('pedido').value.trim(), valor: document.getElementById('valor').value.trim(), data_compra: document.getElementById('data_compra').value.trim(), previsao_entrega: document.getElementById('previsao_entrega').value.trim(), motivo: document.getElementById('motivo').value, forma_pagto: document.getElementById('forma_pagto').value, itens: document.getElementById('itens').value.trim(), cidade_uf: document.getElementById('cidade_uf').value.trim(), observacoes: document.getElementById('observacoes').value.trim() }; } function validateAll(p) { var ok = true; var cpfOk = isValidCPF(p.cpf); document.getElementById('err_cpf').style.display = cpfOk ? 'none' : 'block'; if (!cpfOk) ok = false; if (!p.nome || !p.loja || !p.pedido || !p.cidade_uf) ok = false; if (!isValidDateBR(p.data_compra)) { document.getElementById('err_data_compra').style.display = 'block'; ok = false; } else { document.getElementById('err_data_compra').style.display = 'none'; } return ok; } var btnPreview = document.getElementById('btnPreview'); var btnPagar = document.getElementById('btnPagar'); var previewWrap = document.getElementById('previewWrap'); var previewBox = document.getElementById('previewBox'); loadForm(); attachAutosave(); (function () { var u = new URL(location.href); var pref = u.searchParams.get('pref'); if (pref === 'arrependimento') document.getElementById('motivo').value = 'arrependimento'; if (pref === 'nao_entregue') document.getElementById('motivo').value = 'nao_entregue'; if (pref === 'atraso') document.getElementById('motivo').value = 'atraso'; })(); btnPreview.addEventListener('click', async function () { btnPreview.disabled = true; btnPreview.textContent = 'Gerando...'; try { var p = getPayload(); if (!validateAll(p)) { alert('Verifique os campos obrigatórios.'); btnPreview.disabled = false; btnPreview.textContent = 'Gerar prévia'; return; } saveForm(); var r = await fetch('/.netlify/functions/generate-doc', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ payload: p, preview: true }) }); if (!r.ok) throw new Error(); var d = await r.json(); var out = d.output || d; var pr = out.corpo_paragrafos || []; var keep = Math.max(1, Math.min(2, pr.length)); var parcial = pr.slice(0, keep).join('\n\n') + '\n\n[...]'; var saud = out.saudacao || ''; var checklist = out.check_list_anexos || []; var chk2 = checklist.slice(0, 2); if (checklist.length > 2) chk2.push('...'); previewBox.textContent = (saud ? saud + '\n\n' : '') + parcial + '\n\nChecklist (parcial): ' + chk2.join('; '); previewWrap.style.display = 'block'; localStorage.setItem('pendingPayload', JSON.stringify(p)); btnPagar.disabled = false; } catch (e) { alert('Erro ao gerar prévia.'); } finally { btnPreview.disabled = false; btnPreview.textContent = 'Gerar prévia'; } }); btnPagar.addEventListener('click', async function () { try { var p = getPayload(); if (!validateAll(p)) { alert('Verifique os campos obrigatórios.'); return; } saveForm(); localStorage.setItem('pendingPayload', JSON.stringify(p)); btnPagar.disabled = true; btnPagar.textContent = 'Redirecionando...'; var r = await fetch('/.netlify/functions/mp-checkout', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ slug: 'carta-ecommerce', price: 6.9 }) }); var data = await r.json(); if (!r.ok || !data.init_point) throw new Error(); location.href = data.init_point; } catch (e) { alert('Não foi possível abrir o pagamento.'); btnPagar.disabled = false; btnPagar.textContent = 'Gerar documento completo (R$ 6,90)'; } }); </script>
</body>

</html>
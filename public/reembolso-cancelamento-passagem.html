<!doctype html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <title>Reembolso de Passagem A√©rea (Cancelamento) | CartasApp</title>
    <meta name="description"
        content="Cancelou a passagem e a cia a√©rea quer ficar com tudo? A Lei limita a multa a 5%. Gere sua carta exigindo o reembolso de at√© 95% agora." />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <script src="/theme.js"></script>
    <link rel="stylesheet" href="/style.css" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-1021062139"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'AW-1021062139');
        gtag('config', 'G-D40QPP9KNP');
    </script>
    <script src="/gtag.js"></script>
    <script
        type="text/javascript">(function (c, l, a, r, i, t, y) { c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) }; t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i; y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y); })(window, document, "clarity", "script", "u4x90t35gk");</script>
</head>

<body>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-content">
                <a href="/" class="logo">CartasApp</a>
                <div class="nav-actions">
                    <button class="btn-theme" onclick="toggleTheme()">üåô</button>
                    <a href="https://wa.me/5547988616874" class="btn btn-secondary btn-sm" target="_blank">WhatsApp</a>
                </div>
            </div>
        </div>
    </nav>

    <section class="hero" style="padding: 60px 0 40px;">
        <div class="container">
            <div class="hero-content">
                <div class="hero-badge">üí∏ Direito do Passageiro</div>
                <h1 style="font-size: 42px; line-height: 1.2;">
                    Exija at√© 95% do valor da sua passagem de volta
                </h1>
                <p class="hero-subtitle" style="font-size: 18px; margin-top: 16px;">
                    Cancelou a passagem com anteced√™ncia e a companhia quer ficar com quase tudo?
                    O <strong>Art. 740 do C√≥digo Civil</strong> limita a multa a <strong>5%</strong>.
                    Gere em minutos uma <strong>notifica√ß√£o formal</strong> exigindo o reembolso do restante,
                    em PDF e Word, por apenas <strong>R$ 9,90</strong>.
                </p>

                <div class="hero-actions" style="margin-top: 24px;">
                    <a href="#formArea" class="btn btn-primary">
                        Come√ßar agora (leva menos de 5 minutos)
                    </a>
                    <a href="/reembolso-faq.html" class="btn btn-secondary btn-sm"
                        style="border-radius: 50px; font-size: 14px;">
                        ‚ùì Tenho direito a reembolso?
                    </a>
                </div>

                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 16px; flex-wrap: wrap;">
                    <span
                        style="background: rgba(16, 185, 129, 0.1); color: #10b981; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 600;">‚öñÔ∏è
                        Art. 740 do C√≥digo Civil</span>
                    <span
                        style="background: rgba(59, 130, 246, 0.1); color: #3b82f6; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 600;">üìÑ
                        Carta formal pronta para enviar</span>
                    <span
                        style="background: rgba(234, 179, 8, 0.12); color: #eab308; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 600;">üí∞
                        Pagamento √∫nico, sem mensalidade</span>
                </div>

                <div style="margin-top: 12px; font-size: 13px; color: var(--text-muted);">
                    ‚≠êÔ∏è <strong>4,9 de 5</strong> ‚Äî passageiros j√° usaram para contestar reten√ß√µes abusivas.
                </div>
            </div>
        </div>
    </section>

    <section class="section" style="padding-top: 0;">
        <div class="container">
            <div style="max-width: 800px; margin: 0 auto;">
                <div class="card">

                    <!-- Blocos de confian√ßa / base legal -->
                    <div class="small legal-note" style="margin-bottom: 16px;">
                        <p class="small" style="margin: 0;">
                            ‚Ä¢ Carta baseada no <strong>Art. 740 do C√≥digo Civil</strong>, que limita a multa de
                            cancelamento a <strong>5% do valor da passagem</strong> quando o passageiro desiste com
                            anteced√™ncia.<br>
                            ‚Ä¢ Indicada para situa√ß√µes em que a companhia a√©rea quer reter praticamente todo o valor
                            pago.<br>
                            ‚Ä¢ Arquivos em <strong>PDF e Word</strong>, prontos para enviar por e-mail, protocolo ou
                            cart√≥rio, se desejar.
                        </p>
                    </div>

                    <div class="small"
                        style="margin-bottom: 16px; padding: 12px 14px; border-radius: 10px; background: var(--card-hover); border: 1px solid var(--border);">
                        <strong>Por R$ 9,90 (pagamento √∫nico)</strong>, voc√™ recebe:<br>
                        ‚Ä¢ Notifica√ß√£o personalizada com seus dados e os dados da reserva.<br>
                        ‚Ä¢ Texto formal, citando o Art. 740 e argumentando contra reten√ß√µes abusivas.<br>
                        ‚Ä¢ Vers√£o em PDF e Word para ajustar, imprimir, assinar e enviar.<br>
                        ‚Ä¢ Suporte por WhatsApp em caso de d√∫vidas sobre o documento.
                    </div>

                    <p class="small" style="margin-bottom: 24px; color: var(--text-muted);">
                        Aten√ß√£o: cada caso √© analisado pela pr√≥pria companhia ou Judici√°rio. <strong>N√£o h√° garantia de
                            reembolso integral</strong>.
                        Em passagens promocionais, emitidas com milhas ou com regras especiais, podem existir
                        limita√ß√µes adicionais.
                        Este site n√£o substitui advogado ou consultoria jur√≠dica individual.
                    </p>

                    <div id="formArea">
                        <h2 class="section-title" style="font-size: 24px; margin-bottom: 24px;">Seus Dados</h2>

                        <label class="label">Nome completo <span class="required-star">*</span></label>
                        <input class="input" id="nome" placeholder="Ex.: Maria Oliveira" />

                        <label class="label">CPF <span class="required-star">*</span></label>
                        <input class="input" id="cpf" placeholder="000.000.000-00" inputmode="numeric" maxlength="14" />
                        <div id="err_cpf" class="small" style="display:none;color:#fca5a5;margin-top:4px;">
                            CPF inv√°lido.
                        </div>

                        <label class="label">Cidade/UF <span class="required-star">*</span></label>
                        <input class="input" id="cidade_uf" placeholder="Ex.: S√£o Paulo/SP" />

                        <h2 class="section-title" style="font-size: 24px; margin: 32px 0 24px;">Dados da Passagem</h2>

                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
                            <div>
                                <label class="label">Companhia a√©rea <span class="required-star">*</span></label>
                                <input class="input" id="cia" placeholder="Ex.: LATAM, GOL, Azul" />
                            </div>
                            <div>
                                <label class="label">C√≥digo da reserva (localizador)
                                    <span class="required-star">*</span>
                                </label>
                                <input class="input" id="reserva" placeholder="Ex.: ABC1234" />
                            </div>
                        </div>

                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:20px;">
                            <div>
                                <label class="label">Data da compra (aprox.) (opcional)</label>
                                <input class="input" id="data_compra" placeholder="DD/MM/AAAA" maxlength="10" />
                            </div>
                            <div>
                                <label class="label">Data do voo (opcional)</label>
                                <input class="input" id="data_voo" placeholder="DD/MM/AAAA" maxlength="10" />
                            </div>
                        </div>

                        <label class="label" style="margin-top:20px;">
                            Valor pago (total) <span class="required-star">*</span>
                        </label>
                        <input class="input" id="valor_pago" placeholder="Ex.: R$ 1.200,00" />

                        <label class="label">Motivo do cancelamento (opcional)</label>
                        <textarea class="input" id="motivo" rows="3"
                            placeholder="Ex.: Motivos de sa√∫de, imprevisto no trabalho, desist√™ncia pessoal..."></textarea>
                        <p class="small" style="margin-top:4px;">
                            A lei garante o reembolso limitado √† multa de 5% <strong>ainda que o motivo seja
                                pessoal</strong>, desde
                            que o cancelamento seja comunicado com anteced√™ncia.
                        </p>

                        <div style="margin-top:32px;">
                            <div id="previewBtnArea">
                                <button class="btn btn-secondary" id="btnPreview" style="width:100%">
                                    Gerar pr√©via gratuita
                                </button>
                            </div>
                            <div id="paySection"
                                style="display:none; margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border);">
                                <div class="price-badge" style="margin-bottom: 20px;">
                                    Oferta hoje: <span class="price-old">de R$ 29,90</span>
                                    <span class="price-new">por R$ 9,90</span>
                                    <span class="timer-text">‚ö° O pre√ßo pode voltar ao normal em breve</span>
                                </div>
                                <button class="btn btn-primary" id="btnPagar" style="width: 100%;">
                                    Gerar carta completa (R$ 9,90)
                                </button>
                            </div>
                        </div>

                        <div class="guarantee-badge">
                            <span class="guarantee-icon">üîí</span>
                            <div>
                                <strong>Garantia Total:</strong> Receba seu documento pronto ou devolvemos seu dinheiro.
                            </div>
                        </div>
                    </div>

                    <div id="previewWrap"
                        style="display:none; margin-top:32px; padding-top:32px; border-top:1px solid var(--border);">
                        <h2 class="section-title" style="font-size: 24px; margin-bottom: 20px;">Pr√©via do documento</h2>
                        <div
                            style="background:var(--bg-secondary);border:1px solid var(--border);border-radius:12px;padding:24px;">
                            <div id="previewBox"
                                style="white-space:pre-wrap;font-family:monospace;font-size:14px;line-height:1.8;color:var(--text-secondary);">
                            </div>
                        </div>
                        <p class="small" style="margin-top:12px;color:var(--text-muted);">
                            Pr√©via gratuita e parcial. O documento completo (edi√ß√£o, PDF e Word) √© liberado ap√≥s o
                            pagamento √∫nico de <strong>R$ 9,90</strong>.
                        </p>
                    </div>

                    <!-- Mini FAQ -->
                    <div style="margin-top:32px;border-top:1px solid var(--border);padding-top:24px;">
                        <h2 class="section-title" style="font-size: 22px; margin-bottom: 12px;">
                            Perguntas r√°pidas
                        </h2>
                        <p class="small">
                            <strong>Tenho direito ao reembolso em qualquer situa√ß√£o?</strong><br>
                            Em regra, o <strong>Art. 740 do C√≥digo Civil</strong> limita a multa a 5% quando o passageiro
                            desiste com anteced√™ncia. Por√©m, passagens promocionais, emitidas com milhas ou com
                            condi√ß√µes especiais podem ter regras diferentes. A carta serve para <strong>questionar
                                reten√ß√µes abusivas</strong> com base na lei.
                        </p>
                        <p class="small" style="margin-top:8px;">
                            <strong>Posso usar esta carta para tentar acordo antes de ir para a Justi√ßa?</strong><br>
                            Sim. Muitos passageiros primeiro tentam resolver diretamente com a companhia (SAC, ouvidoria,
                            protocolo escrito) usando a notifica√ß√£o. Se n√£o houver acordo, podem avaliar levar o caso ao
                            Juizado Especial ou advogado.
                        </p>
                        <p class="small" style="margin-top:8px;">
                            <strong>Preciso anexar comprovantes?</strong><br>
                            √â recomend√°vel guardar <strong>comprovante de compra</strong>, print do cancelamento,
                            regulamento da tarifa, protocolos de atendimento, etc., para fortalecer sua argumenta√ß√£o.
                        </p>
                        <p class="small" style="margin-top:8px;">
                            <strong>√â pagamento √∫nico?</strong><br>
                            Sim. Voc√™ paga <strong>R$ 9,90 apenas uma vez</strong> por carta gerada, sem mensalidades.
                        </p>
                    </div>

                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p>Este site n√£o presta aconselhamento jur√≠dico. Leia os <a href="/termos.html"
                        class="footer-link">Termos de
                        Uso</a>.</p>
            </div>
        </div>
    </footer>

    <script src="/utm.js"></script>
    <script>
        function maskCPF(v) {
            v = (v || '').replace(/\D/g, '').slice(0, 11);
            v = v.replace(/(\d{3})(\d)/, '$1.$2');
            v = v.replace(/(\d{3})(\d)/, '$1.$2');
            v = v.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            return v;
        }
        function isValidCPF(cpf) {
            var s = (cpf || '').replace(/\D/g, '');
            if (s.length !== 11) return false;
            if (/^(\d)\1{10}$/.test(s)) return false;
            var i, sum = 0, rest;
            for (i = 1; i <= 9; i++) sum += parseInt(s.substring(i - 1, i)) * (11 - i);
            rest = (sum * 10) % 11;
            if (rest === 10 || rest === 11) rest = 0;
            if (rest !== parseInt(s.substring(9, 10))) return false;
            sum = 0;
            for (i = 1; i <= 10; i++) sum += parseInt(s.substring(i - 1, i)) * (12 - i);
            rest = (sum * 10) % 11;
            if (rest === 10 || rest === 11) rest = 0;
            if (rest !== parseInt(s.substring(10, 11))) return false;
            return true;
        }
        function maskDate(v) {
            v = (v || '').replace(/\D/g, '').slice(0, 8);
            if (v.length >= 5) v = v.replace(/(\d{2})(\d{2})(\d{1,4})/, '$1/$2/$3');
            else if (v.length >= 3) v = v.replace(/(\d{2})(\d{1,2})/, '$1/$2');
            return v;
        }

        var cpfEl = document.getElementById('cpf');
        cpfEl.addEventListener('input', function () { cpfEl.value = maskCPF(cpfEl.value); });
        var d1 = document.getElementById('data_compra');
        if (d1) d1.addEventListener('input', function () { this.value = maskDate(this.value); });
        var d2 = document.getElementById('data_voo');
        if (d2) d2.addEventListener('input', function () { this.value = maskDate(this.value); });

        function getPayload() {
            cpfEl.value = maskCPF(cpfEl.value);
            return {
                tipo: 'reembolso_passagem',
                slug: 'reembolso-cancelamento-passagem',
                nome: document.getElementById('nome').value.trim(),
                cpf: document.getElementById('cpf').value.trim(),
                cidade_uf: document.getElementById('cidade_uf').value.trim(),
                cia: document.getElementById('cia').value.trim(),
                reserva: document.getElementById('reserva').value.trim(),
                data_compra: document.getElementById('data_compra').value.trim(),
                data_voo: document.getElementById('data_voo').value.trim(),
                valor_pago: document.getElementById('valor_pago').value.trim(),
                motivo: document.getElementById('motivo').value.trim(),
                utm: (window.LMUTM ? LMUTM.get() : {})
            };
        }

        function validateAll(p) {
            var ok = true;
            var cpfErr = document.getElementById('err_cpf');

            if (!p.nome || !p.cpf || !p.cia || !p.reserva || !p.valor_pago || !p.cidade_uf) {
                ok = false;
            }

            if (!p.cpf || !isValidCPF(p.cpf)) {
                ok = false;
                if (cpfErr) cpfErr.style.display = 'block';
            } else {
                if (cpfErr) cpfErr.style.display = 'none';
            }

            return ok;
        }

        var btnPreview = document.getElementById('btnPreview');
        var btnPagar = document.getElementById('btnPagar');
        var previewWrap = document.getElementById('previewWrap');
        var previewBox = document.getElementById('previewBox');
        var paySection = document.getElementById('paySection');

        function checkCooldown() {
            var last = localStorage.getItem('last_preview_ts');
            if (last && (Date.now() - parseInt(last)) < 30000) {
                alert('Por favor, aguarde alguns segundos antes de gerar outra pr√©via.');
                return false;
            }
            return true;
        }

        // Captura Lead (Recupera√ß√£o)
        function captureLead(p) {
            if (!p.nome) return;
            fetch('/.netlify/functions/capture-lead', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    nome: p.nome,
                    slug: 'reembolso-passagem',
                    payload: p
                })
            }).catch(err => console.log('Lead capture error', err));
        }

        // PR√âVIA (REEMBOLSO)
        btnPreview.addEventListener('click', async function () {
            if (!checkCooldown()) return;

            btnPreview.disabled = true;
            btnPreview.style.opacity = '0.5';
            btnPreview.style.cursor = 'not-allowed';
            btnPreview.textContent = '‚è≥ Gerando pr√©via...';

            async function tentarGerar(tentativa) {
                var vaiTentarDeNovo = false;
                try {
                    var p = getPayload();
                    if (!validateAll(p)) {
                        alert('Preencha os campos obrigat√≥rios.');
                        btnPreview.disabled = false;
                        btnPreview.style.opacity = '1';
                        btnPreview.style.cursor = 'pointer';
                        btnPreview.textContent = 'Gerar pr√©via gratuita';
                        return;
                    }

                    if (tentativa === 1) captureLead(p);

                    var r = await fetch('/.netlify/functions/generate-doc', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ payload: p, preview: true })
                    });

                    if (r.status === 503 && tentativa === 1) {
                        btnPreview.textContent = '‚Üª Reconectando...';
                        vaiTentarDeNovo = true;
                        await new Promise(res => setTimeout(res, 2000));
                        return tentarGerar(2);
                    }

                    if (!r.ok) throw new Error('Falha');

                    var d = await r.json();
                    var out = d.output || d;
                    var pr = out.corpo_paragrafos || [];
                    var parcial = pr.slice(0, 2).join('\n\n') + '\n\n[...]';

                    previewBox.textContent = (out.saudacao || '') + '\n\n' + parcial;
                    previewWrap.style.display = 'block';

                    // Mostra pagamento e esconde bot√£o de pr√©via
                    paySection.style.display = 'block';
                    document.getElementById('previewBtnArea').style.display = 'none';

                    localStorage.setItem('pendingPayload', JSON.stringify(p));
                    localStorage.setItem('last_preview_ts', Date.now());
                    btnPagar.disabled = false;

                } catch (e) {
                    if (!vaiTentarDeNovo) {
                        if (e.message !== 'Inv√°lido') alert('Erro: ' + e.message);
                        btnPreview.disabled = false;
                        btnPreview.style.opacity = '1';
                        btnPreview.style.cursor = 'pointer';
                        btnPreview.textContent = 'Gerar pr√©via gratuita';
                    }
                }
            }
            tentarGerar(1);
        });

        btnPagar.addEventListener('click', async function () {
            btnPagar.disabled = true;
            btnPagar.textContent = 'Preparando...';
            try {
                var p = getPayload();
                if (!validateAll(p)) {
                    alert('Verifique os campos obrigat√≥rios.');
                    throw new Error('Inv√°lido');
                }
                var r = await fetch('/.netlify/functions/mp-checkout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        slug: 'reembolso-cancelamento-passagem',
                        payload: p,
                        utm: (window.LMUTM ? LMUTM.get() : {})
                    })
                });
                var data = await r.json();
                if (!r.ok) throw new Error(data.error);

                if (typeof gtag === 'function') {
                    gtag('event', 'begin_checkout', {
                        value: 9.9,
                        currency: 'BRL',
                        items: [{ item_id: 'reembolso-cancelamento-passagem' }]
                    });
                }

                showPaymentModal(data.init_point, data.order_id);
            } catch (e) {
                if (e.message !== 'Inv√°lido') alert('Erro: ' + e.message);
                btnPagar.disabled = false;
                btnPagar.textContent = 'Gerar carta completa (R$ 9,90)';
            }
        });

        function showPaymentModal(initPoint, orderId) {
            var isLight = (document.documentElement.getAttribute('data-theme') === 'light');
            var cardBG = isLight ? '#ffffff' : '#111827';
            var cardText = isLight ? '#0f172a' : '#e6eefb';
            var overlay = document.createElement('div');
            overlay.style = 'position:fixed;inset:0;background:rgba(2,6,23,.85);backdrop-filter:blur(4px);z-index:9999;display:flex;align-items:center;justify-content:center';
            overlay.innerHTML =
                '<div style="background:' + cardBG + ';color:' + cardText + ';border:1px solid var(--border);border-radius:16px;max-width:400px;width:90%;padding:24px;box-shadow:0 20px 50px rgba(0,0,0,.4);text-align:center;">' +
                '<div style="font-size:40px;margin-bottom:16px;">üí∏</div>' +
                '<h3 style="margin:0 0 12px;font-size:20px;">Quase l√°!</h3>' +
                '<p style="margin:0 0 20px;line-height:1.5;color:var(--text-secondary);">Clique abaixo para finalizar.</p>' +
                '<div style="display:flex;flex-direction:column;gap:12px;">' +
                '<button id="lm-goPay" class="btn btn-primary" style="width:100%;padding:14px;font-size:16px;justify-content:center;">Ir para Pagamento (Pix/Cart√£o)</button>' +
                '<button id="lm-close" class="btn btn-outline" style="width:100%;justify-content:center;border:none;">Fechar e corrigir</button>' +
                '</div>' +
                '</div>';
            document.body.appendChild(overlay);
            document.getElementById('lm-close').onclick = function () {
                overlay.remove();
                var btn = document.getElementById('btnPagar');
                if (btn) {
                    btn.disabled = false;
                    btn.textContent = 'Gerar carta completa (R$ 9,90)';
                }
            };
            async function docReady() {
                try {
                    var r = await fetch('/.netlify/functions/generate-doc', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ payload: { order_id: orderId }, preview: false })
                    });
                    if (!r.ok) return false;
                    var j = await r.json();
                    return !!(j && j.output);
                } catch (e) { return false; }
            }
            document.getElementById('lm-goPay').onclick = function () {
                window.open(initPoint, '_blank', 'noopener');
                var btn = this;
                btn.textContent = 'Verificando...';
                var iv = setInterval(async function () {
                    try {
                        if (await docReady()) {
                            clearInterval(iv);
                            location.href = '/success.html?o=' + encodeURIComponent(orderId) + '&slug=reembolso-passagem&s=success';
                            return;
                        }
                        var rr = await fetch('/.netlify/functions/order-status?o=' + encodeURIComponent(orderId));
                        var jj = rr.ok ? await rr.json() : null;
                        if (jj && jj.status === 'paid') {
                            clearInterval(iv);
                            location.href = '/success.html?o=' + encodeURIComponent(orderId) + '&slug=reembolso-passagem&s=success';
                        }
                    } catch (e) { }
                }, 3000);
            };
        }
    </script>

    <script>
        (function () {
            // Verifica se a URL tem ?modo=admin
            const params = new URLSearchParams(window.location.search);
            if (params.get('modo') === 'admin') {
                const btnPagar = document.querySelector('[id*="Pagar"], [id*="pagar"]') || document.getElementById('btnPagar');
                if (!btnPagar) return;

                const btnArea = btnPagar.parentElement;

                const btnAdmin = document.createElement('button');
                btnAdmin.className = 'btn';
                btnAdmin.style.backgroundColor = '#8b5cf6';
                btnAdmin.style.color = 'white';
                btnAdmin.style.border = 'none';
                btnAdmin.innerText = 'üëë Gerar Admin';

                btnAdmin.onclick = async function () {
                    const senha = prompt("Digite a senha de Admin:");
                    if (!senha) return;

                    btnAdmin.innerText = 'Gerando...';
                    btnAdmin.disabled = true;

                    try {
                        var p = getPayload();
                        p.admin_key = senha;

                        var r = await fetch('/.netlify/functions/generate-doc', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ payload: p, preview: false })
                        });

                        if (!r.ok) throw new Error('Senha errada ou erro no servidor');

                        var data = await r.json();

                        if (data.output) {
                            let fullText = '';
                            if (data.output.saudacao) fullText += data.output.saudacao + '\n\n';

                            if (Array.isArray(data.output.corpo_paragrafos)) {
                                fullText += data.output.corpo_paragrafos.join('\n\n');
                            } else {
                                fullText += String(data.output.corpo_paragrafos);
                            }

                            if (data.output.fechamento) fullText += '\n\n' + data.output.fechamento;

                            const previewBox = document.getElementById('previewBox');
                            const previewWrap = document.getElementById('previewWrap');

                            if (previewBox && previewWrap) {
                                previewBox.textContent = fullText;
                                previewBox.style.whiteSpace = 'pre-wrap';
                                previewWrap.style.display = 'block';

                                const oldCopyBtn = document.getElementById('admin-copy-btn');
                                if (oldCopyBtn) oldCopyBtn.remove();

                                const copyBtn = document.createElement('button');
                                copyBtn.id = 'admin-copy-btn';
                                copyBtn.className = 'btn btn-primary';
                                copyBtn.style.marginTop = '16px';
                                copyBtn.innerText = 'üìã Copiar Documento';
                                copyBtn.onclick = async function () {
                                    await navigator.clipboard.writeText(fullText);
                                    copyBtn.innerText = '‚úÖ Copiado!';
                                    setTimeout(() => { copyBtn.innerText = 'üìã Copiar Documento'; }, 2000);
                                };
                                previewWrap.appendChild(copyBtn);

                                previewWrap.scrollIntoView({ behavior: 'smooth', block: 'start' });

                                alert("‚úÖ Documento Admin Gerado!\n\nRole para baixo para copiar.");
                            } else {
                                alert("‚úÖ Documento Gerado!\n\n" + fullText.substring(0, 500) + "...\n\n(Copie do console)");
                                console.log(fullText);
                            }
                        }

                    } catch (e) {
                        alert('‚ùå Erro: ' + e.message);
                    } finally {
                        btnAdmin.innerText = 'üëë Gerar Admin';
                        btnAdmin.disabled = false;
                    }
                };

                btnArea.appendChild(btnAdmin);
            }
        })();
    </script>
</body>

</html>

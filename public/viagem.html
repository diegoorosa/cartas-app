<!doctype html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <title>Gerador de Autoriza√ß√£o de Viagem para Menor | CartasApp</title>
    <meta name="description"
        content="Crie sua autoriza√ß√£o de viagem para menor (nacional ou internacional) em minutos. Preencha os dados, pague R$ 9,90 e baixe o PDF/DOC pronto para assinar." />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <script src="/theme.js"></script>
    <link rel="stylesheet" href="/style.css" />

    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-1021062139"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'AW-1021062139');
        gtag('config', 'G-D40QPP9KNP');
    </script>
    <script src="/gtag.js"></script>
    <script
        type="text/javascript">(function (c, l, a, r, i, t, y) { c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) }; t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i; y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y); })(window, document, "clarity", "script", "u4x90t35gk");</script>

    <link rel="canonical" href="https://www.cartasapp.com.br/viagem.html" />

    <script type="application/ld+json">
    {
      "@context": "https://schema.org/",
      "@type": "Product",
      "name": "Gerador de Autoriza√ß√£o de Viagem para Menor",
      "image": "https://www.cartasapp.com.br/logo.png",
      "description": "Gere a autoriza√ß√£o de viagem nacional ou internacional para menor desacompanhado ou com apenas um dos pais. Documento pronto em PDF/DOC.",
      "brand": { "@type": "Brand", "name": "CartasApp" },
      "offers": {
        "@type": "Offer",
        "url": "https://www.cartasapp.com.br/viagem.html",
        "priceCurrency": "BRL",
        "price": "9.90",
        "priceValidUntil": "2026-12-31",
        "availability": "https://schema.org/InStock",
        "category": "LegalService"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.9",
        "ratingCount": "342",
        "bestRating": "5",
        "worstRating": "1"
      }
    }
    </script>
</head>

<body>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-content">
                <a href="/" class="logo">CartasApp</a>
                <div class="nav-actions">
                    <button class="btn-theme" onclick="toggleTheme()" aria-label="Alternar tema">üåô</button>
                    <a href="https://wa.me/5547988616874" class="btn btn-secondary btn-sm" target="_blank">WhatsApp</a>
                </div>
            </div>
        </div>
    </nav>

    <section class="hero" style="padding: 60px 0 40px;">
        <div class="container">
            <div class="hero-content">
                <div class="hero-badge">‚úàÔ∏è Modelo baseado nas regras da Pol√≠cia Federal e do CNJ</div>
                <h1 style="font-size: 42px; line-height: 1.2;">
                    Autoriza√ß√£o de viagem para menor em at√© 3 minutos
                </h1>
                <p class="hero-subtitle" style="font-size: 18px; margin-top: 16px;">
                    Preencha os dados, pague <strong>apenas R$ 9,90</strong> e baixe um
                    <strong>modelo de autoriza√ß√£o</strong> alinhado √†s orienta√ß√µes da Pol√≠cia Federal e √†
                    <strong>Resolu√ß√£o CNJ n¬∫ 295/2019</strong> (PDF e Word), pronto para
                    assinar e reconhecer firma em cart√≥rio.
                </p>
                <p class="small"
                    style="margin-top:4px;color:var(--text-muted);max-width:720px;margin-left:auto;margin-right:auto;">
                    A aceita√ß√£o do documento depende da an√°lise da <strong>Pol√≠cia Federal</strong>, do
                    <strong>cart√≥rio</strong> e da <strong>companhia de transporte</strong>, especialmente em viagens
                    internacionais.
                </p>
                <p class="small" style="margin-top:8px;color:var(--text-muted);">
                    Voc√™ v√™ uma <strong>pr√©via gratuita do texto</strong> antes de decidir pagar.
                </p>

                <div class="hero-actions" style="margin-top: 24px;">
                    <a href="#formArea" class="btn btn-primary">
                        Come√ßar agora (leva cerca de 3 minutos)
                    </a>
                    <a href="/autorizacao-viagem-faq.html" class="btn btn-secondary btn-sm"
                        style="border-radius: 50px; font-size: 14px;">
                        ‚ùì Ver perguntas frequentes
                    </a>
                </div>

                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 16px; flex-wrap: wrap;">
                    <span
                        style="background: rgba(16, 185, 129, 0.1); color: #10b981; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 600;">üìÑ
                        Modelo usado em diversas cidades do Brasil</span>
                    <span
                        style="background: rgba(59, 130, 246, 0.1); color: #3b82f6; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 600;">üõ°Ô∏è
                        Pagamento seguro via Mercado Pago</span>
                    <span
                        style="background: rgba(234, 179, 8, 0.12); color: #eab308; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 600;">üí∞
                        Pagamento √∫nico, sem mensalidade</span>
                </div>

                <p class="small"
                    style="margin-top:8px;color:var(--text-secondary);max-width:720px;margin-left:auto;margin-right:auto;text-align:center;">
                    Sem a autoriza√ß√£o correta, a companhia a√©rea ou a Pol√≠cia Federal podem
                    impedir o embarque do menor, mesmo com as passagens compradas.
                    Este modelo ajuda a organizar a autoriza√ß√£o, mas √© responsabilidade do respons√°vel
                    conferir as exig√™ncias oficiais para o seu caso espec√≠fico.
                </p>

                <div style="margin-top: 6px; font-size: 13px; color: var(--text-muted);">
                    ‚≠êÔ∏è <strong>4,9 de 5</strong> ‚Äî baseado em mais de 340 autoriza√ß√µes geradas por pais e respons√°veis.
                </div>
            </div>
        </div>
    </section>

    <section class="section" style="padding-top: 0;">
        <div class="container">
            <div style="max-width: 800px; margin: 0 auto;">
                <div class="card">

                    <div class="small"
                        style="margin-bottom: 16px; padding: 12px 14px; border-radius: 10px; background: var(--card-hover); border: 1px solid var(--border);">
                        <strong>Aviso jur√≠dico importante:</strong><br>
                        O CartasApp fornece um <strong>modelo de autoriza√ß√£o de viagem</strong> preenchido
                        automaticamente com os dados informados por voc√™. N√£o prestamos
                        assessoria jur√≠dica individual nem analisamos situa√ß√µes espec√≠ficas de guarda,
                        lit√≠gio ou documenta√ß√£o.
                        A <strong>aceita√ß√£o do documento n√£o √© garantida</strong> e pode variar conforme o cart√≥rio,
                        a companhia de transporte, a Pol√≠cia Federal e, em viagens internacionais, tamb√©m conforme
                        o consulado e as autoridades do pa√≠s de destino.
                        Em caso de d√∫vida ou situa√ß√µes complexas (como desacordo entre os pais), consulte um advogado
                        ou a Vara da Inf√¢ncia e Juventude.
                    </div>

                    <p class="small" style="margin-bottom:16px;color:var(--text-muted);">
                        N√£o precisa criar conta nem fazer login. Tenha em m√£os apenas:
                        os dados do menor, de quem vai acompanhar na viagem, as datas de ida e volta e a
                        cidade onde a autoriza√ß√£o ser√° assinada.
                    </p>

                    <div id="formArea">
                        <div class="step-indicator">
                            <div class="step-item" data-step="1">1. Menor e viagem</div>
                            <div class="step-item" data-step="2">2. Acompanhante</div>
                            <div class="step-item" data-step="3">3. Respons√°veis</div>
                            <div class="step-item" data-step="4">4. Local e contatos</div>
                        </div>

                        <div class="form-step" data-step="1" id="step-1">
                            <h2 class="section-title" style="font-size: 24px; margin-bottom: 16px;">Dados do menor</h2>

                            <label class="label">Nome completo do menor <span class="required-star">*</span></label>
                            <input class="input" id="menor_nome" placeholder="Ex.: Ana Souza" />

                            <label class="label">Data de nascimento <span class="required-star">*</span></label>
                            <input class="input" id="menor_nascimento" placeholder="DD/MM/AAAA" inputmode="numeric"
                                maxlength="10" />
                            <div id="err_menor_nascimento" class="small"
                                style="display:none;color:#fca5a5;margin-top:4px;">
                                Data inv√°lida.</div>

                            <label class="label">Documento do menor (Opcional)</label>
                            <input class="input" id="menor_doc"
                                placeholder="Ex.: Certid√£o, RG, Passaporte ou CPF (se CIN)" />
                            <p class="small" style="margin-top: 4px;">
                                Informe o documento que a crian√ßa usar√° para embarcar.
                                Se deixar em branco, o campo sair√° sublinhado no documento para voc√™ preencher
                                √† caneta antes de reconhecer firma.
                            </p>

                            <h2 class="section-title" style="font-size: 24px; margin: 24px 0 16px;">Viagem</h2>

                            <label class="label">Tipo da viagem <span class="required-star">*</span></label>
                            <select class="input" id="viagem_tipo">
                                <option value="nacional">Nacional</option>
                                <option value="internacional">Internacional</option>
                            </select>
                            <p id="viagem_tipo_aviso" class="small" style="margin-top:8px;color:var(--text-muted);">
                            </p>

                            <label class="label">Destino <span class="required-star">*</span></label>
                            <input class="input" id="destino" placeholder="Ex.: Curitiba/PR ou Lisboa/Portugal" />

                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:20px;">
                                <div>
                                    <label class="label">Data de ida <span class="required-star">*</span></label>
                                    <input class="input" id="data_ida" placeholder="DD/MM/AAAA" inputmode="numeric"
                                        maxlength="10" />
                                    <div id="err_data_ida" class="small"
                                        style="display:none;color:#fca5a5;margin-top:4px;">
                                        Data inv√°lida.</div>
                                </div>
                                <div>
                                    <label class="label">Data de volta <span class="required-star">*</span></label>
                                    <input class="input" id="data_volta" placeholder="DD/MM/AAAA" inputmode="numeric"
                                        maxlength="10" />
                                    <div id="err_data_volta" class="small"
                                        style="display:none;color:#fca5a5;margin-top:4px;">Data inv√°lida.</div>
                                </div>
                            </div>

                            <div class="form-navigation">
                                <span class="small" style="align-self:center;color:var(--text-muted);">
                                    Campos marcados com <span class="required-star">*</span> s√£o obrigat√≥rios.
                                </span>
                                <button type="button" class="btn btn-primary" id="nextStep1">
                                    Pr√≥ximo passo
                                </button>
                            </div>
                        </div>

                        <div class="form-step" data-step="2" id="step-2">
                            <h2 class="section-title" style="font-size: 24px; margin-bottom: 16px;">Acompanhante</h2>
                            <p class="small" style="margin-top:-8px;margin-bottom:12px;">
                                Se a crian√ßa viajar desacompanhada, escolha essa op√ß√£o e n√£o ser√° necess√°rio preencher
                                os
                                dados do acompanhante.
                            </p>

                            <label class="label">Quem viajar√° com o menor? <span class="required-star">*</span></label>
                            <select class="input" id="acompanhante_tipo">
                                <option value="outro_responsavel">A M√£e / O Pai (outro respons√°vel)</option>
                                <option value="terceiro">Um Parente / Terceiro (Tio, Av√≥, etc.)</option>
                                <option value="desacompanhado">Desacompanhado</option>
                            </select>

                            <div id="acompanhanteBox"
                                style="margin-top:20px; background: var(--bg-secondary); padding: 16px; border-radius: 12px;">
                                <label class="label" style="margin-top: 0;">Nome completo do Acompanhante
                                    <span class="required-star">*</span>
                                </label>
                                <input class="input" id="acomp_nome" placeholder="Ex.: Maria Souza (M√£e)" />

                                <label class="label">CPF do Acompanhante (Opcional)</label>
                                <input class="input" id="acomp_cpf" placeholder="000.000.000-00" inputmode="numeric"
                                    maxlength="14" />
                                <div id="err_acomp_cpf" class="small"
                                    style="display:none;color:#fca5a5;margin-top:4px;">CPF inv√°lido.</div>
                                <p class="small" style="margin-top:4px;">
                                    Se n√£o souber o CPF agora, deixe em branco e preencha no pr√≥prio documento impresso.
                                </p>

                                <label class="label">Documento do Acompanhante (Opcional)</label>
                                <input class="input" id="acomp_doc"
                                    placeholder="Ex.: RG, CNH, Passaporte ou deixe em branco" />

                                <label class="label">Parentesco com o menor
                                    <span class="required-star">*</span>
                                </label>
                                <input class="input" id="acomp_parentesco" placeholder="Ex.: M√£e, Tia, Av√≥" />
                            </div>

                            <div class="form-navigation">
                                <button type="button" class="btn btn-secondary" id="prevStep2">
                                    Voltar
                                </button>
                                <button type="button" class="btn btn-primary" id="nextStep2">
                                    Pr√≥ximo passo
                                </button>
                            </div>
                        </div>

                        <div class="form-step" data-step="3" id="step-3">
                            <h2 class="section-title" style="font-size: 24px; margin-bottom: 16px;">
                                Respons√°vel(veis) que AUTORIZAM (assinam)
                            </h2>
                            <p class="small" style="margin-top: -8px; margin-bottom: 8px;">
                                Preencha os dados de quem vai assinar (ex: o pai que n√£o vai viajar).
                            </p>
                            <p class="small" style="margin-bottom: 16px;">
                                Os campos de <strong>CPF e documento</strong> podem ser deixados em branco e preenchidos
                                √† caneta no documento impresso, antes de reconhecer firma.
                            </p>

                            <label class="label">Respons√°vel 1 ‚Äî Nome completo
                                <span class="required-star">*</span>
                            </label>
                            <input class="input" id="resp1_nome" placeholder="Ex.: Jo√£o Souza (Pai)" />

                            <label class="label">Respons√°vel 1 ‚Äî CPF (Opcional)</label>
                            <input class="input" id="resp1_cpf" placeholder="000.000.000-00" inputmode="numeric"
                                maxlength="14" />
                            <div id="err_resp1_cpf" class="small" style="display:none;color:#fca5a5;margin-top:4px;">CPF
                                inv√°lido.
                            </div>

                            <label class="label">Respons√°vel 1 ‚Äî Documento (Opcional)</label>
                            <input class="input" id="resp1_doc"
                                placeholder="Ex.: RG, CNH, Passaporte ou deixe em branco" />

                            <label class="label">Parentesco
                                <span class="required-star">*</span>
                            </label>
                            <select class="input" id="resp1_parentesco">
                                <option>Pai</option>
                                <option>M√£e</option>
                                <option>Respons√°vel legal</option>
                                <option>Tutor(a)</option>
                            </select>

                            <div style="margin-top:20px;padding:16px;background:var(--card-hover);border-radius:12px;">
                                <label class="small" style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                                    <input type="checkbox" id="dois_resps"
                                        style="width:18px;height:18px;cursor:pointer;" />
                                    <span>Dois respons√°veis assinam a autoriza√ß√£o</span>
                                </label>
                            </div>

                            <div id="resp2Box" style="display:none;margin-top:24px;">
                                <h3 style="font-size: 20px; margin-bottom: 20px; color: var(--text-primary);">
                                    Respons√°vel 2
                                </h3>
                                <label class="label">Nome completo</label>
                                <input class="input" id="resp2_nome" placeholder="Ex.: Maria Souza" />

                                <label class="label">CPF (Opcional)</label>
                                <input class="input" id="resp2_cpf" placeholder="000.000.000-00" inputmode="numeric"
                                    maxlength="14" />
                                <div id="err_resp2_cpf" class="small"
                                    style="display:none;color:#fca5a5;margin-top:4px;">CPF inv√°lido.</div>

                                <label class="label">Documento (Opcional)</label>
                                <input class="input" id="resp2_doc"
                                    placeholder="Ex.: RG, CNH, Passaporte ou deixe em branco" />

                                <label class="label">Parentesco</label>
                                <select class="input" id="resp2_parentesco">
                                    <option>M√£e</option>
                                    <option>Pai</option>
                                </select>
                            </div>

                            <div class="form-navigation">
                                <button type="button" class="btn btn-secondary" id="prevStep3">
                                    Voltar
                                </button>
                                <button type="button" class="btn btn-primary" id="nextStep3">
                                    Pr√≥ximo passo
                                </button>
                            </div>
                        </div>

                        <div class="form-step" data-step="4" id="step-4">
                            <h2 class="section-title" style="font-size: 24px; margin-bottom: 16px;">Local e contatos
                            </h2>

                            <label class="label">Cidade/UF de emiss√£o
                                <span class="required-star">*</span>
                            </label>
                            <input class="input" id="cidade_uf_emissao" placeholder="Ex.: Blumenau/SC" />

                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:20px;">
                                <div>
                                    <label class="label">E-mail (opcional)</label>
                                    <input class="input" id="email" placeholder="Ex.: seu@email.com" />
                                </div>
                                <div>
                                    <label class="label">Telefone (opcional)</label>
                                    <input class="input" id="telefone" placeholder="Ex.: (47) 99999-9999" />
                                </div>
                            </div>

                            <p class="small" style="margin-top:12px;">
                                O e-mail e telefone s√£o opcionais e usados apenas para enviar o documento e, se
                                necess√°rio, contato de suporte.
                            </p>

                            <div class="form-navigation">
                                <button type="button" class="btn btn-secondary" id="prevStep4">
                                    Voltar
                                </button>
                                <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:flex-end;">
                                    <button class="btn btn-primary" id="btnPreview"
                                        style="background-color: #28a745; border-color: #28a745; font-size: 1.1em; padding: 12px 24px;">
                                        üìÑ Ver Documento Pronto (Pr√©via)
                                    </button>
                                </div>
                            </div>
                            <p class="small" style="margin-top:8px;color:var(--text-muted);">
                                Voc√™ ver√° um trecho do documento antes de decidir pagar. A pr√©via √© gratuita.
                            </p>

                            <div id="paySection"
                                style="display:none; margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border);">

                                <div class="small"
                                    style="margin-bottom: 16px; padding: 12px 14px; border-radius: 10px; background: var(--bg-secondary); border: 1px solid var(--border);">
                                    <p style="margin:0 0 8px;">
                                        <strong>Antes de pagar, leia com aten√ß√£o:</strong>
                                    </p>
                                    <ul style="margin:0 0 8px 18px; padding:0; list-style:disc;">
                                        <li>O CartasApp apenas gera um <strong>modelo de autoriza√ß√£o</strong> com os
                                            dados informados por voc√™; n√£o fazemos confer√™ncia jur√≠dica do caso.</li>
                                        <li>A <strong>aceita√ß√£o do documento n√£o √© garantida</strong> e depende da
                                            Pol√≠cia Federal, da companhia a√©rea/rodovi√°ria, do cart√≥rio e, em viagens
                                            internacionais, tamb√©m de consulados e autoridades do pa√≠s de destino.</li>
                                        <li>Para <strong>viagens internacionais</strong> podem ser exigidos documentos
                                            adicionais (por exemplo: passaporte v√°lido, autoriza√ß√£o bil√≠ngue,
                                            reconhecimento
                                            de firma por autenticidade ou autoriza√ß√£o judicial espec√≠fica).</li>
                                    </ul>
                                    <input type="hidden" id="terms_version" value="viagem-2025-02-v1">
                                    <label class="small"
                                        style="display:flex;align-items:flex-start;gap:8px;cursor:pointer;">
                                        <input type="checkbox" id="aceite_termos"
                                            style="margin-top:2px;min-width:18px;min-height:18px;cursor:pointer;" />
                                        <span>Declaro que li e compreendi as informa√ß√µes acima e os
                                            <a href="/termos.html" target="_blank" class="footer-link">Termos de
                                                Uso</a>,
                                            sabendo que este servi√ßo n√£o garante o embarque do menor.</span>
                                    </label>
                                </div>

                                <div class="price-badge" style="margin-bottom: 20px;">
                                    Oferta hoje: <span class="price-old">de R$ 29,90</span> <span class="price-new">por
                                        R$ 9,90</span>
                                    <span class="timer-text">‚ö° O pre√ßo pode voltar ao normal em breve</span>
                                </div>

                                <button class="btn btn-primary" id="btnPagar" style="width: 100%;">
                                    Gerar documento completo (R$ 9,90)
                                </button>

                                <div class="guarantee-badge">
                                    <span class="guarantee-icon">üîí</span>
                                    <div>
                                        <strong>Garantia de entrega:</strong> Se o documento n√£o for gerado ou enviado
                                        corretamente, devolvemos seu dinheiro.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="previewWrap"
                        style="display:none; margin-top:32px; padding-top:32px; border-top:1px dashed var(--border);">

                        <div style="display:flex; align-items:center; gap:10px; margin-bottom: 16px;">
                            <span style="font-size: 24px;">üëÄ</span>
                            <h2 class="section-title" style="margin:0; font-size: 22px; color: var(--text-primary);">
                                Confira abaixo como ficou:
                            </h2>
                        </div>

                        <div
                            style="background:#f8fafc; border:2px solid #e2e8f0; border-radius:12px; padding:24px; position:relative;">
                            <div
                                style="position:absolute; top:10px; right:10px; background:#e2e8f0; color:#64748b; padding:4px 8px; font-size:10px; border-radius:4px; font-weight:bold; text-transform:uppercase;">
                                Pr√©via
                            </div>

                            <div id="previewBox"
                                style="white-space:pre-wrap; font-family:'Courier New', Courier, monospace; font-size:14px; line-height:1.6; color:#334155;">
                            </div>
                        </div>

                        <div
                            style="background-color: #fffbeb; color: #92400e; padding: 16px; border-radius: 8px; margin-top: 16px; font-size: 14px; border: 1px solid #fcd34d; display:flex; gap:12px; align-items:start;">
                            <span style="font-size: 18px;">üîí</span>
                            <div>
                                <strong>Esta √© uma visualiza√ß√£o parcial.</strong><br>
                                O documento final (completo, sem cortes e pronto para imprimir em PDF/Word) ser√°
                                liberado imediatamente ap√≥s a confirma√ß√£o do pagamento acima.
                            </div>
                        </div>
                    </div>

                    <div style="margin-top:32px; padding-top:24px; border-top:1px solid var(--border);">
                        <div
                            style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                            <p class="small" style="margin: 0; color: var(--text-secondary);">
                                <strong>Documentos aceitos para embarque (em regra):</strong><br>
                                ‚Ä¢ Crian√ßa (Nacional): Certid√£o de Nascimento ou RG.<br>
                                ‚Ä¢ Crian√ßa (Internacional): Passaporte (ou RG para Mercosul).<br>
                                ‚Ä¢ Adultos: RG, CNH, Passaporte ou Carteira de Trabalho.<br>
                                <span style="opacity:.8;">As exig√™ncias podem variar conforme a companhia de transporte
                                    e as autoridades do pa√≠s de destino.</span>
                            </p>
                        </div>

                        <div class="small legal-note" style="margin-bottom: 16px;">
                            <p class="small" style="margin: 0;">
                                ‚Ä¢ Texto elaborado com base na <strong>Resolu√ß√£o CNJ n¬∫ 295/2019</strong> e nas
                                exig√™ncias da
                                <strong>Pol√≠cia Federal</strong> (modelo de uso geral, que n√£o substitui orienta√ß√£o
                                jur√≠dica
                                individual).<br>
                                ‚Ä¢ Serve para viagens <strong>nacionais e internacionais</strong>, com um dos pais,
                                terceiros
                                ou desacompanhado, desde que respeitadas as regras espec√≠ficas de cada √≥rg√£o.<br>
                                ‚Ä¢ Documento em <strong>PDF e Word</strong>, pronto para imprimir, assinar e reconhecer
                                firma
                                em cart√≥rio.
                            </p>
                        </div>

                        <div class="small"
                            style="margin-bottom: 24px; padding: 12px 14px; border-radius: 10px; background: var(--card-hover); border: 1px solid var(--border);">
                            <strong>Por R$ 9,90 (pagamento √∫nico)</strong>, voc√™ recebe:<br>
                            ‚Ä¢ Autoriza√ß√£o personalizada com os seus dados.<br>
                            ‚Ä¢ Arquivos em PDF e Word para editar, imprimir e assinar.<br>
                            ‚Ä¢ Suporte por WhatsApp em caso de d√∫vidas sobre o uso do modelo.
                        </div>
                    </div>

                    <div style="margin-top:32px;border-top:1px solid var(--border);padding-top:24px;">
                        <h2 class="section-title" style="font-size: 22px; margin-bottom: 16px;">
                            O que outros pais dizem
                        </h2>
                        <div class="small" style="margin-bottom:12px;">
                            ‚ÄúConsegui gerar a autoriza√ß√£o em poucos minutos, reconheci firma no cart√≥rio e meu filho
                            embarcou sem problema nenhum.‚Äù<br>
                            <strong>Ana, m√£e do Pedro (6 anos) ‚Äì Curitiba/PR</strong>
                        </div>
                        <div class="small" style="margin-bottom:20px;">
                            ‚ÄúUsei para viagem internacional com minha filha. O modelo veio completo, s√≥ preenchi alguns
                            dados e levei no cart√≥rio.‚Äù<br>
                            <strong>Marcelo, pai da Laura (9 anos) ‚Äì S√£o Paulo/SP</strong>
                        </div>

                        <h2 class="section-title" style="font-size: 22px; margin-bottom: 12px;">
                            Perguntas r√°pidas
                        </h2>

                        <p class="small">
                            <strong>Preciso ir ao cart√≥rio depois de gerar?</strong><br>
                            Sim. O CartasApp entrega o documento pronto (redigido e formatado). Voc√™ deve imprimir e
                            levar ao cart√≥rio apenas para <strong>reconhecer a firma</strong> da sua assinatura. Esse
                            "selo" do cart√≥rio √© o que garante a validade legal para o embarque em viagens
                            interestaduais ou internacionais.
                        </p>

                        <p class="small" style="margin-top:12px;">
                            <strong>Quantas vias (c√≥pias) devo imprimir?</strong><br>
                            A regra oficial exige <strong>2 vias originais</strong>.
                            <br>‚Ä¢ <strong>1¬™ Via:</strong> Fica retida com a companhia de transporte no momento do
                            embarque (arquivo deles).
                            <br>‚Ä¢ <strong>2¬™ Via:</strong> Segue viagem com a crian√ßa/acompanhante para servir de
                            documento de porte obrigat√≥rio (para fiscaliza√ß√£o policial ou retorno).
                        </p>

                        <p class="small" style="margin-top:12px;">
                            <strong>Este modelo √© aceito pela Pol√≠cia Federal?</strong><br>
                            O texto segue rigorosamente a <strong>Resolu√ß√£o CNJ n¬∫ 295/2019</strong>. Na pr√°tica, √©
                            aceito quando apresentado <strong>impresso, em duas vias e com firmas reconhecidas</strong>.
                            Por√©m, a aceita√ß√£o final cabe sempre √† autoridade do embarque. Em viagens internacionais,
                            verifique se o pa√≠s de destino exige tradu√ß√£o juramentada ou autoriza√ß√£o judicial
                            espec√≠fica.
                        </p>

                        <p class="small" style="margin-top:12px;">
                            <strong>Serve para viagem de avi√£o, √¥nibus ou carro?</strong><br>
                            Sim. Serve para qualquer meio de transporte (aeroportos, rodovi√°rias ou fiscaliza√ß√£o em
                            rodovias) onde seja exigida a comprova√ß√£o de autoriza√ß√£o para menor viajar desacompanhado ou
                            com terceiros.
                        </p>

                        <p class="small" style="margin-top:12px;">
                            <strong>√â pagamento √∫nico ou assinatura?</strong><br>
                            √â pagamento √∫nico de <strong>R$ 9,90 por documento</strong>, sem mensalidade.
                        </p>

                        <p class="small" style="margin-top:12px;">
                            <strong>Ainda com d√∫vidas?</strong><br>
                            Fale conosco pelo WhatsApp (bot√£o no canto da tela) antes de pagar. Para casos complexos
                            (lit√≠gio, pai falecido, guarda n√£o oficializada), recomendamos consultar a Vara da Inf√¢ncia
                            e Juventude.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p>
                    Este site n√£o presta aconselhamento jur√≠dico. Leia os
                    <a href="/termos.html" class="footer-link">Termos de Uso</a>,
                    <a href="/privacidade.html" class="footer-link">Pol√≠tica de Privacidade</a>,
                    conhe√ßa mais em
                    <a href="/sobre.html" class="footer-link">Sobre o CartasApp</a>
                    e visite nossa
                    <a href="/blog.html" class="footer-link">Central de Ajuda</a>.
                </p>
            </div>
        </div>
    </footer>

    <a href="https://wa.me/5547988616874?text=Ol%C3%A1!%20Preciso%20de%20ajuda%20no%20CartasApp." class="whatsapp-float"
        target="_blank" aria-label="Falar no WhatsApp">
        <svg viewBox="0 0 24 24" class="whatsapp-icon">
            <path
                d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z" />
        </svg>
    </a>

    <script src="/utm.js"></script>
    <script src="/recovery.js"></script>

    <script>
        function maskCPF(v) { v = (v || '').replace(/\D/g, '').slice(0, 11); v = v.replace(/(\d{3})(\d)/, '$1.$2'); v = v.replace(/(\d{3})(\d)/, '$1.$2'); v = v.replace(/(\d{3})(\d{1,2})$/, '$1-$2'); return v; }
        function isValidCPF(cpf) { var s = (cpf || '').replace(/\D/g, ''); if (s.length !== 11) return false; if (/^(\d)\1{10}$/.test(s)) return false; var i, sum = 0, rest; for (i = 1; i <= 9; i++) sum += parseInt(s.substring(i - 1, i)) * (11 - i); rest = (sum * 10) % 11; if (rest === 10 || rest === 11) rest = 0; if (rest !== parseInt(s.substring(9, 10))) return false; sum = 0; for (i = 1; i <= 10; i++) sum += parseInt(s.substring(i - 1, i)) * (12 - i); rest = (sum * 10) % 11; if (rest === 10 || rest === 11) rest = 0; if (rest !== parseInt(s.substring(10, 11))) return false; return true; }
        function maskDate(v) { v = (v || '').replace(/\D/g, '').slice(0, 8); if (v.length >= 5) v = v.replace(/(\d{2})(\d{2})(\d{1,4})/, '$1/$2/$3'); else if (v.length >= 3) v = v.replace(/(\d{2})(\d{1,2})/, '$1/$2'); return v; }
        function isValidDateBR(s) { if (!/^\d{2}\/\d{2}\/\d{4}$/.test(s || '')) return false; var d = parseInt(s.substr(0, 2), 10), m = parseInt(s.substr(3, 2), 10), y = parseInt(s.substr(6, 4), 10); if (y < 1900 || y > 2100 || m < 1 || m > 12 || d < 1 || d > 31) return false; var md = [31, (y % 4 === 0 && y % 100 !== 0) || y % 400 === 0 ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]; if (d > md[m - 1]) return false; return true; }
        function dateToISO(s) { var d = s.substr(0, 2), m = s.substr(3, 2), y = s.substr(6, 4); return y + '-' + m + '-' + d; }

        var ids = ['menor_nome', 'menor_nascimento', 'menor_doc', 'viagem_tipo', 'destino', 'data_ida', 'data_volta', 'acompanhante_tipo', 'acomp_nome', 'acomp_cpf', 'acomp_doc', 'acomp_parentesco', 'resp1_nome', 'resp1_cpf', 'resp1_doc', 'resp1_parentesco', 'dois_resps', 'resp2_nome', 'resp2_cpf', 'resp2_doc', 'resp2_parentesco', 'cidade_uf_emissao', 'email', 'telefone'];
        var SAVE_KEY = 'viagem_form_v2';

        function saveForm() {
            var o = {};
            for (var i = 0; i < ids.length; i++) {
                var el = document.getElementById(ids[i]);
                if (!el) continue;
                if (el.type === 'checkbox') o[ids[i]] = el.checked;
                else o[ids[i]] = el.value;
            }
            localStorage.setItem(SAVE_KEY, JSON.stringify(o));
        }
        function loadForm() {
            try {
                var o = JSON.parse(localStorage.getItem(SAVE_KEY) || '{}'); for (var k in o) {
                    var el = document.getElementById(k); if (!el) continue; if (k === 'acompanhado_por' && o[k]) {
                        var map = { 'nenhum': 'desacompanhado', 'resp1': 'outro_responsavel', 'resp2': 'outro_responsavel', 'terceiro': 'terceiro' };
                        document.getElementById('acompanhante_tipo').value = map[o[k]] || 'outro_responsavel';
                    } else if (el.type === 'checkbox') { el.checked = !!o[k]; } else { el.value = o[k]; } el.dispatchEvent(new Event('change'));
                }
            } catch (e) { }
        }
        function attachAutosave() { for (var i = 0; i < ids.length; i++) { var el = document.getElementById(ids[i]); if (!el) continue; el.addEventListener('input', saveForm); el.addEventListener('change', saveForm); } }

        var resp1_cpf = document.getElementById('resp1_cpf');
        var resp2_cpf = document.getElementById('resp2_cpf');
        var acomp_cpf = document.getElementById('acomp_cpf');
        if (resp1_cpf) { resp1_cpf.addEventListener('input', function () { this.value = maskCPF(this.value); }); }
        if (resp2_cpf) { resp2_cpf.addEventListener('input', function () { this.value = maskCPF(this.value); }); }
        if (acomp_cpf) { acomp_cpf.addEventListener('input', function () { this.value = maskCPF(this.value); }); }

        var dIds = ['menor_nascimento', 'data_ida', 'data_volta'];
        for (var i = 0; i < dIds.length; i++) { var e = document.getElementById(dIds[i]); if (e) { e.addEventListener('input', function (ev) { ev.target.value = maskDate(ev.target.value); }); } }

        // Aviso din√¢mico para tipo de viagem
        var tipoViagemSel = document.getElementById('viagem_tipo');
        var avisoTipoViagem = document.getElementById('viagem_tipo_aviso');
        function updateAvisoTipoViagem() {
            if (!tipoViagemSel || !avisoTipoViagem) return;
            if (tipoViagemSel.value === 'internacional') {
                avisoTipoViagem.textContent =
                    'Para viagens internacionais, al√©m da autoriza√ß√£o, costumam ser exigidos passaporte v√°lido (ou RG para alguns pa√≠ses) e, em certos casos, documentos adicionais, autoriza√ß√£o judicial ou documento em outro idioma. Sempre confirme com a Pol√≠cia Federal, a companhia a√©rea e o consulado do pa√≠s de destino.';
            } else {
                avisoTipoViagem.textContent =
                    'Para viagens nacionais, verifique tamb√©m as regras da companhia a√©rea/rodovi√°ria e tenha em m√£os os documentos originais do menor e dos respons√°veis.';
            }
        }
        if (tipoViagemSel) {
            tipoViagemSel.addEventListener('change', updateAvisoTipoViagem);
        }
        updateAvisoTipoViagem();

        var acompSel = document.getElementById('acompanhante_tipo');
        var acompanhanteBox = document.getElementById('acompanhanteBox');
        acompSel.addEventListener('change', function () {
            acompanhanteBox.style.display = (this.value === 'terceiro' || this.value === 'outro_responsavel') ? 'block' : 'none';
        });

        var dois = document.getElementById('dois_resps');
        var resp2Box = document.getElementById('resp2Box');
        dois.addEventListener('change', function () { resp2Box.style.display = this.checked ? 'block' : 'none'; });

        function getPayload() {
            if (resp1_cpf) resp1_cpf.value = maskCPF(resp1_cpf.value);
            if (resp2_cpf) resp2_cpf.value = maskCPF(resp2_cpf.value);
            if (acomp_cpf) acomp_cpf.value = maskCPF(acomp_cpf.value);

            return {
                slug: 'autorizacao-viagem-menor',
                tipo: 'autorizacao_viagem',
                entidade: 'Viagem',
                menor_nome: document.getElementById('menor_nome').value.trim(),
                menor_nascimento: document.getElementById('menor_nascimento').value.trim(),
                menor_doc: document.getElementById('menor_doc').value.trim(),
                viagem_tipo: document.getElementById('viagem_tipo').value,
                destino: document.getElementById('destino').value.trim(),
                data_ida: document.getElementById('data_ida').value.trim(),
                data_volta: document.getElementById('data_volta').value.trim(),
                acompanhante_tipo: document.getElementById('acompanhante_tipo').value,
                acompanhante_nome: document.getElementById('acomp_nome').value.trim(),
                acompanhante_cpf: document.getElementById('acomp_cpf').value.trim(),
                acompanhante_doc: document.getElementById('acomp_doc').value.trim(),
                acompanhante_parentesco: document.getElementById('acomp_parentesco').value.trim(),
                resp1_nome: document.getElementById('resp1_nome').value.trim(),
                resp1_cpf: document.getElementById('resp1_cpf').value.trim(),
                resp1_doc: document.getElementById('resp1_doc').value.trim(),
                resp1_parentesco: document.getElementById('resp1_parentesco').value,
                dois_resps: document.getElementById('dois_resps').checked,
                resp2_nome: document.getElementById('resp2_nome').value.trim(),
                resp2_cpf: document.getElementById('resp2_cpf').value.trim(),
                resp2_doc: document.getElementById('resp2_doc').value.trim(),
                resp2_parentesco: document.getElementById('resp2_parentesco').value,
                cidade_uf_emissao: document.getElementById('cidade_uf_emissao').value.trim(),
                email: document.getElementById('email').value.trim(),
                telefone: document.getElementById('telefone').value.trim(),
                observacoes: '',

                // >>> campos novos de aceite <<<
                accepted_terms: document.getElementById('aceite_termos')
                    ? document.getElementById('aceite_termos').checked
                    : false,
                terms_version: document.getElementById('terms_version')
                    ? document.getElementById('terms_version').value
                    : null,
                accepted_at: new Date().toISOString(),

                utm: (window.LMUTM ? LMUTM.get() : {})
            };
        }

        function validateAll(p) {
            var ok = true;
            function show(id, showFlag) { var el = document.getElementById(id); if (el) el.style.display = showFlag ? 'block' : 'none'; }

            if (!/^\d{2}\/\d{2}\/\d{4}$/.test(p.menor_nascimento) || !isValidDateBR(p.menor_nascimento)) { show('err_menor_nascimento', true); ok = false; } else show('err_menor_nascimento', false);
            if (!isValidDateBR(p.data_ida)) { show('err_data_ida', true); ok = false; } else show('err_data_ida', false);
            if (!isValidDateBR(p.data_volta)) { show('err_data_volta', true); ok = false; } else {
                var di = new Date(dateToISO(p.data_ida)); var dv = new Date(dateToISO(p.data_volta));
                if (isNaN(di.getTime()) || isNaN(dv.getTime()) || dv.getTime() < di.getTime()) { show('err_data_volta', true); ok = false; } else show('err_data_volta', false);
            }

            // CPF agora √© opcional (pode ser preenchido depois √† caneta)
            show('err_resp1_cpf', false);
            show('err_resp2_cpf', false);
            show('err_acomp_cpf', false);

            if (p.acompanhante_tipo !== 'desacompanhado') {
                if (!p.acompanhante_nome || !p.acompanhante_parentesco) { ok = false; }
            }

            if (!p.menor_nome || !p.resp1_nome || !p.destino || !p.cidade_uf_emissao) ok = false;
            return ok;
        }

        // ------- MULTI-STEP (4 PASSOS) --------
        var currentStep = 1;
        function showStep(step) {
            currentStep = step;
            var steps = document.querySelectorAll('.form-step');
            steps.forEach(function (s) {
                var n = parseInt(s.getAttribute('data-step'), 10);
                s.style.display = (n === step) ? 'block' : 'none';
            });
            var items = document.querySelectorAll('.step-item');
            items.forEach(function (it) {
                var n = parseInt(it.getAttribute('data-step'), 10);
                it.classList.toggle('active', n === step);
                it.classList.toggle('completed', n < step);
            });
            var formArea = document.getElementById('formArea');
            if (formArea) {
                // Um pequeno delay ajuda o celular a processar a troca de altura antes de rolar
                setTimeout(function () {
                    formArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 50);
            }
        }

        function validateStep(step) {
            var p = getPayload();
            var msg = '';

            if (step === 1) {
                if (!p.menor_nome || !p.menor_nascimento || !p.destino || !p.data_ida || !p.data_volta) {
                    msg = 'Preencha os campos obrigat√≥rios deste passo.';
                } else {
                    if (!isValidDateBR(p.menor_nascimento)) msg = 'Data de nascimento inv√°lida.';
                    else if (!isValidDateBR(p.data_ida)) msg = 'Data de ida inv√°lida.';
                    else if (!isValidDateBR(p.data_volta)) msg = 'Data de volta inv√°lida.';
                }
            } else if (step === 2) {
                if (p.acompanhante_tipo !== 'desacompanhado') {
                    if (!p.acompanhante_nome || !p.acompanhante_parentesco) {
                        msg = 'Informe nome e parentesco do acompanhante ou selecione "Desacompanhado".';
                    }
                }
            } else if (step === 3) {
                if (!p.resp1_nome) {
                    msg = 'Informe pelo menos um respons√°vel que autoriza.';
                }
            } else if (step === 4) {
                if (!p.cidade_uf_emissao) {
                    msg = 'Informe a cidade/UF de emiss√£o.';
                }
            }

            if (msg) {
                alert(msg);
                return false;
            }
            return true;
        }

        var nextStep1 = document.getElementById('nextStep1');
        if (nextStep1) nextStep1.addEventListener('click', function () {
            if (validateStep(1)) showStep(2);
        });

        var nextStep2 = document.getElementById('nextStep2');
        if (nextStep2) nextStep2.addEventListener('click', function () {
            if (validateStep(2)) showStep(3);
        });

        var prevStep2 = document.getElementById('prevStep2');
        if (prevStep2) prevStep2.addEventListener('click', function () {
            showStep(1);
        });

        var nextStep3 = document.getElementById('nextStep3');
        if (nextStep3) nextStep3.addEventListener('click', function () {
            if (validateStep(3)) showStep(4);
        });

        var prevStep3 = document.getElementById('prevStep3');
        if (prevStep3) prevStep3.addEventListener('click', function () {
            showStep(2);
        });

        var prevStep4 = document.getElementById('prevStep4');
        if (prevStep4) prevStep4.addEventListener('click', function () {
            showStep(3);
        });

        var btnPreview = document.getElementById('btnPreview');
        var btnPagar = document.getElementById('btnPagar');
        var previewWrap = document.getElementById('previewWrap');
        var previewBox = document.getElementById('previewBox');
        var paySection = document.getElementById('paySection');

        loadForm();
        attachAutosave();
        showStep(1);

        function captureLead(p) { fetch('/.netlify/functions/capture-lead', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email: p.email, telefone: p.telefone, nome: p.resp1_nome || p.menor_nome, slug: 'autorizacao-viagem-menor', payload: p }) }).catch(err => console.log('Lead capture bg error', err)); }

        function checkCooldown() {
            var last = localStorage.getItem('last_preview_ts');
            if (last && (Date.now() - parseInt(last)) < 30000) {
                alert('Por favor, aguarde alguns segundos antes de gerar outra pr√©via.');
                return false;
            }
            return true;
        }

        // PR√âVIA (VIAGEM)
        btnPreview.addEventListener('click', function () {
            if (!checkCooldown()) return;

            // 1. TRAVA VISUAL
            btnPreview.disabled = true;
            btnPreview.style.opacity = '0.5';
            btnPreview.style.cursor = 'not-allowed';
            btnPreview.textContent = '‚è≥ Gerando pr√©via...';

            async function tentarGerar(tentativa) {
                var vaiTentarDeNovo = false;
                try {
                    var payload = getPayload();
                    // Valida√ß√£o antes
                    if (!validateAll(payload)) {
                        alert('Verifique os campos obrigat√≥rios (destacados em vermelho).');
                        // Reseta visual imediatamente
                        btnPreview.disabled = false;
                        btnPreview.style.opacity = '1';
                        btnPreview.style.cursor = 'pointer';
                        btnPreview.textContent = 'Gerar pr√©via gratuita';
                        return;
                    }

                    saveForm(); // Mantido

                    // Captura lead na primeira tentativa
                    if (tentativa === 1 && (payload.email || payload.telefone)) {
                        captureLead(payload);
                    }

                    var r = await fetch('/.netlify/functions/generate-doc', {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ payload: payload, preview: true })
                    });

                    // RETRY LOGIC
                    if (r.status === 503 && tentativa === 1) {
                        console.log('Servidor ocupado (503), tentando novamente...');
                        btnPreview.textContent = '‚Üª Reconectando...';
                        vaiTentarDeNovo = true;
                        await new Promise(res => setTimeout(res, 2000));
                        return tentarGerar(2);
                    }

                    if (!r.ok) {
                        var errText = 'Falha ao gerar';
                        try { var errData = await r.json(); if (errData.body) errText = errData.body; } catch (e) { }
                        throw new Error(errText);
                    }

                    var data = await r.json();
                    var out = data.output || data;
                    var pars = out.corpo_paragrafos || [];
                    var keep = Math.max(1, Math.min(2, pars.length));
                    var parcialText = pars.slice(0, keep).join('\n\n') + '\n\n[...]';
                    var saud = out.saudacao || '';
                    var checklist = out.check_list_anexos || [];
                    var chkShow = checklist.slice(0, 2);
                    if (checklist.length > 2) chkShow.push('...');
                    var finalPreview = (saud ? saud + '\n\n' : '') + parcialText + '\n\nChecklist de anexos (parcial): ' + chkShow.join('; ');

                    previewBox.textContent = finalPreview;
                    previewWrap.style.display = 'block';

                    // Mostra √°rea de pagamento
                    paySection.style.display = 'block';

                    // Esconde apenas o bot√£o de pr√©via (mant√©m "Voltar")
                    btnPreview.style.display = 'none';

                    setTimeout(function () {
                        var checkbox = document.getElementById('aceite_termos');
                        if (checkbox) {
                            // "block: 'center'" coloca o checkbox no MEIO da tela.
                            // Isso garante que o bot√£o de pagar e o topo da pr√©via apare√ßam logo abaixo.
                            checkbox.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }, 100);

                    if (typeof gtag === 'function') {
                        gtag('event', 'generate_lead', { 'send_to': 'AW-1021062139/Ri4bCICS88IbEPvX8OYD', 'event_category': 'engagement', 'event_label': 'viagem_nacional', 'value': 2.00, 'currency': 'BRL' });
                    }

                    localStorage.setItem('pendingPayload', JSON.stringify(payload));
                    localStorage.setItem('last_preview_ts', Date.now());
                    btnPagar.disabled = false;

                } catch (e) {
                    if (!vaiTentarDeNovo) {
                        if (e.message !== 'Campos inv√°lidos') { alert('Erro ao gerar: ' + e.message); }
                        // Em caso de erro, for√ßa reset visual para tentar de novo
                        btnPreview.disabled = false;
                        btnPreview.style.opacity = '1';
                        btnPreview.style.cursor = 'pointer';
                        btnPreview.textContent = 'Gerar pr√©via gratuita';
                    }
                }
            }

            tentarGerar(1);
        });

        btnPagar.addEventListener('click', async function () {
            btnPagar.disabled = true; btnPagar.textContent = 'Preparando...';
            try {
                // Confirma aceite do aviso/termos
                var aceite = document.getElementById('aceite_termos');
                if (aceite && !aceite.checked) {
                    alert('Para continuar, confirme que leu e entendeu o aviso importante antes do pagamento.');
                    btnPagar.disabled = false;
                    btnPagar.textContent = 'Gerar documento completo (R$ 9,90)';
                    return;
                }

                // SEM CAPTCHA NO PAGAMENTO
                var payload = getPayload();
                if (!validateAll(payload)) {
                    alert('Preencha os campos obrigat√≥rios.');
                    throw new Error('Campos inv√°lidos');
                }

                saveForm();
                localStorage.setItem('pendingPayload', JSON.stringify(payload));
                var slugStr = 'autorizacao-viagem-menor';

                var r = await fetch('/.netlify/functions/mp-checkout', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ slug: slugStr, payload: payload, utm: (window.LMUTM ? LMUTM.get() : {}) })
                });
                var data = await r.json();
                if (!r.ok) throw new Error(data.error || 'Erro no pagamento');

                localStorage.setItem('lastOrderId', data.order_id || '');
                if (typeof gtag === 'function') { gtag('event', 'begin_checkout', { value: 9.9, currency: 'BRL', items: [{ item_id: slugStr }] }); }
                showPaymentModal(data.init_point, data.order_id, slugStr);
            } catch (e) {
                if (e.message !== 'Campos inv√°lidos') alert('Erro: ' + e.message);
                btnPagar.disabled = false; btnPagar.textContent = 'Gerar documento completo (R$ 9,90)';
            }
        });

        function showPaymentModal(initPoint, orderId, slug) {
            var isLight = (document.documentElement.getAttribute('data-theme') === 'light');
            var cardBG = isLight ? '#ffffff' : '#111827';
            var cardText = isLight ? '#0f172a' : '#e6eefb';

            var overlay = document.createElement('div');
            overlay.style = 'position:fixed;inset:0;background:rgba(2,6,23,.85);backdrop-filter:blur(4px);z-index:9999;display:flex;align-items:center;justify-content:center';

            // HTML simplificado: Sem bot√£o de copiar, foco total no pagamento
            overlay.innerHTML =
                '<div style="background:' + cardBG + ';color:' + cardText + ';border:1px solid var(--border);border-radius:16px;max-width:400px;width:90%;padding:24px;box-shadow:0 20px 50px rgba(0,0,0,.4);text-align:center;">' +
                '<div style="font-size:40px;margin-bottom:16px;">üí∏</div>' +
                '<h3 style="margin:0 0 12px;font-size:20px;">Quase l√°!</h3>' +
                '<p style="margin:0 0 20px;line-height:1.5;color:var(--text-secondary);">Clique no bot√£o abaixo para finalizar o pagamento com seguran√ßa no Mercado Pago.</p>' +

                '<div style="display:flex;flex-direction:column;gap:12px;">' +
                '<button id="lm-goPay" class="btn btn-primary" style="width:100%;padding:14px;font-size:16px;justify-content:center;">Ir para Pagamento (Pix ou Cart√£o)</button>' +
                '<button id="lm-close" class="btn btn-outline" style="width:100%;justify-content:center;border:none;">Fechar e corrigir dados</button>' +
                '</div>' +

                '<p id="lm-statusPay" class="small" style="margin-top:16px;font-size:12px;opacity:0.8;"></p>' +
                '</div>';

            document.body.appendChild(overlay);

            // L√ìGICA DO BOT√ÉO FECHAR (CORRIGIDA)
            // Remove o modal e REATIVA o bot√£o de pagar l√° atr√°s
            document.getElementById('lm-close').onclick = function () {
                overlay.remove();
                try { grecaptcha.reset(); } catch (e) { }

                var btnPagar = document.getElementById('btnPagar');
                if (btnPagar) {
                    btnPagar.disabled = false;
                    btnPagar.textContent = 'Gerar documento completo (R$ 9,90)';
                }
            };

            // L√≥gica de Verifica√ß√£o (Polling)
            async function docReady() {
                try {
                    var r = await fetch('/.netlify/functions/generate-doc', {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ payload: { order_id: orderId }, preview: false })
                    });
                    if (!r.ok) return false;
                    var j = await r.json();
                    return !!(j && j.output);
                } catch (e) { return false; }
            }

            // L√≥gica do Bot√£o de Pagar
            document.getElementById('lm-goPay').onclick = function () {
                // Abre o Mercado Pago em nova aba
                window.open(initPoint, '_blank', 'noopener');

                // Muda o status no modal
                var btn = this;
                btn.textContent = 'Verificando pagamento...';
                document.getElementById('lm-statusPay').textContent = 'Aguarde, estamos confirmando seu pagamento...';

                // Come√ßa a verificar se pagou a cada 3 segundos
                var iv = setInterval(async function () {
                    try {
                        // 1. Verifica se o documento j√° foi gerado (mais r√°pido)
                        if (await docReady()) {
                            clearInterval(iv);
                            location.href = '/success.html?o=' + encodeURIComponent(orderId) + '&slug=' + encodeURIComponent(slug) + '&s=success';
                            return;
                        }
                        // 2. Verifica status do pedido (fallback)
                        var rr = await fetch('/.netlify/functions/order-status?o=' + encodeURIComponent(orderId));
                        var jj = rr.ok ? await rr.json() : null;
                        if (jj && jj.status === 'paid') {
                            clearInterval(iv);
                            location.href = '/success.html?o=' + encodeURIComponent(orderId) + '&slug=' + encodeURIComponent(slug) + '&s=success';
                        }
                    } catch (e) { }
                }, 3000);
            };
        }
    </script>
    <script>
        (function () {
            // Verifica se a URL tem ?modo=admin
            const params = new URLSearchParams(window.location.search);
            if (params.get('modo') === 'admin') {
                // Procura o bot√£o de pagar (funciona mesmo se o ID for diferente)
                const btnPagar = document.querySelector('[id*="Pagar"], [id*="pagar"]') || document.getElementById('btnPagar');
                if (!btnPagar) return; // Se n√£o achar bot√£o, n√£o faz nada

                const btnArea = btnPagar.parentElement;

                // Cria o bot√£o Admin
                const btnAdmin = document.createElement('button');
                btnAdmin.className = 'btn';
                btnAdmin.style.backgroundColor = '#8b5cf6';
                btnAdmin.style.color = 'white';
                btnAdmin.style.border = 'none';
                btnAdmin.innerText = 'üëë Gerar Admin';

                btnAdmin.onclick = async function () {
                    const senha = prompt("Digite a senha de Admin:");
                    if (!senha) return;

                    btnAdmin.innerText = 'Gerando...';
                    btnAdmin.disabled = true;

                    try {
                        // Usa a fun√ß√£o getPayload() que j√° existe na p√°gina
                        var p = getPayload();
                        p.admin_key = senha;

                        var r = await fetch('/.netlify/functions/generate-doc', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ payload: p, preview: false })
                        });

                        if (!r.ok) throw new Error('Senha errada ou erro no servidor');

                        var data = await r.json();

                        if (data.output) {
                            // üî• Monta o texto completo do documento
                            let fullText = '';
                            if (data.output.saudacao) fullText += data.output.saudacao + '\n\n';

                            if (Array.isArray(data.output.corpo_paragrafos)) {
                                fullText += data.output.corpo_paragrafos.join('\n\n');
                            } else {
                                fullText += String(data.output.corpo_paragrafos);
                            }

                            if (data.output.fechamento) fullText += '\n\n' + data.output.fechamento;

                            // Exibe no preview (funciona em qualquer p√°gina)
                            const previewBox = document.getElementById('previewBox');
                            const previewWrap = document.getElementById('previewWrap');

                            if (previewBox && previewWrap) {
                                previewBox.textContent = fullText;
                                previewBox.style.whiteSpace = 'pre-wrap';
                                previewWrap.style.display = 'block';

                                // Remove bot√µes antigos se existirem
                                const oldCopyBtn = document.getElementById('admin-copy-btn');
                                if (oldCopyBtn) oldCopyBtn.remove();

                                // Adiciona bot√£o de copiar
                                const copyBtn = document.createElement('button');
                                copyBtn.id = 'admin-copy-btn';
                                copyBtn.className = 'btn btn-primary';
                                copyBtn.style.marginTop = '16px';
                                copyBtn.innerText = 'üìã Copiar Documento';
                                copyBtn.onclick = async function () {
                                    await navigator.clipboard.writeText(fullText);
                                    copyBtn.innerText = '‚úÖ Copiado!';
                                    setTimeout(() => { copyBtn.innerText = 'üìã Copiar Documento'; }, 2000);
                                };
                                previewWrap.appendChild(copyBtn);

                                // Rola a p√°gina para o preview
                                previewWrap.scrollIntoView({ behavior: 'smooth', block: 'start' });

                                alert("‚úÖ Documento Admin Gerado!\n\nRole para baixo para copiar.");
                            } else {
                                // Fallback: mostra em alert se n√£o tiver preview
                                alert("‚úÖ Documento Gerado!\n\n" + fullText.substring(0, 500) + "...\n\n(Copie do console)");
                                console.log(fullText);
                            }
                        }

                    } catch (e) {
                        alert('‚ùå Erro: ' + e.message);
                    } finally {
                        btnAdmin.innerText = 'üëë Gerar Admin';
                        btnAdmin.disabled = false;
                    }
                };

                btnArea.appendChild(btnAdmin);
            }
        })();
    </script>
</body>

</html>
<!doctype html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <title>Autoriza√ß√£o de Viagem para Menor | Evite ser barrado no embarque</title>

    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" href="/logo.png" />
    <link rel="apple-touch-icon" href="/logo.png" />

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [{
        "@type": "Question",
        "name": "Preciso reconhecer firma da autoriza√ß√£o de viagem?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Sim. Para que a autoriza√ß√£o tenha validade legal no embarque (nacional ou internacional), a assinatura dos respons√°veis deve ter firma reconhecida em cart√≥rio, por autenticidade ou semelhan√ßa."
        }
      }, {
        "@type": "Question",
        "name": "Qual a validade da autoriza√ß√£o de viagem para menor?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Se n√£o houver prazo estipulado no documento, a autoriza√ß√£o √© v√°lida por 2 anos. No entanto, o nosso gerador permite que voc√™ defina as datas exatas de ida e volta, o que √© mais seguro."
        }
      }]
    }
    </script>

    <meta name="description"
        content="Gere a autoriza√ß√£o de viagem oficial (CNJ) para menor desacompanhado. Documento pronto para imprimir e reconhecer firma. Evite problemas no embarque." />
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <script src="/theme.js"></script>
    <link rel="stylesheet" href="/style.css" />

    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-1021062139"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'AW-1021062139');
        gtag('config', 'G-D40QPP9KNP');
    </script>
    <script src="/gtag.js"></script>

    <script type="text/javascript">
        (function (c, l, a, r, i, t, y) { c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) }; t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i; y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y); })(window, document, "clarity", "script", "u4x90t35gk");
    </script>

    <link rel="canonical" href="https://www.cartasapp.com.br/viagem.html" />

    <style>
        /* ESTILOS DOS CARDS VISUAIS */
        .radio-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .radio-card {
            position: relative;
        }

        .radio-card input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .radio-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 16px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            height: 100%;
            min-height: 80px;
        }

        .radio-label:hover {
            background: var(--card-hover);
            border-color: var(--accent-primary);
        }

        .radio-card input[type="radio"]:checked+.radio-label {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
            font-weight: 700;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.2);
        }

        .radio-icon {
            font-size: 24px;
            margin-bottom: 8px;
            display: block;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 20px;
        }

        @media (max-width: 480px) {
            .radio-group.full-mobile {
                grid-template-columns: 1fr;
            }

            .input-row {
                grid-template-columns: 1fr !important;
                gap: 12px;
                margin-top: 12px;
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(252, 211, 77, 0.7);
            }

            70% {
                transform: scale(1.02);
                box-shadow: 0 0 0 6px rgba(252, 211, 77, 0);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(252, 211, 77, 0);
            }
        }

        /* --- CORRE√á√ÉO DO WHATSAPP VS COOKIES --- */
        .whatsapp-float {
            z-index: 2147483647 !important;
            /* Garante que fique NA FRENTE de tudo */
        }

        /* S√≥ no celular, a gente sobe o bot√£o para n√£o bater no banner */
        @media (max-width: 768px) {
            .whatsapp-float {
                bottom: 90px !important;
                /* Sobe o bot√£o */
            }
        }

        /* ESTILO DA PR√âVIA "PREMIUM" */
        #doc {
            background: #fff;
            padding: 40px 50px !important;
            /* Margens de papel */
            border: 1px solid #ccc;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1) !important;
            font-family: 'Times New Roman', Times, serif !important;
            font-size: 16px !important;
            /* Letra maior = mais leg√≠vel */
            line-height: 1.6 !important;
            color: #000 !important;
            text-align: justify;
            position: relative;
        }

        /* Borda decorativa interna (Estilo Cart√≥rio) */
        #doc::before {
            content: "";
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 2px solid #000;
            /* Borda preta interna */
            pointer-events: none;
        }

        /* Cabe√ßalho Falso na Pr√©via */
        .doc-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 1px solid #000;
            padding-bottom: 15px;
        }

        .doc-title {
            font-weight: bold;
            font-size: 18px;
            text-transform: uppercase;
            margin: 0;
        }

        .doc-subtitle {
            font-size: 12px;
            margin-top: 5px;
            font-style: italic;
        }

        /* --- CSS INSTITUCIONAL (S√âRIO) --- */
        .pay-box {
            background: #ffffff;
            border: 1px solid #cbd5e1;
            /* Borda cinza suave */
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            position: relative;
            margin-top: 30px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .price-wrapper {
            margin: 20px 0;
            padding: 15px 0;
            border-top: 1px solid #f1f5f9;
            border-bottom: 1px solid #f1f5f9;
        }

        .price-label {
            font-size: 14px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .price-big {
            font-size: 36px;
            font-weight: 800;
            color: #0f172a;
            /* Azul muito escuro (S√≥brio) */
            line-height: 1;
        }

        .price-cents {
            font-size: 18px;
            vertical-align: top;
            font-weight: 600;
        }

        .secure-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
        }

        .secure-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            color: #64748b;
            font-weight: 500;
            background: #f8fafc;
            padding: 6px 10px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }
    </style>
</head>

<body>
    <nav class="navbar" style="box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
        <div class="container">
            <div class="navbar-content"
                style="display: flex; justify-content: space-between; align-items: center; height: 60px;">
                <a href="/" class="logo" style="display: flex; align-items: center; gap: 10px; text-decoration: none;">
                    <img src="/logo.png" alt="CartasApp" style="height: 42px; width: auto;"
                        onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <span
                        style="font-weight: 800; font-size: 20px; color: var(--text-primary); letter-spacing: -0.5px;">CartasApp</span>
                </a>
                <div class="nav-actions">
                    <button class="btn-theme" onclick="toggleTheme()" aria-label="Alternar tema"
                        style="background: transparent; border: 1px solid var(--border); color: var(--text-primary); width: 38px; height: 38px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s;">üåô</button>
                </div>
            </div>
        </div>
    </nav>

    <section class="hero" style="padding: 40px 0 20px;">
        <div class="container">
            <div class="hero-content">
                <div class="hero-badge"
                    style="background: #eff6ff; color: #1e40af; border: 1px solid #dbeafe; font-weight: 600; display: inline-block; padding: 5px 14px; border-radius: 6px; font-size: 12px; margin-bottom: 20px;">
                    ‚öñÔ∏è Conforme Resolu√ß√£o CNJ n¬∫ 295/2019
                </div>

                <h1 style="font-size: 34px; line-height: 1.2; font-weight: 800; color: #0f172a; margin-bottom: 12px;">
                    Autoriza√ß√£o de Viagem para Menores
                </h1>

                <p class="hero-subtitle"
                    style="font-size: 16px; margin-bottom: 25px; line-height: 1.6; color: #475569; max-width: 600px; margin-left: auto; margin-right: auto;">
                    Sistema seguro para emiss√£o de documento oficial de viagem (Nacional e Internacional).
                    Gere o arquivo PDF/Word pronto para reconhecimento de firma.
                </p>

                <div
                    style="background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px 20px; margin-bottom: 24px; display: inline-flex; align-items: center; gap: 15px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                    <div style="text-align: left;">
                        <div style="font-size: 11px; color: #64748b; text-transform: uppercase; font-weight: bold;">Taxa
                            de Emiss√£o</div>
                        <div style="font-size: 20px; font-weight: 700; color: #0f172a;">R$ 29,90</div>
                    </div>
                    <div style="height: 30px; width: 1px; background: #e2e8f0;"></div>
                    <div
                        style="font-size: 12px; color: #059669; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                        ‚úÖ Documento Validado
                    </div>
                </div>

                <div class="hero-actions">
                    <a href="#formArea" class="btn btn-primary" onclick="scrollToForm(event)"
                        style="width: 100%; max-width: 320px; margin: 0 auto; display: block; font-size: 16px; padding: 14px; background-color: #0f172a; border-color: #0f172a;">
                        INICIAR PREENCHIMENTO
                    </a>
                </div>

                <p class="small" style="margin-top: 16px; color: #94a3b8; font-size: 12px;">
                    Plataforma segura e criptografada (SSL).
                </p>
            </div>
        </div>
    </section>

    <section class="section" style="padding-top: 0;">
        <div class="container">
            <div style="max-width: 800px; margin: 0 auto;">

                <div class="card">
                    <div
                        style="background: #fffbeb; border: 1px solid #fcd34d; padding: 16px; border-radius: 12px; margin-bottom: 24px;">
                        <p style="margin: 0; font-size: 14px; color: #92400e; line-height: 1.5;">
                            <strong>‚ö†Ô∏è POR QUE FAZER AQUI E N√ÉO NO CART√ìRIO?</strong><br>
                            O Cart√≥rio <strong>N√ÉO redige</strong> o documento, apenas reconhece a assinatura. Se voc√™
                            chegar l√° sem nada, ter√° que pagar caro por uma escritura p√∫blica. Leve este documento
                            pronto e economize!
                        </p>
                    </div>

                    <div id="formArea">
                        <div style="margin-bottom: 24px; text-align: center;">
                            <div
                                style="background: #ecfdf5; color: #065f46; border: 1px solid #10b981; padding: 10px 20px; border-radius: 50px; display: inline-flex; align-items: center; gap: 8px; margin-bottom: 12px; font-weight: 600; font-size: 14px; box-shadow: 0 2px 4px rgba(16, 185, 129, 0.1); animation: pulse 2s infinite;">
                                <span style="font-size: 16px;">üèÜ</span>
                                <span>Modelo 100% Aceito (Padr√£o CNJ e Pol√≠cia Federal)</span>
                            </div>
                            <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 16px; margin-top: 0;">
                                Utilizado com sucesso por centenas de fam√≠lias em viagens nacionais e internacionais.
                                <br><span style="font-size: 11px; opacity: 0.8;">(Nenhuma recusa de embarque registrada
                                    at√© hoje)</span>
                            </p>
                            <div
                                style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; opacity: 0.9;">
                                <div
                                    style="font-size: 12px; display: flex; align-items: center; gap: 4px; color: var(--text-secondary); background: var(--bg-secondary); padding: 4px 10px; border-radius: 6px;">
                                    üîí Dados Criptografados
                                </div>
                                <div
                                    style="font-size: 12px; display: flex; align-items: center; gap: 4px; color: var(--text-secondary); background: var(--bg-secondary); padding: 4px 10px; border-radius: 6px;">
                                    ‚úÖ V√°lido em todo Brasil
                                </div>
                                <div
                                    style="font-size: 12px; display: flex; align-items: center; gap: 4px; color: var(--text-secondary); background: var(--bg-secondary); padding: 4px 10px; border-radius: 6px;">
                                    ‚úàÔ∏è Nacional & Internacional
                                </div>
                            </div>
                        </div>

                        <div class="step-indicator">
                            <div class="step-item" data-step="1">1. Menor e viagem</div>
                            <div class="step-item" data-step="2">2. Acompanhante</div>
                            <div class="step-item" data-step="3">3. Respons√°veis</div>
                            <div class="step-item" data-step="4">4. Local e contatos</div>
                        </div>

                        <div class="form-step" data-step="1" id="step-1">
                            <div
                                style="background-color: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px; padding: 12px; margin-bottom: 24px; display: flex; align-items: start; gap: 10px;">
                                <span style="font-size: 18px; margin-top: 2px;">üëÅÔ∏è</span>
                                <p style="margin: 0; font-size: 14px; color: #0284c7; line-height: 1.4;">
                                    <strong>Seguran√ßa:</strong> Preencha para ver a <strong>pr√©via gratuita</strong>
                                    antes de pagar.
                                </p>
                            </div>

                            <h2 class="section-title" style="font-size: 20px; margin-bottom: 12px;">Para onde √© a
                                viagem?</h2>
                            <select id="viagem_tipo" style="display:none">
                                <option value="nacional" selected>Nacional</option>
                                <option value="internacional">Internacional</option>
                            </select>
                            <div class="radio-group">
                                <div class="radio-card">
                                    <input type="radio" name="viagem_visual" id="v_nacional" value="nacional" checked
                                        onchange="updateViagem(this.value)">
                                    <label for="v_nacional" class="radio-label">
                                        <span class="radio-icon">üáßüá∑</span>Viagem Nacional
                                    </label>
                                </div>
                                <div class="radio-card">
                                    <input type="radio" name="viagem_visual" id="v_internacional" value="internacional"
                                        onchange="updateViagem(this.value)">
                                    <label for="v_internacional" class="radio-label">
                                        <span class="radio-icon">‚úàÔ∏è</span>Internacional
                                    </label>
                                </div>
                            </div>
                            <p id="viagem_tipo_aviso" class="small"
                                style="margin-top:-10px; margin-bottom: 24px; color:var(--text-muted);"></p>

                            <h2 class="section-title" style="font-size: 20px; margin-bottom: 16px;">Quem vai viajar?
                                (Crian√ßa/Adolescente)</h2>
                            <label class="label">Nome completo <span class="required-star">*</span></label>
                            <input class="input" id="menor_nome" placeholder="Ex.: Ana Souza" />

                            <div class="input-row">
                                <div>
                                    <label class="label">Nascimento <span class="required-star">*</span></label>
                                    <input class="input" type="date" id="menor_nascimento" required />
                                    <div id="err_menor_nascimento" class="small"
                                        style="display:none;color:#fca5a5;margin-top:4px;">Data inv√°lida.</div>
                                </div>
                                <div>
                                    <label class="label">Documento (Opcional)</label>
                                    <input class="input" id="menor_doc" placeholder="RG ou Certid√£o" />
                                </div>
                            </div>

                            <h2 class="section-title" style="font-size: 20px; margin: 24px 0 16px;">Detalhes do Destino
                            </h2>
                            <label class="label">Cidade de Destino <span class="required-star">*</span></label>
                            <input class="input" id="destino" list="lista_cidades"
                                placeholder="Ex.: S√£o Paulo/SP ou Orlando/EUA" autocomplete="off" />

                            <div class="input-row">
                                <div>
                                    <label class="label">Data de ida <span class="required-star">*</span></label>
                                    <input class="input" type="date" id="data_ida" required />
                                    <div id="err_data_ida" class="small"
                                        style="display:none;color:#fca5a5;margin-top:4px;">Data inv√°lida.</div>
                                </div>

                                <div>
                                    <label class="label">Data de volta <span class="required-star">*</span></label>

                                    <input class="input" type="date" id="data_volta" required />

                                    <small
                                        style="display:block; font-size: 0.75rem; color: #9ca3af; margin-top: 4px; line-height: 1.2;">
                                        Sem volta definida? Selecione a data de hoje + 2 anos (validade m√°xima legal).
                                    </small>
                                    <div id="err_data_volta" class="small"
                                        style="display:none;color:#fca5a5;margin-top:4px;">Data inv√°lida.</div>
                                </div>
                            </div>

                            <div class="form-navigation">
                                <button type="button" class="btn btn-primary" id="nextStep1" style="width:100%;">
                                    Continuar para o Acompanhante ‚Üí
                                </button>
                            </div>
                        </div>

                        <div class="form-step" data-step="2" id="step-2">
                            <h2 class="section-title" style="font-size: 24px; margin-bottom: 16px;">Com quem a crian√ßa
                                vai viajar?</h2>
                            <select id="acompanhante_tipo" style="display:none">
                                <option value="outro_responsavel">A M√£e / O Pai</option>
                                <option value="terceiro">Parente / Terceiro</option>
                                <option value="desacompanhado">Sozinho (Desacompanhado)</option>
                            </select>

                            <div class="radio-group full-mobile">
                                <div class="radio-card">
                                    <input type="radio" name="acomp_visual" id="opt_resp" value="outro_responsavel"
                                        onchange="updateAcompVisibility(this.value)">
                                    <label for="opt_resp" class="radio-label">
                                        <span class="radio-icon">üë®‚Äçüë©‚Äçüëß</span>
                                        Com o Pai ou M√£e<br><span style="font-size:12px; font-weight:normal;">(O outro
                                            assina)</span>
                                    </label>
                                </div>
                                <div class="radio-card">
                                    <input type="radio" name="acomp_visual" id="opt_terceiro" value="terceiro"
                                        onchange="updateAcompVisibility(this.value)">
                                    <label for="opt_terceiro" class="radio-label">
                                        <span class="radio-icon">üëµ</span>
                                        Av√≥s / Tios / Outros<br><span style="font-size:12px; font-weight:normal;">(Pai e
                                            M√£e assinam)</span>
                                    </label>
                                </div>
                                <div class="radio-card" style="grid-column: span 2;">
                                    <input type="radio" name="acomp_visual" id="opt_sozinho" value="desacompanhado"
                                        onchange="updateAcompVisibility(this.value)">
                                    <label for="opt_sozinho" class="radio-label">
                                        <span class="radio-icon">üôã‚Äç‚ôÇÔ∏è</span>
                                        Viajar Sozinho<br><span
                                            style="font-size:12px; font-weight:normal;">(Desacompanhado)</span>
                                    </label>
                                </div>
                            </div>

                            <div id="acompanhanteBox"
                                style="margin-top:20px; background: var(--bg-secondary); padding: 16px; border-radius: 12px; display:none;">
                                <h3 style="font-size: 16px; margin-bottom: 12px;">Dados do Acompanhante</h3>
                                <label class="label">Nome completo <span class="required-star">*</span></label>
                                <input class="input" id="acomp_nome" placeholder="Ex.: Maria Souza" />
                                <label class="label">Parentesco <span class="required-star">*</span></label>
                                <input class="input" id="acomp_parentesco" placeholder="Ex.: Av√≥, Tia, Irm√£o" />
                                <label class="label">CPF (Opcional)</label>
                                <input class="input" id="acomp_cpf" placeholder="000.000.000-00" inputmode="numeric"
                                    maxlength="14" />
                                <label class="label">RG/Documento (Opcional)</label>
                                <input class="input" id="acomp_doc" placeholder="RG do acompanhante" />
                            </div>

                            <div class="form-navigation">
                                <button type="button" class="btn btn-secondary" id="prevStep2">Voltar</button>
                                <button type="button" class="btn btn-primary" id="nextStep2">Pr√≥ximo Passo ‚Üí</button>
                            </div>
                        </div>

                        <div class="form-step" data-step="3" id="step-3">
                            <h2 class="section-title" style="font-size: 24px; margin-bottom: 16px;">Quem est√°
                                autorizando?</h2>
                            <div class="radio-group full-mobile">
                                <div class="radio-card">
                                    <input type="radio" name="resps_visual" id="um_resp" value="1" checked
                                        onchange="toggleResps(1)">
                                    <label for="um_resp" class="radio-label">
                                        <span class="radio-icon">üë§</span>
                                        Apenas 1 Respons√°vel<br><span style="font-size:12px; font-weight:normal;">(Ex:
                                            Viagem com o outro pai)</span>
                                    </label>
                                </div>
                                <div class="radio-card">
                                    <input type="radio" name="resps_visual" id="dois_resps_visual" value="2"
                                        onchange="toggleResps(2)">
                                    <label for="dois_resps_visual" class="radio-label">
                                        <span class="radio-icon">üë•</span>
                                        Pai e M√£e (Ambos)<br><span style="font-size:12px; font-weight:normal;">(Ou dois
                                            guardi√µes)</span>
                                    </label>
                                </div>
                            </div>
                            <input type="checkbox" id="dois_resps" style="display:none">

                            <div
                                style="margin-top:20px; background: var(--bg-secondary); padding: 16px; border-radius: 12px;">
                                <h3 style="font-size: 18px; margin-bottom: 12px; color: var(--accent-primary);">
                                    Respons√°vel 1</h3>
                                <label class="label">Nome completo <span class="required-star">*</span></label>
                                <input class="input" id="resp1_nome" placeholder="Ex.: Jo√£o Souza" />
                                <div class="input-row">
                                    <div>
                                        <label class="label">Parentesco <span class="required-star">*</span></label>
                                        <select class="input" id="resp1_parentesco">
                                            <option>Pai</option>
                                            <option>M√£e</option>
                                            <option>Respons√°vel legal</option>
                                            <option>Tutor(a)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="label">CPF (Opcional)</label>
                                        <input class="input" id="resp1_cpf" placeholder="000.000.000-00"
                                            inputmode="numeric" maxlength="14" />
                                    </div>
                                </div>
                                <label class="label">RG/Documento (Opcional)</label>
                                <input class="input" id="resp1_doc" placeholder="RG ou CNH (S√≥ n√∫meros)" />
                            </div>

                            <div id="resp2Box"
                                style="margin-top:20px; background: var(--bg-secondary); padding: 16px; border-radius: 12px; display:none;">
                                <h3 style="font-size: 18px; margin-bottom: 12px; color: var(--accent-primary);">
                                    Respons√°vel 2</h3>
                                <label class="label">Nome completo <span class="required-star">*</span></label>
                                <input class="input" id="resp2_nome" placeholder="Ex.: Maria Souza" />
                                <div class="input-row">
                                    <div>
                                        <label class="label">Parentesco</label>
                                        <select class="input" id="resp2_parentesco">
                                            <option>M√£e</option>
                                            <option>Pai</option>
                                            <option>Respons√°vel legal</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="label">CPF (Opcional)</label>
                                        <input class="input" id="resp2_cpf" placeholder="000.000.000-00"
                                            inputmode="numeric" maxlength="14" />
                                    </div>
                                </div>
                                <label class="label">RG/Documento (Opcional)</label>
                                <input class="input" id="resp2_doc" placeholder="RG ou CNH" />
                            </div>

                            <div class="form-navigation">
                                <button type="button" class="btn btn-secondary" id="prevStep3">Voltar</button>
                                <button type="button" class="btn btn-primary" id="nextStep3">Pr√≥ximo Passo ‚Üí</button>
                            </div>
                        </div>

                        <div class="form-step" data-step="4" id="step-4">
                            <h2 class="section-title" style="font-size: 24px; margin-bottom: 16px;">Local e Contato</h2>
                            <label class="label">Onde voc√™ vai assinar? (Cidade/Estado) <span
                                    class="required-star">*</span></label>
                            <input class="input" id="cidade_uf_emissao" list="lista_cidades"
                                placeholder="Digite sua cidade..." autocomplete="off">
                            <datalist id="lista_cidades"></datalist>

                            <div class="input-row">
                                <div>
                                    <label class="label">Seu WhatsApp (Opcional)</label>
                                    <input class="input" id="telefone" placeholder="(DD) 99999-9999" type="tel"
                                        inputmode="numeric" maxlength="15" onkeyup="mascaraTelefone(this)" />
                                </div>
                                <div>
                                    <label class="label">Seu E-mail (Opcional)</label>
                                    <input class="input" id="email" placeholder="Para receber o PDF" type="email" />
                                </div>
                            </div>
                            <p class="small" style="margin-top:12px;">Seus dados de contato s√£o usados apenas para
                                enviar o backup do documento.</p>

                            <div class="form-navigation">
                                <button type="button" class="btn btn-secondary" id="prevStep4">Voltar</button>
                                <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:flex-end;">
                                    <button class="btn btn-primary" id="btnPreview"
                                        style="background-color: #28a745; border-color: #28a745; font-size: 1.1em; padding: 12px 24px;">
                                        üìÑ Ver Pr√©via do Documento
                                    </button>
                                </div>
                            </div>

                            <div id="paySection" style="display:none;">
                                <input type="hidden" id="terms_version" value="viagem-2025-02-v1">

                                <div class="pay-box">
                                    <h3 style="margin: 0 0 5px 0; font-size: 18px; color: #0f172a;">Resumo do Pedido
                                    </h3>
                                    <p style="margin: 0; font-size: 14px; color: #64748b;">Emiss√£o de Autoriza√ß√£o de
                                        Viagem (Minuta)</p>

                                    <div class="price-wrapper">
                                        <div class="price-label">Valor do Servi√ßo</div>
                                        <div class="price-big">
                                            R$ 29<span class="price-cents">,90</span>
                                        </div>
                                        <div style="font-size: 12px; color: #64748b; margin-top: 8px;">
                                            Pagamento √∫nico ‚Ä¢ Acesso vital√≠cio aos arquivos
                                        </div>
                                    </div>

                                    <button class="btn btn-primary" id="btnPagar"
                                        style="width: 100%; font-size: 16px; padding: 16px; background-color: #2563eb; border-color: #2563eb; font-weight: 600;">
                                        IR PARA PAGAMENTO SEGURO
                                    </button>

                                    <div
                                        style="font-size: 11px; color: #94a3b8; margin-top: 12px; display: flex; align-items: center; justify-content: center; gap: 6px;">
                                        üîí Ambiente Seguro processado pelo Mercado Pago
                                    </div>

                                    <div class="secure-row">
                                        <div class="secure-item">üõ°Ô∏è Garantia Legal</div>
                                        <div class="secure-item">‚öñÔ∏è Padr√£o CNJ</div>
                                        <div class="secure-item">üîí Dados Protegidos</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="previewWrap"
                    style="display:none; margin-top:32px; padding-top:32px; border-top:1px dashed var(--border);">

                    <div style="display:flex; align-items:center; gap:10px; margin-bottom: 16px;">
                        <h2 class="section-title" style="margin:0; font-size: 22px; color: var(--text-primary);">
                            Confira abaixo como ficou:
                        </h2>
                    </div>

                    <div
                        style="background:#f8fafc; border:2px solid #e2e8f0; border-radius:12px; padding:24px; position:relative;">
                        <div
                            style="position:absolute; top:10px; right:10px; background:#e2e8f0; color:#64748b; padding:4px 8px; font-size:10px; border-radius:4px; font-weight:bold; text-transform:uppercase;">
                            Pr√©via
                        </div>
                        <div id="previewBox"
                            style="white-space:pre-wrap; font-family:'Courier New', Courier, monospace; font-size:14px; line-height:1.6; color:#334155;">
                        </div>
                    </div>

                    <div
                        style="background-color: #fffbeb; color: #92400e; padding: 16px; border-radius: 8px; margin-top: 16px; font-size: 14px; border: 1px solid #fcd34d; display:flex; gap:12px; align-items:start;">
                        <span style="font-size: 18px;">üîí</span>
                        <div>
                            <strong>Esta √© uma visualiza√ß√£o parcial.</strong><br>
                            O documento final (completo, sem cortes e pronto para imprimir em PDF/Word) ser√° liberado
                            imediatamente ap√≥s a confirma√ß√£o do pagamento.
                        </div>
                    </div>

                    <button
                        onclick="document.getElementById('paySection').scrollIntoView({behavior: 'smooth', block: 'center'});"
                        class="btn btn-primary"
                        style="width:100%; margin-top: 16px; background: #0f172a; border-color: #0f172a; font-size: 15px; padding: 14px; white-space: normal; height: auto; line-height: 1.3; display: flex; align-items: center; justify-content: center; gap: 10px; text-align: center; font-weight: 600;">
                        <span style="font-size: 20px;">üìÑ</span>
                        <span style="flex: 1;">FINALIZAR E BAIXAR DOCUMENTO (R$ 29,90)</span>
                    </button>

                </div>

                <div id="social-proof" style="margin-top: 40px; margin-bottom: 40px;">
                    <h2 class="section-title"
                        style="text-align: center; font-size: 22px; margin-bottom: 20px; color: var(--text-primary);">
                        Quem usou, viajou tranquilo ‚úàÔ∏è
                    </h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px;">

                        <div
                            style="background: white; padding: 16px; border-radius: 12px; border: 1px solid var(--border); box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                            <div style="color: #fbbf24; margin-bottom: 8px;">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                            <p
                                style="font-size: 13px; color: var(--text-secondary); line-height: 1.5; margin-bottom: 12px;">
                                "Estava preocupada com a imigra√ß√£o na Argentina, mas o documento gerado pelo site segue
                                exatamente o padr√£o que a Pol√≠cia Federal exige. Passamos sem problemas."
                            </p>
                            <div style="font-size: 12px; font-weight: bold; color: var(--text-primary);">
                                Sueli <span style="font-weight: normal; color: var(--text-muted);">‚Ä¢ Viajou para
                                    Argentina üá¶üá∑</span>
                            </div>
                        </div>

                        <div
                            style="background: white; padding: 16px; border-radius: 12px; border: 1px solid var(--border); box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                            <div style="color: #fbbf24; margin-bottom: 8px;">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                            <p
                                style="font-size: 13px; color: var(--text-secondary); line-height: 1.5; margin-bottom: 12px;">
                                "Muito pr√°tico. Em vez de pagar caro num despachante ou advogado, fiz tudo pelo celular
                                em 5 minutos. Levei no cart√≥rio e pronto."
                            </p>
                            <div style="font-size: 12px; font-weight: bold; color: var(--text-primary);">
                                Erika A. <span style="font-weight: normal; color: var(--text-muted);">‚Ä¢ Viajou para Rio
                                    de Janeiro/RJ</span>
                            </div>
                        </div>

                        <div
                            style="background: white; padding: 16px; border-radius: 12px; border: 1px solid var(--border); box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                            <div style="color: #fbbf24; margin-bottom: 8px;">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                            <p
                                style="font-size: 13px; color: var(--text-secondary); line-height: 1.5; margin-bottom: 12px;">
                                "Precisava autorizar a viagem da minha filha e n√£o sabia como redigir o documento. O
                                sistema j√° preencheu tudo certo com a lei."
                            </p>
                            <div style="font-size: 12px; font-weight: bold; color: var(--text-primary);">
                                Jo√£o P. <span style="font-weight: normal; color: var(--text-muted);">‚Ä¢ Viajou para
                                    Imperatriz/MA</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="margin-top:40px; padding-top:24px; border-top:1px solid var(--border);">
                    <div
                        style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                        <p class="small" style="margin: 0; color: var(--text-secondary);">
                            <strong>Documentos aceitos para embarque (em regra):</strong><br>
                            ‚Ä¢ Crian√ßa (Nacional): Certid√£o de Nascimento ou RG.<br>
                            ‚Ä¢ Crian√ßa (Internacional): Passaporte (ou RG para Mercosul).<br>
                            ‚Ä¢ Adultos: RG, CNH, Passaporte ou Carteira de Trabalho.<br>
                            <span style="opacity:.8;">As exig√™ncias podem variar conforme a companhia de transporte e as
                                autoridades do pa√≠s de destino.</span>
                        </p>
                    </div>

                    <div class="small legal-note" style="margin-bottom: 16px;">
                        <p class="small" style="margin: 0;">
                            ‚Ä¢ Texto elaborado com base na <strong>Resolu√ß√£o CNJ n¬∫ 295/2019</strong> e nas exig√™ncias da
                            <strong>Pol√≠cia Federal</strong> (modelo de uso geral, que n√£o substitui orienta√ß√£o jur√≠dica
                            individual).<br>
                            ‚Ä¢ Serve para viagens <strong>nacionais e internacionais</strong>, com um dos pais, terceiros
                            ou desacompanhado, desde que respeitadas as regras espec√≠ficas de cada √≥rg√£o.<br>
                            ‚Ä¢ Documento em <strong>PDF e Word</strong>, pronto para imprimir, assinar e reconhecer firma
                            em cart√≥rio.
                        </p>
                    </div>

                    <div class="small"
                        style="margin-bottom: 24px; padding: 12px 14px; border-radius: 10px; background: var(--card-hover); border: 1px solid var(--border);">
                        <strong>Por R$ 29,90 (pagamento √∫nico)</strong>, voc√™ recebe:<br>
                        ‚Ä¢ Autoriza√ß√£o personalizada com os seus dados.<br>
                        ‚Ä¢ Arquivos em PDF e Word para editar, imprimir e assinar.<br>
                        ‚Ä¢ Suporte por WhatsApp em caso de d√∫vidas sobre o uso do modelo.
                    </div>

                    <div style="border-top:1px solid var(--border); padding-top:24px;">
                        <h2 class="section-title" style="font-size: 22px; margin-bottom: 12px;">Perguntas r√°pidas</h2>
                        <p class="small">
                            <strong>Preciso ir ao cart√≥rio depois de gerar?</strong><br>
                            Sim. O CartasApp entrega o documento pronto (redigido e formatado). Voc√™ deve imprimir e
                            levar ao cart√≥rio apenas para <strong>reconhecer a firma</strong> da sua assinatura. Esse
                            "selo" do cart√≥rio √© o que garante a validade legal para o embarque em viagens
                            interestaduais ou internacionais.
                        </p>
                        <p class="small" style="margin-top:12px;">
                            <strong>Quantas vias (c√≥pias) devo imprimir?</strong><br>
                            Na pr√°tica, recomenda-se ter <strong>2 vias originais</strong>.
                            <br>‚Ä¢ <strong>1¬™ Via:</strong> Fica retida com a companhia de transporte no momento do
                            embarque (arquivo deles).
                            <br>‚Ä¢ <strong>2¬™ Via:</strong> Segue viagem com a crian√ßa/acompanhante para servir de
                            documento de porte obrigat√≥rio (para fiscaliza√ß√£o policial ou retorno).
                        </p>
                        <p class="small" style="margin-top:12px;">
                            <strong>Este modelo √© aceito pela Pol√≠cia Federal?</strong><br>
                            O texto √© elaborado com base na <strong>Resolu√ß√£o CNJ n¬∫ 295/2019</strong> e nas orienta√ß√µes
                            divulgadas pela Pol√≠cia Federal. Na pr√°tica, costuma ser aceito quando apresentado
                            <strong>impresso, em duas vias e com firmas reconhecidas</strong>. Por√©m, a aceita√ß√£o final
                            cabe sempre √† autoridade do embarque.
                        </p>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p>Este site n√£o presta aconselhamento jur√≠dico. Leia os <a href="/termos.html"
                        class="footer-link">Termos de Uso</a>.</p>
            </div>
        </div>
    </footer>

    <a href="https://wa.me/5547988616874" class="whatsapp-float" target="_blank"><svg viewBox="0 0 24 24"
            class="whatsapp-icon">
            <path
                d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z" />
        </svg></a>

    <div id="modalTermos"
        style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:99999; align-items:center; justify-content:center; padding:20px; backdrop-filter: blur(4px);">
        <div
            style="background:var(--bg-primary); border:1px solid var(--border); border-radius:16px; max-width:500px; width:100%; padding:24px; position:relative; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); display: flex; flex-direction: column; max-height: 90vh;">

            <h3 style="margin-top:0; font-size:20px; color:var(--text-primary); flex-shrink: 0;">‚ö†Ô∏è Aviso Importante
            </h3>

            <div
                style="flex: 1; min-height: 0; margin: 16px 0; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px; overflow-y: auto; -webkit-overflow-scrolling: touch; box-shadow: inset 0 2px 4px 0 rgba(0,0,0,0.05);">
                <div style="font-size:14px; color:var(--text-secondary); line-height:1.5;">
                    <p style="margin-bottom:10px; margin-top:0;">Para prosseguir e gerar o documento, voc√™ precisa estar
                        ciente de que:</p>
                    <ul style="padding-left:18px; margin:0;">
                        <li style="margin-bottom:8px;">o CartasApp fornece apenas um <strong>modelo de autoriza√ß√£o de
                                viagem</strong>, preenchido com os dados informados por voc√™. N√£o fazemos an√°lise
                            jur√≠dica do seu caso;</li>
                        <li style="margin-bottom:8px;">a <strong>aceita√ß√£o do documento</strong> e a autoriza√ß√£o de
                            embarque <strong>dependem exclusivamente</strong> da Pol√≠cia Federal, das empresas de
                            transporte, dos cart√≥rios e, em viagens internacionais, tamb√©m de consulados e autoridades
                            do pa√≠s de destino;</li>
                        <li style="margin-bottom:8px;">para viagens internacionais podem ser exigidos documentos
                            adicionais (passaporte v√°lido, autoriza√ß√£o de ambos os pais, tradu√ß√£o, autoriza√ß√£o judicial
                            etc.), conforme o caso;</li>
                        <li>o servi√ßo n√£o inclui reconhecimento de firma em cart√≥rio (que deve ser feito presencialmente
                            pelos respons√°veis).</li>
                    </ul>
                </div>
            </div>

            <div
                style="text-align: center; font-size: 11px; color: var(--text-muted); margin-top: -12px; margin-bottom: 12px; opacity: 0.8;">
                (Role o texto acima para ler tudo)
            </div>

            <div style="flex-shrink: 0;">
                <label class="small"
                    style="display:flex; align-items:flex-start; gap:10px; cursor:pointer; background:var(--bg-secondary); padding:12px; border-radius:8px; border:1px solid var(--border);">
                    <input type="checkbox" id="aceite_termos"
                        style="margin-top:2px; min-width:20px; min-height:20px; cursor:pointer;" />
                    <span style="font-weight:600; color:var(--text-primary); line-height: 1.4;">
                        Li, compreendi e concordo com as informa√ß√µes acima e com os <a href="/termos.html"
                            target="_blank" style="color:#3b82f6; text-decoration:underline;">Termos de Uso</a>.
                    </span>
                </label>
                <div style="display:flex; gap:10px; margin-top:20px;">
                    <button id="btnCancelarTermos" class="btn btn-secondary" style="flex:1;">Cancelar</button>
                    <button id="btnConfirmarTermos" class="btn btn-primary" style="flex:1;">Confirmar e Pagar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/utm.js"></script>
    <script src="/recovery.js"></script>

    <script>
        // ========== FUN√á√ïES UTILIT√ÅRIAS ==========
        function scrollToForm(e) {
            e.preventDefault();
            const formArea = document.getElementById('formArea');
            if (formArea) { formArea.scrollIntoView({ behavior: 'smooth', block: 'start' }); }
        }

        function maskCPF(v) {
            v = (v || '').replace(/\D/g, '').slice(0, 11);
            v = v.replace(/(\d{3})(\d)/, '$1.$2');
            v = v.replace(/(\d{3})(\d)/, '$1.$2');
            v = v.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            return v;
        }

        function isValidCPF(cpf) {
            var s = (cpf || '').replace(/\D/g, '');
            if (s.length !== 11) return false;
            if (/^(\d)\1{10}$/.test(s)) return false;
            var i, sum = 0, rest;
            for (i = 1; i <= 9; i++) sum += parseInt(s.substring(i - 1, i)) * (11 - i);
            rest = (sum * 10) % 11;
            if (rest === 10 || rest === 11) rest = 0;
            if (rest !== parseInt(s.substring(9, 10))) return false;
            sum = 0;
            for (i = 1; i <= 10; i++) sum += parseInt(s.substring(i - 1, i)) * (12 - i);
            rest = (sum * 10) % 11;
            if (rest === 10 || rest === 11) rest = 0;
            if (rest !== parseInt(s.substring(10, 11))) return false;
            return true;
        }

        function mascaraTelefone(input) {
            var v = input.value.replace(/\D/g, "");
            v = v.replace(/^(\d\d)(\d)/g, "($1) $2");
            v = v.replace(/(\d{5})(\d)/, "$1-$2");
            input.value = v.substring(0, 15);
        }

        function formatDateBR(dateVal) {
            if (!dateVal) return '';
            if (dateVal.includes('/')) return dateVal;
            const parts = dateVal.split('-');
            if (parts.length === 3) return `${parts[2]}/${parts[1]}/${parts[0]}`;
            return dateVal;
        }

        function dateToISO(s) {
            if (!s) return '';
            if (s.includes('-')) return s;
            var d = s.substr(0, 2), m = s.substr(3, 2), y = s.substr(6, 4);
            return y + '-' + m + '-' + d;
        }

        function isValidDateBR(s) {
            if (!/^\d{2}\/\d{2}\/\d{4}$/.test(s || '')) return false;
            var d = parseInt(s.substr(0, 2), 10),
                m = parseInt(s.substr(3, 2), 10),
                y = parseInt(s.substr(6, 4), 10);
            if (y < 1900 || y > 2100 || m < 1 || m > 12 || d < 1 || d > 31) return false;
            var md = [31, (y % 4 === 0 && y % 100 !== 0) || y % 400 === 0 ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            if (d > md[m - 1]) return false;
            return true;
        }

        // ========== CONTROLES VISUAIS ==========
        function updateViagem(val) {
            var sel = document.getElementById('viagem_tipo');
            if (sel) {
                sel.value = val;
                var aviso = document.getElementById('viagem_tipo_aviso');
                if (aviso) {
                    if (val === 'internacional') {
                        aviso.textContent = 'Para viagens internacionais, al√©m da autoriza√ß√£o, costumam ser exigidos passaporte v√°lido (ou RG para alguns pa√≠ses) e, em certos casos, documentos adicionais. Sempre confirme com a Pol√≠cia Federal, a companhia a√©rea e o consulado do pa√≠s de destino.';
                    } else {
                        aviso.textContent = 'Para viagens nacionais, verifique tamb√©m as regras da companhia a√©rea/rodovi√°ria e tenha em m√£os os documentos originais do menor e dos respons√°veis.';
                    }
                }
            }
        }

        function updateAcompVisibility(val) {
            var sel = document.getElementById('acompanhante_tipo');
            if (sel) sel.value = val;
            var box = document.getElementById('acompanhanteBox');
            if (box) {
                if (val === 'terceiro' || val === 'outro_responsavel') {
                    box.style.display = 'block';
                } else {
                    box.style.display = 'none';
                }
            }
        }

        function toggleResps(num) {
            var check = document.getElementById('dois_resps');
            var box = document.getElementById('resp2Box');
            if (num == 2) {
                if (check) check.checked = true;
                if (box) box.style.display = 'block';
            } else {
                if (check) check.checked = false;
                if (box) box.style.display = 'none';
            }
        }

        // ========== AUTOSAVE E RESTORE ==========
        var ids = ['menor_nome', 'menor_nascimento', 'menor_doc', 'viagem_tipo', 'destino', 'data_ida', 'data_volta', 'acompanhante_tipo', 'acomp_nome', 'acomp_cpf', 'acomp_doc', 'acomp_parentesco', 'resp1_nome', 'resp1_cpf', 'resp1_doc', 'resp1_parentesco', 'dois_resps', 'resp2_nome', 'resp2_cpf', 'resp2_doc', 'resp2_parentesco', 'cidade_uf_emissao', 'email', 'telefone'];
        var SAVE_KEY = 'viagem_form_v4';

        function saveForm() {
            var o = {};
            for (var i = 0; i < ids.length; i++) {
                var el = document.getElementById(ids[i]);
                if (!el) continue;
                if (el.type === 'checkbox') o[ids[i]] = el.checked;
                else o[ids[i]] = el.value;
            }
            localStorage.setItem(SAVE_KEY, JSON.stringify(o));
        }

        function loadForm() {
            try {
                var o = JSON.parse(localStorage.getItem(SAVE_KEY) || '{}');
                for (var k in o) {
                    var el = document.getElementById(k);
                    if (!el) continue;
                    if (el.type === 'checkbox') { el.checked = !!o[k]; }
                    else if (el.type === 'date') { el.value = dateToISO(o[k]); }
                    else { el.value = o[k]; }
                }

                setTimeout(() => {
                    var vTipo = document.getElementById('viagem_tipo').value;
                    if (vTipo === 'internacional') document.getElementById('v_internacional').checked = true;
                    updateViagem(vTipo);

                    var aTipo = document.getElementById('acompanhante_tipo').value;
                    if (aTipo === 'outro_responsavel') document.getElementById('opt_resp').checked = true;
                    if (aTipo === 'terceiro') document.getElementById('opt_terceiro').checked = true;
                    if (aTipo === 'desacompanhado') document.getElementById('opt_sozinho').checked = true;
                    updateAcompVisibility(aTipo);

                    if (document.getElementById('dois_resps').checked) {
                        document.getElementById('dois_resps_visual').checked = true;
                        toggleResps(2);
                    }
                }, 300);
            } catch (e) { }
        }

        function attachAutosave() {
            for (var i = 0; i < ids.length; i++) {
                var el = document.getElementById(ids[i]);
                if (!el) continue;
                el.addEventListener('input', saveForm);
                el.addEventListener('change', saveForm);
            }
        }

        // ========== PAYLOAD E VALIDA√á√ÉO ==========
        function getPayload() {
            return {
                slug: 'autorizacao-viagem-menor',
                tipo: 'autorizacao_viagem',
                entidade: 'Viagem',
                menor_nome: document.getElementById('menor_nome').value.trim(),
                menor_nascimento: formatDateBR(document.getElementById('menor_nascimento').value),
                menor_doc: document.getElementById('menor_doc').value.trim(),
                viagem_tipo: document.getElementById('viagem_tipo').value,
                destino: document.getElementById('destino').value.trim(),
                data_ida: formatDateBR(document.getElementById('data_ida').value),
                data_volta: formatDateBR(document.getElementById('data_volta').value),
                acompanhante_tipo: document.getElementById('acompanhante_tipo').value,
                acompanhante_nome: document.getElementById('acomp_nome').value.trim(),
                acompanhante_cpf: document.getElementById('acomp_cpf').value.trim(),
                acompanhante_doc: document.getElementById('acomp_doc').value.trim(),
                acompanhante_parentesco: document.getElementById('acomp_parentesco').value.trim(),
                resp1_nome: document.getElementById('resp1_nome').value.trim(),
                resp1_cpf: document.getElementById('resp1_cpf').value.trim(),
                resp1_doc: document.getElementById('resp1_doc').value.trim(),
                resp1_parentesco: document.getElementById('resp1_parentesco').value,
                dois_resps: document.getElementById('dois_resps').checked,
                resp2_nome: document.getElementById('resp2_nome').value.trim(),
                resp2_cpf: document.getElementById('resp2_cpf').value.trim(),
                resp2_doc: document.getElementById('resp2_doc').value.trim(),
                resp2_parentesco: document.getElementById('resp2_parentesco').value,
                cidade_uf_emissao: document.getElementById('cidade_uf_emissao').value.trim(),
                email: document.getElementById('email').value.trim(),
                telefone: document.getElementById('telefone').value.trim(),
                observacoes: '',
                accepted_terms: document.getElementById('aceite_termos') ? document.getElementById('aceite_termos').checked : false,
                terms_version: document.getElementById('terms_version') ? document.getElementById('terms_version').value : null,
                accepted_at: new Date().toISOString(),
                utm: (window.LMUTM ? LMUTM.get() : {})
            };
        }

        function validateAll(p) {
            var ok = true;
            function show(id, showFlag) { var el = document.getElementById(id); if (el) el.style.display = showFlag ? 'block' : 'none'; }

            var menorNasc = formatDateBR(document.getElementById('menor_nascimento').value);
            if (!isValidDateBR(menorNasc)) { show('err_menor_nascimento', true); ok = false; }
            else show('err_menor_nascimento', false);

            var dataIda = formatDateBR(document.getElementById('data_ida').value);
            if (!isValidDateBR(dataIda)) { show('err_data_ida', true); ok = false; }
            else show('err_data_ida', false);

            var dataVolta = formatDateBR(document.getElementById('data_volta').value);
            if (!isValidDateBR(dataVolta)) { show('err_data_volta', true); ok = false; }
            else {
                var di = new Date(dateToISO(dataIda));
                var dv = new Date(dateToISO(dataVolta));
                if (isNaN(di.getTime()) || isNaN(dv.getTime()) || dv.getTime() < di.getTime()) {
                    show('err_data_volta', true); ok = false;
                } else show('err_data_volta', false);
            }

            if (p.resp1_cpf && !isValidCPF(p.resp1_cpf)) { show('err_resp1_cpf', true); ok = false; }
            else show('err_resp1_cpf', false);

            if (p.resp2_cpf && !isValidCPF(p.resp2_cpf)) { show('err_resp2_cpf', true); ok = false; }
            else show('err_resp2_cpf', false);

            if (p.acompanhante_cpf && !isValidCPF(p.acompanhante_cpf)) { show('err_acomp_cpf', true); ok = false; }
            else show('err_acomp_cpf', false);

            if (p.acompanhante_tipo !== 'desacompanhado') {
                if (!p.acompanhante_nome || !p.acompanhante_parentesco) { ok = false; }
            }

            if (!p.menor_nome || !p.resp1_nome || !p.destino || !p.cidade_uf_emissao) ok = false;

            return ok;
        }

        function validateStep(step) {
            var p = getPayload();
            var msg = '';
            if (step === 1) {
                if (!p.menor_nome || !p.menor_nascimento || !p.destino || !p.data_ida || !p.data_volta) {
                    msg = 'Preencha os dados da crian√ßa e da viagem.';
                }
            } else if (step === 2) {
                if (p.acompanhante_tipo !== 'desacompanhado') {
                    if (!p.acompanhante_nome || !p.acompanhante_parentesco) msg = 'Informe os dados do acompanhante.';
                }
            } else if (step === 3) {
                if (!p.resp1_nome) msg = 'Informe o nome do respons√°vel.';
                if (p.dois_resps && !p.resp2_nome) msg = 'Informe o nome do segundo respons√°vel.';
            } else if (step === 4) {
                if (!p.cidade_uf_emissao) msg = 'Informe sua cidade.';
            }
            if (msg) { alert(msg); return false; }
            return true;
        }

        // ========== NAVEGA√á√ÉO ENTRE STEPS ==========
        var currentStep = 1;
        function showStep(step, autoScroll = true) {
            currentStep = step;
            document.querySelectorAll('.form-step').forEach(s => {
                s.style.display = (parseInt(s.getAttribute('data-step')) === step) ? 'block' : 'none';
            });
            document.querySelectorAll('.step-item').forEach(it => {
                var n = parseInt(it.getAttribute('data-step'));
                it.classList.toggle('active', n === step);
                it.classList.toggle('completed', n < step);
            });
            if (autoScroll) {
                setTimeout(() => {
                    var fa = document.getElementById('formArea');
                    if (fa) fa.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 50);
            }
        }

        document.getElementById('nextStep1').onclick = function () { if (validateStep(1)) showStep(2); };
        document.getElementById('nextStep2').onclick = function () { if (validateStep(2)) showStep(3); };
        document.getElementById('nextStep3').onclick = function () { if (validateStep(3)) showStep(4); };
        document.getElementById('prevStep2').onclick = function () { showStep(1); };
        document.getElementById('prevStep3').onclick = function () { showStep(2); };
        document.getElementById('prevStep4').onclick = function () { showStep(3); };

        // ========== INICIALIZA√á√ÉO ==========
        document.addEventListener('DOMContentLoaded', function () {
            const principaisCidades = ["S√£o Paulo/SP", "Rio de Janeiro/RJ", "Bras√≠lia/DF", "Salvador/BA", "Belo Horizonte/MG", "Curitiba/PR", "Manaus/AM", "Recife/PE", "Porto Alegre/RS", "Florian√≥polis/SC", "Blumenau/SC", "Balne√°rio Cambori√∫/SC", "Indaial/SC", "Itaja√≠/SC", "Joinville/SC", "Campinas/SP", "Guarulhos/SP", "Goi√¢nia/GO", "Bel√©m/PA"];
            const datalist = document.getElementById('lista_cidades');
            if (datalist) {
                principaisCidades.forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c;
                    datalist.appendChild(opt);
                });
            }

            ['resp1_cpf', 'resp2_cpf', 'acomp_cpf'].forEach(id => {
                var el = document.getElementById(id);
                if (el) el.addEventListener('input', function () { this.value = maskCPF(this.value); });
            });
        });

        loadForm();
        attachAutosave();
        showStep(1, false);
        updateViagem('nacional');

        // ========== PREVIEW E PAGAMENTO ==========
        var btnPreview = document.getElementById('btnPreview');
        var btnPagar = document.getElementById('btnPagar');
        var previewWrap = document.getElementById('previewWrap');
        var previewBox = document.getElementById('previewBox');
        var paySection = document.getElementById('paySection');

        function checkCooldown() {
            var last = localStorage.getItem('last_preview_ts');
            if (last && (Date.now() - parseInt(last)) < 30000) {
                alert('Por favor, aguarde alguns segundos antes de gerar outra pr√©via.');
                return false;
            }
            return true;
        }

        function captureLead(p) {
            fetch('/.netlify/functions/capture-lead', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    email: p.email,
                    telefone: p.telefone,
                    nome: p.resp1_nome || p.menor_nome,
                    slug: 'autorizacao-viagem-menor',
                    payload: p
                })
            }).catch(err => console.log('Lead capture bg error', err));
        }

        // --- BOT√ÉO PR√âVIA (VERS√ÉO "PAYWALL" - BLOQUEIA O RESTO) ---
        if (btnPreview) {
            btnPreview.addEventListener('click', function () {
                if (!checkCooldown()) return;

                var payload = getPayload();
                if (!validateAll(payload)) {
                    alert('Verifique os campos obrigat√≥rios (destacados em vermelho).');
                    return;
                }

                btnPreview.disabled = true;
                btnPreview.textContent = '‚è≥ Gerando...';

                // Fun√ß√£o interna para lidar com retentativas
                async function tentarGerar(tentativa) {
                    var vaiTentarDeNovo = false;
                    try {
                        saveForm();

                        if (tentativa === 1 && (payload.email || payload.telefone)) {
                            captureLead(payload);
                        }

                        var r = await fetch('/.netlify/functions/generate-doc', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ payload: payload, preview: true })
                        });

                        if (r.status === 503 && tentativa === 1) {
                            console.log('Servidor ocupado (503), tentando novamente...');
                            btnPreview.textContent = '‚Üª Reconectando...';
                            vaiTentarDeNovo = true;
                            await new Promise(res => setTimeout(res, 2000));
                            return tentarGerar(2);
                        }

                        if (!r.ok) {
                            var errText = 'Falha ao gerar';
                            try { var errData = await r.json(); if (errData.body) errText = errData.body; } catch (e) { }
                            throw new Error(errText);
                        }

                        var data = await r.json();
                        var out = data.output || data;

                        // --- DESIGN DA PR√âVIA COM "CADEADO" ---

                        // 1. Pega S√ì os 2 primeiros par√°grafos (Esconde o resto)
                        var paragraphs = (out.corpo_paragrafos || []).slice(0, 2);
                        var textContent = paragraphs.join('\n\n');

                        // 2. HTML da Folha A4 com o Bloqueio no final
                        var htmlBonito = `
                            <div style="text-align:center; border-bottom:2px solid #000; padding-bottom:15px; margin-bottom:25px;">
                                <div style="font-size:32px; margin-bottom:5px;">‚öñÔ∏è</div>
                                <h2 style="font-family:'Times New Roman',serif; text-transform:uppercase; margin:0; font-size:18px; color:#000;">Autoriza√ß√£o de Viagem</h2>
                                <p style="font-family:Arial,sans-serif; font-size:11px; margin:5px 0 0 0; color:#555;">
                                    Conforme Resolu√ß√£o CNJ n¬∫ 295/2019 e Estatuto da Crian√ßa e do Adolescente
                                </p>
                            </div>

                            <div style="font-family:'Times New Roman',serif; font-size:15px; line-height:1.6; text-align:justify; color:#000;">
                                ${textContent.replace(/\n/g, '<br>')}
                            </div>

                            <div style="margin-top: 25px; background: #f8fafc; border: 1px dashed #94a3b8; border-radius: 8px; padding: 15px; text-align: center; position: relative;">
                                <div style="font-size: 24px; margin-bottom: 5px;">üîí</div>
                                <div style="font-family: Arial, sans-serif; font-size: 12px; font-weight: bold; color: #475569; text-transform: uppercase; margin-bottom: 6px;">
                                    Restante do documento oculto
                                </div>
                                <div style="font-family: Arial, sans-serif; font-size: 11px; color: #64748b; line-height: 1.5;">
                                    A identifica√ß√£o do acompanhante, a fundamenta√ß√£o legal completa e o <br><strong>checklist de documentos obrigat√≥rios</strong> estar√£o dispon√≠veis no arquivo final.
                                </div>
                            </div>
                            
                            <div style="margin-top:20px; text-align: center; font-family:Arial,sans-serif; font-size:10px; color:#999;">
                                Pr√©-visualiza√ß√£o parcial gerada por CartasApp.com.br
                            </div>
                        `;

                        // 3. Aplica
                        var pBox = document.getElementById('previewBox');
                        pBox.innerHTML = htmlBonito;

                        pBox.style.backgroundColor = "#fff";
                        pBox.style.padding = "30px";
                        pBox.style.border = "1px solid #ccc";
                        pBox.style.boxShadow = "0 5px 15px rgba(0,0,0,0.1)";
                        pBox.style.whiteSpace = "normal";

                        // -------------------------------------

                        previewWrap.style.display = 'block';
                        paySection.style.display = 'block';
                        btnPreview.style.display = 'none';

                        setTimeout(function () {
                            if (previewWrap) previewWrap.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }, 100);

                        if (typeof gtag === 'function') {
                            gtag('event', 'generate_lead', { 'event_category': 'engagement', 'event_label': 'viagem_nacional', 'value': 2.00, 'currency': 'BRL' });
                        }

                        localStorage.setItem('pendingPayload', JSON.stringify(payload));
                        localStorage.setItem('last_preview_ts', Date.now());
                        btnPagar.disabled = false;

                    } catch (e) {
                        if (!vaiTentarDeNovo) {
                            if (e.message !== 'Campos inv√°lidos') { alert('Erro ao gerar: ' + e.message); }
                            btnPreview.disabled = false;
                            btnPreview.textContent = 'üìÑ Ver Pr√©via do Documento';
                        }
                    }
                }

                tentarGerar(1);
            });
        }

        if (btnPagar) btnPagar.addEventListener('click', function () {
            document.getElementById('modalTermos').style.display = 'flex';
        });

        document.getElementById('btnCancelarTermos').onclick = function () {
            document.getElementById('modalTermos').style.display = 'none';
        };

        document.getElementById('btnConfirmarTermos').onclick = async function () {
            var btnConfirm = document.getElementById('btnConfirmarTermos');
            var checkbox = document.getElementById('aceite_termos');
            if (!checkbox.checked) {
                alert('Voc√™ precisa marcar a caixa "Li e concordo" para continuar.');
                return;
            }
            btnConfirm.disabled = true;
            btnConfirm.textContent = 'Processando...';

            try {
                var payload = getPayload();
                saveForm();
                localStorage.setItem('pendingPayload', JSON.stringify(payload));
                var slugStr = 'autorizacao-viagem-menor';
                var r = await fetch('/.netlify/functions/mp-checkout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        slug: slugStr,
                        payload: payload,
                        utm: (window.LMUTM ? LMUTM.get() : {})
                    })
                });
                var data = await r.json();
                if (!r.ok) throw new Error(data.error || 'Erro no pagamento');
                document.getElementById('modalTermos').style.display = 'none';
                localStorage.setItem('lastOrderId', data.order_id || '');
                if (typeof gtag === 'function') {
                    gtag('event', 'begin_checkout', {
                        value: 29.9,
                        currency: 'BRL',
                        items: [{ item_id: slugStr }]
                    });
                }
                showPaymentModal(data.init_point, data.order_id, slugStr);
            } catch (e) {
                alert('Erro: ' + e.message);
            } finally {
                btnConfirm.disabled = false;
                btnConfirm.textContent = 'Confirmar e Pagar';
            }
        };

        function showPaymentModal(initPoint, orderId, slug) {
            var isLight = (document.documentElement.getAttribute('data-theme') === 'light');
            var cardBG = isLight ? '#ffffff' : '#111827';
            var cardText = isLight ? '#0f172a' : '#e6eefb';
            var overlay = document.createElement('div');
            overlay.style = 'position:fixed;inset:0;background:rgba(2,6,23,.85);backdrop-filter:blur(4px);z-index:9999;display:flex;align-items:center;justify-content:center';
            overlay.innerHTML =
                '<div style="background:' + cardBG + ';color:' + cardText + ';border:1px solid var(--border);border-radius:16px;max-width:400px;width:90%;padding:24px;box-shadow:0 20px 50px rgba(0,0,0,.4);text-align:center;">' +
                '<div style="font-size:40px;margin-bottom:16px;">üí∏</div>' +
                '<h3 style="margin:0 0 12px;font-size:20px;">Quase l√°!</h3>' +
                '<p style="margin:0 0 20px;line-height:1.5;color:var(--text-secondary);">Clique no bot√£o abaixo para finalizar o pagamento com seguran√ßa no Mercado Pago.</p>' +
                '<div style="display:flex;flex-direction:column;gap:12px;">' +
                '<button id="lm-goPay" class="btn btn-primary" style="width:100%;padding:14px;font-size:16px;justify-content:center;">Ir para Pagamento (Pix ou Cart√£o)</button>' +
                '<button id="lm-close" class="btn btn-outline" style="width:100%;justify-content:center;border:none;">Fechar e corrigir dados</button>' +
                '</div>' +
                '<p id="lm-statusPay" class="small" style="margin-top:16px;font-size:12px;opacity:0.8;"></p>' +
                '</div>';
            document.body.appendChild(overlay);

            document.getElementById('lm-close').onclick = function () {
                overlay.remove();
                try { grecaptcha.reset(); } catch (e) { }
                var btnPagar = document.getElementById('btnPagar');
                if (btnPagar) {
                    btnPagar.disabled = false;
                    btnPagar.textContent = 'Gerar documento completo (R$ 29,90)';
                }
            };

            async function docReady() {
                try {
                    var r = await fetch('/.netlify/functions/generate-doc', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ payload: { order_id: orderId }, preview: false })
                    });
                    if (!r.ok) return false;
                    var j = await r.json();
                    return !!(j && j.output);
                } catch (e) { return false; }
            }

            document.getElementById('lm-goPay').onclick = function () {
                window.open(initPoint, '_blank', 'noopener');
                var btn = this;
                btn.textContent = 'Verificando pagamento...';
                document.getElementById('lm-statusPay').textContent = 'Aguarde, estamos confirmando seu pagamento...';
                var iv = setInterval(async function () {
                    try {
                        if (await docReady()) {
                            clearInterval(iv);
                            location.href = '/success.html?o=' + encodeURIComponent(orderId) + '&slug=' + encodeURIComponent(slug) + '&s=success';
                            return;
                        }
                        var rr = await fetch('/.netlify/functions/order-status?o=' + encodeURIComponent(orderId));
                        var jj = rr.ok ? await rr.json() : null;
                        if (jj && jj.status === 'paid') {
                            clearInterval(iv);
                            location.href = '/success.html?o=' + encodeURIComponent(orderId) + '&slug=' + encodeURIComponent(slug) + '&s=success';
                        }
                    } catch (e) { }
                }, 3000);
            };
        }

        // ========== MODO ADMIN ==========
        (function () {
            const params = new URLSearchParams(window.location.search);
            if (params.get('modo') === 'admin') {
                const btnPagar = document.querySelector('[id*="Pagar"], [id*="pagar"]') || document.getElementById('btnPagar');
                if (!btnPagar) return;
                const btnArea = btnPagar.parentElement;
                const btnAdmin = document.createElement('button');
                btnAdmin.className = 'btn';
                btnAdmin.style.backgroundColor = '#8b5cf6';
                btnAdmin.style.color = 'white';
                btnAdmin.style.border = 'none';
                btnAdmin.style.marginTop = '10px';
                btnAdmin.style.width = '100%';
                btnAdmin.innerText = 'üëë Gerar Admin';
                btnAdmin.onclick = async function () {
                    const senha = prompt("Digite a senha de Admin:");
                    if (!senha) return;
                    btnAdmin.innerText = 'Gerando...';
                    btnAdmin.disabled = true;
                    try {
                        var p = getPayload();
                        p.admin_key = senha;
                        var r = await fetch('/.netlify/functions/generate-doc', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ payload: p, preview: false })
                        });
                        if (!r.ok) throw new Error('Senha errada');
                        var data = await r.json();
                        if (data.output) {
                            let fullText = '';
                            if (data.output.saudacao) fullText += data.output.saudacao + '\n\n';
                            if (Array.isArray(data.output.corpo_paragrafos)) fullText += data.output.corpo_paragrafos.join('\n\n');
                            else fullText += String(data.output.corpo_paragrafos);
                            if (data.output.fechamento) fullText += '\n\n' + data.output.fechamento;
                            const previewBox = document.getElementById('previewBox');
                            const previewWrap = document.getElementById('previewWrap');
                            if (previewBox && previewWrap) {
                                previewBox.textContent = fullText;
                                previewBox.style.whiteSpace = 'pre-wrap';
                                previewWrap.style.display = 'block';
                                const oldCopyBtn = document.getElementById('admin-copy-btn');
                                if (oldCopyBtn) oldCopyBtn.remove();
                                const copyBtn = document.createElement('button');
                                copyBtn.id = 'admin-copy-btn';
                                copyBtn.className = 'btn btn-primary';
                                copyBtn.style.marginTop = '16px';
                                copyBtn.innerText = 'üìã Copiar Documento';
                                copyBtn.onclick = async function () {
                                    await navigator.clipboard.writeText(fullText);
                                    copyBtn.innerText = '‚úÖ Copiado!';
                                    setTimeout(() => { copyBtn.innerText = 'üìã Copiar Documento'; }, 2000);
                                };
                                previewWrap.appendChild(copyBtn);
                                previewWrap.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                alert("‚úÖ Documento Admin Gerado!");
                            }
                        }
                    } catch (e) { alert('‚ùå Erro: ' + e.message); }
                    finally { btnAdmin.innerText = 'üëë Gerar Admin'; btnAdmin.disabled = false; }
                };
                btnArea.appendChild(btnAdmin);
            }
        })();
    </script>
</body>

</html>
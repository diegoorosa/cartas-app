<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8" />
  <title>Carta de Bagagem Extraviada ou Danificada | CartasApp</title>
  <meta name="description"
    content="Gere uma carta formal de reclama√ß√£o por bagagem extraviada ou danificada, baseada no CDC e normas da ANAC. Preencha os dados e baixe em PDF/DOC por R$ 9,90." />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="/theme.js"></script>
  <link rel="stylesheet" href="/style.css" />
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-1021062139"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'AW-1021062139');
    gtag('config', 'G-D40QPP9KNP');
  </script>
  <script src="/gtag.js"></script>
  <script
    type="text/javascript">(function (c, l, a, r, i, t, y) { c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) }; t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i; y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y); })(window, document, "clarity", "script", "u4x90t35gk");</script>
  <link rel="canonical" href="https://www.cartasapp.com.br/bagagem.html" />
</head>

<body>
  <nav class="navbar">
    <div class="container">
      <div class="navbar-content">
        <a href="/" class="logo">CartasApp</a>
        <div class="nav-actions">
          <button class="btn-theme" onclick="toggleTheme()">üåô</button>
          <a href="https://wa.me/5547991323024" class="btn btn-secondary btn-sm" target="_blank">WhatsApp</a>
        </div>
      </div>
    </div>
  </nav>

  <section class="hero" style="padding: 60px 0 40px;">
    <div class="container">
      <div class="hero-content">
        <div class="hero-badge">üß≥ Bagagem & Direitos do Passageiro</div>
        <h1 style="font-size: 42px; line-height: 1.2;">
          Carta de reclama√ß√£o por bagagem extraviada ou danificada em minutos
        </h1>
        <p class="hero-subtitle" style="font-size: 18px; margin-top: 16px;">
          Descreva o voo e o problema e gere uma <strong>carta formal de reclama√ß√£o</strong>,
          baseada no <strong>C√≥digo de Defesa do Consumidor</strong> e normas da <strong>ANAC</strong>,
          pronta para enviar √† companhia a√©rea, em PDF e Word, por apenas <strong>R$ 9,90</strong>.
        </p>

        <div class="hero-actions" style="margin-top: 24px;">
          <a href="#formArea" class="btn btn-primary">
            Come√ßar agora (leva menos de 5 minutos)
          </a>
          <a href="/bagagem-faq.html" class="btn btn-secondary btn-sm"
            style="border-radius: 50px; font-size: 14px;">
            ‚ùì D√∫vidas sobre indeniza√ß√£o
          </a>
        </div>

        <div style="display: flex; gap: 15px; justify-content: center; margin-top: 16px; flex-wrap: wrap;">
          <span
            style="background: rgba(16, 185, 129, 0.1); color: #10b981; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 600;">‚öñÔ∏è
            Baseada no CDC e normas da ANAC</span>
          <span
            style="background: rgba(59, 130, 246, 0.1); color: #3b82f6; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 600;">üìÑ
            Pronta para enviar para a companhia a√©rea</span>
          <span
            style="background: rgba(234, 179, 8, 0.12); color: #eab308; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 600;">üí∞
            Pagamento √∫nico, sem mensalidade</span>
        </div>

        <div style="margin-top: 12px; font-size: 13px; color: var(--text-muted);">
          ‚≠êÔ∏è <strong>4,9 de 5</strong> ‚Äî passageiros j√° usaram para registrar reclama√ß√£o formal de bagagem.
        </div>
      </div>
    </div>
  </section>

  <section class="section" style="padding-top: 0;">
    <div class="container">
      <div style="max-width: 800px; margin: 0 auto;">
        <div class="card">

          <!-- Blocos de confian√ßa / base legal -->
          <div class="small legal-note" style="margin-bottom: 16px;">
            <p class="small" style="margin: 0;">
              ‚Ä¢ Carta redigida com base no <strong>C√≥digo de Defesa do Consumidor</strong> e nas
              <strong>normas da ANAC</strong> sobre responsabilidade por bagagem.<br>
              ‚Ä¢ Ajuda a formalizar sua reclama√ß√£o por <strong>extravio</strong> ou
              <strong>danos √† bagagem</strong>, registrando os fatos e o pedido de indeniza√ß√£o ou reparo.<br>
              ‚Ä¢ Arquivos em <strong>PDF e Word</strong>, prontos para enviar por e-mail, protocolo ou at√© cart√≥rio,
              se desejar.
            </p>
          </div>

          <div class="small"
            style="margin-bottom: 16px; padding: 12px 14px; border-radius: 10px; background: var(--card-hover); border: 1px solid var(--border);">
            <strong>Por R$ 9,90 (pagamento √∫nico)</strong>, voc√™ recebe:<br>
            ‚Ä¢ Carta personalizada com seus dados, do voo e da ocorr√™ncia.<br>
            ‚Ä¢ Texto formal em linguagem jur√≠dica simples, indicando o que aconteceu e o que voc√™ est√° pedindo.<br>
            ‚Ä¢ Vers√£o em PDF e Word para ajustar, imprimir, assinar e enviar.<br>
            ‚Ä¢ Suporte por WhatsApp em caso de d√∫vidas sobre o documento.
          </div>

          <p class="small" style="margin-bottom: 24px; color: var(--text-muted);">
            Aten√ß√£o: a carta <strong>n√£o garante indeniza√ß√£o</strong>. A decis√£o √© da companhia a√©rea e,
            em √∫ltimo caso, do Judici√°rio. Este site n√£o substitui advogado ou consultoria jur√≠dica
            individual.
          </p>

          <div id="formArea">
            <!-- Passos -->
            <div class="step-indicator">
              <div class="step-item" data-step="1">1. Passageiro</div>
              <div class="step-item" data-step="2">2. Voo</div>
              <div class="step-item" data-step="3">3. Ocorr√™ncia & pedido</div>
            </div>

            <!-- PASSO 1 -->
            <div class="form-step" data-step="1" id="step-1">
              <h2 class="section-title" style="font-size: 24px; margin-bottom: 24px;">Passageiro</h2>

              <label class="label">Nome completo <span class="required-star">*</span></label>
              <input class="input" id="nome" placeholder="Ex.: Jo√£o Silva" />

              <label class="label">CPF <span class="required-star">*</span></label>
              <input class="input" id="cpf" placeholder="000.000.000-00" inputmode="numeric" maxlength="14" />
              <div id="err_cpf" class="small" style="display:none;color:#fca5a5;margin-top:4px;">
                CPF inv√°lido.
              </div>

              <label class="label">E-mail (opcional)</label>
              <input class="input" id="email" placeholder="seu@email.com" />

              <label class="label">Telefone (opcional)</label>
              <input class="input" id="telefone" placeholder="(00) 00000-0000" />

              <div class="form-navigation">
                <span class="small" style="align-self:center;color:var(--text-muted);">
                  Campos marcados com <span class="required-star">*</span> s√£o obrigat√≥rios.
                </span>
                <button type="button" class="btn btn-primary" id="nextStep1">
                  Pr√≥ximo passo
                </button>
              </div>
            </div>

            <!-- PASSO 2 -->
            <div class="form-step" data-step="2" id="step-2">
              <h2 class="section-title" style="font-size: 24px; margin-bottom: 24px;">Voo</h2>

              <label class="label">Companhia a√©rea <span class="required-star">*</span></label>
              <input class="input" id="cia" placeholder="Ex.: LATAM, GOL, Azul" />

              <label class="label">N¬∫ do voo <span class="required-star">*</span></label>
              <input class="input" id="voo" placeholder="Ex.: LA1234" />

              <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:20px;">
                <div>
                  <label class="label">Data do voo <span class="required-star">*</span></label>
                  <input class="input" id="data_voo" placeholder="DD/MM/AAAA" inputmode="numeric" maxlength="10" />
                  <div id="err_data_voo" class="small" style="display:none;color:#fca5a5;margin-top:4px;">
                    Data inv√°lida.
                  </div>
                </div>
                <div>
                  <label class="label">Protocolo/PIR (recomendado)</label>
                  <input class="input" id="pir" placeholder="Ex.: PIR-ABC123 (pe√ßa no balc√£o da companhia)" />
                  <p class="small" style="margin-top:4px;">
                    O registro de PIR/Relat√≥rio de Irregularidade de Bagagem fortalece sua reclama√ß√£o,
                    mas se n√£o tiver ainda, voc√™ pode preencher depois.
                  </p>
                </div>
              </div>

              <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:20px;">
                <div>
                  <label class="label">Origem <span class="required-star">*</span></label>
                  <input class="input" id="origem" placeholder="Ex.: GRU" />
                </div>
                <div>
                  <label class="label">Destino <span class="required-star">*</span></label>
                  <input class="input" id="destino" placeholder="Ex.: REC" />
                </div>
              </div>

              <div class="form-navigation">
                <button type="button" class="btn btn-secondary" id="prevStep2">
                  Voltar
                </button>
                <button type="button" class="btn btn-primary" id="nextStep2">
                  Pr√≥ximo passo
                </button>
              </div>
            </div>

            <!-- PASSO 3 -->
            <div class="form-step" data-step="3" id="step-3">
              <h2 class="section-title" style="font-size: 24px; margin-bottom: 24px;">Ocorr√™ncia</h2>

              <label class="label">Tipo de problema <span class="required-star">*</span></label>
              <select class="input" id="status">
                <option value="extraviada">Extraviada (mala sumiu)</option>
                <option value="danificada">Danificada (quebrada/rasgada)</option>
              </select>

              <label class="label" style="margin-top:20px;">
                Descri√ß√£o dos itens/avarias <span class="required-star">*</span>
              </label>
              <textarea class="input" id="descricao" rows="3"
                placeholder="Ex.: Mala preta marca Samsonite 23kg. A roda foi arrancada e o z√≠per estourado."></textarea>

              <label class="label" style="margin-top:20px;">
                Preju√≠zo / Pedido <span class="required-star">*</span>
              </label>
              <textarea class="input" id="despesas" rows="3"
                placeholder="Ex.: Solicito o conserto da mala (or√ßamento R$ 200,00 em anexo) ou uma mala nova equivalente."></textarea>
              <p class="small" style="margin-top:4px;">
                Descreva o que voc√™ quer (conserto, reembolso em dinheiro, mala nova, etc.).
              </p>

              <h2 class="section-title" style="font-size: 24px; margin: 24px 0 16px;">Local</h2>
              <label class="label">Cidade/UF (onde voc√™ mora) <span class="required-star">*</span></label>
              <input class="input" id="cidade_uf" placeholder="Ex.: Blumenau/SC" />

              <div style="margin-top:20px;">
                <div class="form-navigation">
                  <button type="button" class="btn btn-secondary" id="prevStep3">
                    Voltar
                  </button>
                  <div id="previewBtnArea" style="flex:1;display:flex;justify-content:flex-end;">
                    <button class="btn btn-secondary" id="btnPreview" style="width:100%">
                      Gerar pr√©via gratuita
                    </button>
                  </div>
                </div>
                <p class="small" style="margin-top:8px;">
                  Voc√™ ver√° um <strong>trecho gratuito</strong> da carta antes de decidir pagar.
                </p>

                <div id="paySection"
                  style="display:none; margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border);">
                  <div class="price-badge" style="margin-bottom: 20px;">
                    Oferta hoje: <span class="price-old">de R$ 29,90</span> <span class="price-new">por R$ 9,90</span>
                    <span class="timer-text">‚ö° O pre√ßo pode voltar ao normal em breve</span>
                  </div>
                  <button class="btn btn-primary" id="btnPagar" style="width: 100%;">
                    Gerar documento completo (R$ 9,90)
                  </button>
                </div>
              </div>

              <div class="guarantee-badge">
                <span class="guarantee-icon">üîí</span>
                <div><strong>Garantia Total:</strong> Receba seu documento pronto ou devolvemos seu dinheiro.</div>
              </div>
            </div>
          </div>

          <div id="previewWrap"
            style="display:none; margin-top:32px; padding-top:32px; border-top:1px solid var(--border);">
            <h2 class="section-title" style="font-size: 24px; margin-bottom: 20px;">Pr√©via do documento</h2>
            <div style="background:var(--bg-secondary);border:1px solid var(--border);border-radius:12px;padding:24px;">
              <div id="previewBox"
                style="white-space:pre-wrap;font-family:monospace;font-size:14px;line-height:1.8;color:var(--text-secondary);">
              </div>
            </div>
            <p class="small" style="margin-top:12px;color:var(--text-muted);">
              Pr√©via gratuita e parcial. O documento completo (edi√ß√£o, PDF e Word) √© liberado ap√≥s o pagamento √∫nico de
              <strong>R$ 9,90</strong>.
            </p>
          </div>

          <!-- Mini FAQ -->
          <div style="margin-top:32px;border-top:1px solid var(--border);padding-top:24px;">
            <h2 class="section-title" style="font-size: 22px; margin-bottom: 12px;">
              Perguntas r√°pidas
            </h2>
            <p class="small">
              <strong>Preciso do protocolo/PIR para usar esta carta?</strong><br>
              O ideal √© registrar o <strong>PIR/Relat√≥rio de Irregularidade de Bagagem</strong> no balc√£o da companhia
              ainda no aeroporto. Mas, se n√£o tiver o n√∫mero na hora, voc√™ pode gerar a carta e incluir o protocolo
              depois.
            </p>
            <p class="small" style="margin-top:8px;">
              <strong>Esta carta garante indeniza√ß√£o?</strong><br>
              N√£o. A carta serve para <strong>formalizar sua reclama√ß√£o</strong> e registrar seu pedido de reparo ou
              reembolso.
              A solu√ß√£o pode vir pela pr√≥pria companhia, via ANAC, Procon ou, se necess√°rio, via Juizado/Justi√ßa.
            </p>
            <p class="small" style="margin-top:8px;">
              <strong>Posso usar com companhia a√©rea internacional?</strong><br>
              Sim, voc√™ pode adaptar o texto para voos internacionais. Em voos para o exterior tamb√©m se aplica a
              <strong>Conven√ß√£o de Montreal</strong>, que trata de responsabilidade por bagagem despachada.
            </p>
            <p class="small" style="margin-top:8px;">
              <strong>√â pagamento √∫nico?</strong><br>
              Sim. Voc√™ paga <strong>R$ 9,90 apenas uma vez</strong> por documento gerado, sem mensalidades.
            </p>
          </div>

        </div>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="container">
        <div class="footer-content">
            <p>
                Este site n√£o presta aconselhamento jur√≠dico. Leia os
                <a href="/termos.html" class="footer-link">Termos de Uso</a>,
                <a href="/privacidade.html" class="footer-link">Pol√≠tica de Privacidade</a>,
                conhe√ßa mais em
                <a href="/sobre.html" class="footer-link">Sobre o CartasApp</a>
                e visite nossa
                <a href="/blog.html" class="footer-link">Central de Ajuda</a>.
            </p>
        </div>
    </div>
</footer>
  <a href="https://wa.me/5547991323024?text=Ol%C3%A1!%20Preciso%20de%20ajuda%20no%20CartasApp." class="whatsapp-float"
    target="_blank" aria-label="Falar no WhatsApp">
    <svg viewBox="0 0 24 24" class="whatsapp-icon">
      <path
        d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z" />
    </svg></a>

  <script src="/utm.js"></script>
  <script>
    function maskCPF(v) {
      v = (v || '').replace(/\D/g, '').slice(0, 11);
      v = v.replace(/(\d{3})(\d)/, '$1.$2');
      v = v.replace(/(\d{3})(\d)/, '$1.$2');
      v = v.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
      return v;
    }
    function isValidCPF(cpf) {
      var s = (cpf || '').replace(/\D/g, '');
      if (s.length !== 11) return false;
      if (/^(\d)\1{10}$/.test(s)) return false;
      var i, sum = 0, rest;
      for (i = 1; i <= 9; i++) sum += parseInt(s.substring(i - 1, i)) * (11 - i);
      rest = (sum * 10) % 11;
      if (rest === 10 || rest === 11) rest = 0;
      if (rest !== parseInt(s.substring(9, 10))) return false;
      sum = 0;
      for (i = 1; i <= 10; i++) sum += parseInt(s.substring(i - 1, i)) * (12 - i);
      rest = (sum * 10) % 11;
      if (rest === 10 || rest === 11) rest = 0;
      if (rest !== parseInt(s.substring(10, 11))) return false;
      return true;
    }
    function maskDate(v) {
      v = (v || '').replace(/\D/g, '').slice(0, 8);
      if (v.length >= 5) v = v.replace(/(\d{2})(\d{2})(\d{1,4})/, '$1/$2/$3');
      else if (v.length >= 3) v = v.replace(/(\d{2})(\d{1,2})/, '$1/$2');
      return v;
    }
    function isValidDateBR(s) {
      if (!/^\d{2}\/\d{2}\/\d{4}$/.test(s || '')) return false;
      var d = parseInt(s.substr(0, 2), 10), m = parseInt(s.substr(3, 2), 10), y = parseInt(s.substr(6, 4), 10);
      if (y < 1900 || y > 2100 || m < 1 || m > 12 || d < 1 || d > 31) return false;
      var md = [31, (y % 4 === 0 && y % 100 !== 0) || y % 400 === 0 ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
      if (d > md[m - 1]) return false;
      return true;
    }

    var cpfEl = document.getElementById('cpf');
    cpfEl.addEventListener('input', function () { cpfEl.value = maskCPF(cpfEl.value); });
    var dataVooEl = document.getElementById('data_voo');
    if (dataVooEl) { dataVooEl.addEventListener('input', function () { this.value = maskDate(this.value); }); }

    function getPayload() {
      cpfEl.value = maskCPF(cpfEl.value);
      return {
        tipo: 'bagagem',
        slug: 'carta-bagagem',
        nome: document.getElementById('nome').value.trim(),
        cpf: document.getElementById('cpf').value.trim(),
        email: document.getElementById('email').value.trim(),
        telefone: document.getElementById('telefone').value.trim(),
        cia: document.getElementById('cia').value.trim(),
        voo: document.getElementById('voo').value.trim(),
        data_voo: document.getElementById('data_voo').value.trim(),
        pir: document.getElementById('pir').value.trim(),
        origem: document.getElementById('origem').value.trim(),
        destino: document.getElementById('destino').value.trim(),
        status: document.getElementById('status').value,
        descricao: document.getElementById('descricao').value.trim(),
        despesas: document.getElementById('despesas').value.trim(),
        cidade_uf: document.getElementById('cidade_uf').value.trim(),
        utm: (window.LMUTM ? LMUTM.get() : {})
      };
    }

    function validateAll(p) {
      var ok = true;
      var cpfErr = document.getElementById('err_cpf');

      if (!p.nome || !p.cpf || !p.cia || !p.voo || !p.data_voo || !p.origem || !p.destino ||
        !p.status || !p.cidade_uf || !p.descricao || !p.despesas) {
        ok = false;
      }

      if (!p.cpf || !isValidCPF(p.cpf)) {
        ok = false;
        if (cpfErr) cpfErr.style.display = 'block';
      } else {
        if (cpfErr) cpfErr.style.display = 'none';
      }

      if (!isValidDateBR(p.data_voo)) {
        ok = false;
        document.getElementById('err_data_voo').style.display = 'block';
      } else {
        document.getElementById('err_data_voo').style.display = 'none';
      }

      return ok;
    }

    // ---------- MULTI-STEP ----------
    var currentStep = 1;
    function showStep(step) {
      currentStep = step;
      var steps = document.querySelectorAll('.form-step');
      steps.forEach(function (s) {
        var n = parseInt(s.getAttribute('data-step'), 10);
        s.style.display = (n === step) ? 'block' : 'none';
      });
      var items = document.querySelectorAll('.step-item');
      items.forEach(function (it) {
        var n = parseInt(it.getAttribute('data-step'), 10);
        it.classList.toggle('active', n === step);
        it.classList.toggle('completed', n < step);
      });
    }

    function validateStep(step) {
      var p = getPayload();
      var msg = '';

      if (step === 1) {
        if (!p.nome || !p.cpf) msg = 'Preencha nome e CPF.';
        else if (!isValidCPF(p.cpf)) msg = 'CPF inv√°lido.';
      } else if (step === 2) {
        if (!p.cia || !p.voo || !p.data_voo || !p.origem || !p.destino) {
          msg = 'Preencha os dados principais do voo (companhia, n¬∫ do voo, data, origem e destino).';
        } else if (!isValidDateBR(p.data_voo)) {
          msg = 'Data do voo inv√°lida.';
        }
      } else if (step === 3) {
        if (!p.descricao || !p.despesas || !p.cidade_uf) {
          msg = 'Descreva a ocorr√™ncia, o que voc√™ est√° pedindo e informe a cidade/UF.';
        }
      }

      if (msg) {
        alert(msg);
        return false;
      }
      return true;
    }

    var nextStep1 = document.getElementById('nextStep1');
    if (nextStep1) nextStep1.addEventListener('click', function () {
      if (validateStep(1)) showStep(2);
    });

    var nextStep2 = document.getElementById('nextStep2');
    if (nextStep2) nextStep2.addEventListener('click', function () {
      if (validateStep(2)) showStep(3);
    });

    var prevStep2 = document.getElementById('prevStep2');
    if (prevStep2) prevStep2.addEventListener('click', function () {
      showStep(1);
    });

    var prevStep3 = document.getElementById('prevStep3');
    if (prevStep3) prevStep3.addEventListener('click', function () {
      showStep(2);
    });

    showStep(1);

    var btnPreview = document.getElementById('btnPreview');
    var btnPagar = document.getElementById('btnPagar');
    var previewWrap = document.getElementById('previewWrap');
    var previewBox = document.getElementById('previewBox');
    var paySection = document.getElementById('paySection');

    function checkCooldown() {
      var last = localStorage.getItem('last_preview_ts');
      if (last && (Date.now() - parseInt(last)) < 30000) {
        alert('Por favor, aguarde alguns segundos antes de gerar outra pr√©via.');
        return false;
      }
      return true;
    }

    // PR√âVIA (BAGAGEM)
    btnPreview.addEventListener('click', async function () {
      if (!checkCooldown()) return;

      btnPreview.disabled = true;
      btnPreview.style.opacity = '0.5';
      btnPreview.style.cursor = 'not-allowed';
      btnPreview.textContent = '‚è≥ Gerando pr√©via...';

      async function tentarGerar(tentativa) {
        var vaiTentarDeNovo = false;
        try {
          var p = getPayload();
          if (!validateAll(p)) {
            alert('Preencha os campos obrigat√≥rios.');
            btnPreview.disabled = false;
            btnPreview.style.opacity = '1';
            btnPreview.style.cursor = 'pointer';
            btnPreview.textContent = 'Gerar pr√©via gratuita';
            return;
          }

          var r = await fetch('/.netlify/functions/generate-doc', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ payload: p, preview: true })
          });

          if (r.status === 503 && tentativa === 1) {
            btnPreview.textContent = '‚Üª Reconectando...';
            vaiTentarDeNovo = true;
            await new Promise(res => setTimeout(res, 2000));
            return tentarGerar(2);
          }

          if (!r.ok) throw new Error('Falha');

          var d = await r.json();
          var out = d.output || d;
          var pr = out.corpo_paragrafos || [];
          var parcial = pr.slice(0, 2).join('\n\n') + '\n\n[...]';

          previewBox.textContent = (out.saudacao || '') + '\n\n' + parcial;
          previewWrap.style.display = 'block';

          paySection.style.display = 'block';
          document.getElementById('previewBtnArea').style.display = 'none';

          if (typeof gtag === 'function') {
            gtag('event', 'generate_lead', {
              'send_to': 'AW-1021062139/Ri4bCICS88IbEPvX8OYD',
              'event_category': 'engagement',
              'event_label': 'bagagem',
              'value': 2.00,
              'currency': 'BRL'
            });
          }

          localStorage.setItem('pendingPayload', JSON.stringify(p));
          localStorage.setItem('last_preview_ts', Date.now());
          btnPagar.disabled = false;

        } catch (e) {
          if (!vaiTentarDeNovo) {
            if (e.message !== 'Inv√°lido') alert('Erro: ' + e.message);
            btnPreview.disabled = false;
            btnPreview.style.opacity = '1';
            btnPreview.style.cursor = 'pointer';
            btnPreview.textContent = 'Gerar pr√©via gratuita';
          }
        }
      }
      tentarGerar(1);
    });

    // PAGAR
    btnPagar.addEventListener('click', async function () {
      btnPagar.disabled = true; btnPagar.textContent = 'Preparando...';
      try {
        var p = getPayload(); if (!validateAll(p)) { alert('Verifique os campos obrigat√≥rios.'); throw new Error('Inv√°lido'); }
        var r = await fetch('/.netlify/functions/mp-checkout', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ slug: 'carta-bagagem', payload: p, utm: (window.LMUTM ? LMUTM.get() : {}) })
        });
        var data = await r.json(); if (!r.ok) throw new Error(data.error);

        if (typeof gtag === 'function') {
          gtag('event', 'begin_checkout', {
            value: 9.9,
            currency: 'BRL',
            items: [{ item_id: 'carta-bagagem' }]
          });
        }

        showPaymentModal(data.init_point, data.order_id, 'carta-bagagem');
      } catch (e) {
        if (e.message !== 'Inv√°lido') alert('Erro: ' + e.message);
        btnPagar.disabled = false; btnPagar.textContent = 'Gerar documento completo (R$ 9,90)';
      }
    });

    function showPaymentModal(initPoint, orderId, slug) {
      var isLight = (document.documentElement.getAttribute('data-theme') === 'light');
      var cardBG = isLight ? '#ffffff' : '#111827'; var cardText = isLight ? '#0f172a' : '#e6eefb';
      var overlay = document.createElement('div');
      overlay.style = 'position:fixed;inset:0;background:rgba(2,6,23,.85);backdrop-filter:blur(4px);z-index:9999;display:flex;align-items:center;justify-content:center';
      overlay.innerHTML =
        '<div style="background:' + cardBG + ';color:' + cardText + ';border:1px solid var(--border);border-radius:16px;max-width:400px;width:90%;padding:24px;box-shadow:0 20px 50px rgba(0,0,0,.4);text-align:center;">' +
        '<div style="font-size:40px;margin-bottom:16px;">üí∏</div>' +
        '<h3 style="margin:0 0 12px;font-size:20px;">Quase l√°!</h3>' +
        '<p style="margin:0 0 20px;line-height:1.5;color:var(--text-secondary);">Clique abaixo para finalizar.</p>' +
        '<div style="display:flex;flex-direction:column;gap:12px;">' +
        '<button id="lm-goPay" class="btn btn-primary" style="width:100%;padding:14px;font-size:16px;justify-content:center;">Ir para Pagamento (Pix/Cart√£o)</button>' +
        '<button id="lm-close" class="btn btn-outline" style="width:100%;justify-content:center;border:none;">Fechar e corrigir</button>' +
        '</div>' +
        '<p id="lm-statusPay" class="small" style="margin-top:16px;font-size:12px;opacity:0.8;"></p>' +
        '</div>';
      document.body.appendChild(overlay);
      document.getElementById('lm-close').onclick = function () {
        overlay.remove(); var btn = document.getElementById('btnPagar'); if (btn) { btn.disabled = false; btn.textContent = 'Gerar documento completo (R$ 9,90)'; }
      };
      async function docReady() {
        try {
          var r = await fetch('/.netlify/functions/generate-doc', {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ payload: { order_id: orderId }, preview: false })
          });
          if (!r.ok) return false; var j = await r.json(); return !!(j && j.output);
        } catch (e) { return false; }
      }
      document.getElementById('lm-goPay').onclick = function () {
        window.open(initPoint, '_blank', 'noopener'); var btn = this; btn.textContent = 'Verificando...';
        var iv = setInterval(async function () {
          try {
            if (await docReady()) {
              clearInterval(iv);
              location.href = '/success.html?o=' + encodeURIComponent(orderId) + '&slug=' + encodeURIComponent(slug) + '&s=success'; return;
            }
            var rr = await fetch('/.netlify/functions/order-status?o=' + encodeURIComponent(orderId));
            var jj = rr.ok ? await rr.json() : null;
            if (jj && jj.status === 'paid') {
              clearInterval(iv);
              location.href = '/success.html?o=' + encodeURIComponent(orderId) + '&slug=' + encodeURIComponent(slug) + '&s=success';
            }
          } catch (e) { }
        }, 3000);
      };
    }
  </script>

  <script>
    (function () {
      // Verifica se a URL tem ?modo=admin
      const params = new URLSearchParams(window.location.search);
      if (params.get('modo') === 'admin') {
        const btnPagar = document.querySelector('[id*="Pagar"], [id*="pagar"]') || document.getElementById('btnPagar');
        if (!btnPagar) return;

        const btnArea = btnPagar.parentElement;

        const btnAdmin = document.createElement('button');
        btnAdmin.className = 'btn';
        btnAdmin.style.backgroundColor = '#8b5cf6';
        btnAdmin.style.color = 'white';
        btnAdmin.style.border = 'none';
        btnAdmin.innerText = 'üëë Gerar Admin';

        btnAdmin.onclick = async function () {
          const senha = prompt("Digite a senha de Admin:");
          if (!senha) return;

          btnAdmin.innerText = 'Gerando...';
          btnAdmin.disabled = true;

          try {
            var p = getPayload();
            p.admin_key = senha;

            var r = await fetch('/.netlify/functions/generate-doc', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ payload: p, preview: false })
            });

            if (!r.ok) throw new Error('Senha errada ou erro no servidor');

            var data = await r.json();

            if (data.output) {
              let fullText = '';
              if (data.output.saudacao) fullText += data.output.saudacao + '\n\n';

              if (Array.isArray(data.output.corpo_paragrafos)) {
                fullText += data.output.corpo_paragrafos.join('\n\n');
              } else {
                fullText += String(data.output.corpo_paragrafos);
              }

              if (data.output.fechamento) fullText += '\n\n' + data.output.fechamento;

              const previewBox = document.getElementById('previewBox');
              const previewWrap = document.getElementById('previewWrap');

              if (previewBox && previewWrap) {
                previewBox.textContent = fullText;
                previewBox.style.whiteSpace = 'pre-wrap';
                previewWrap.style.display = 'block';

                const oldCopyBtn = document.getElementById('admin-copy-btn');
                if (oldCopyBtn) oldCopyBtn.remove();

                const copyBtn = document.createElement('button');
                copyBtn.id = 'admin-copy-btn';
                copyBtn.className = 'btn btn-primary';
                copyBtn.style.marginTop = '16px';
                copyBtn.innerText = 'üìã Copiar Documento';
                copyBtn.onclick = async function () {
                  await navigator.clipboard.writeText(fullText);
                  copyBtn.innerText = '‚úÖ Copiado!';
                  setTimeout(() => { copyBtn.innerText = 'üìã Copiar Documento'; }, 2000);
                };
                previewWrap.appendChild(copyBtn);

                previewWrap.scrollIntoView({ behavior: 'smooth', block: 'start' });

                alert("‚úÖ Documento Admin Gerado!\n\nRole para baixo para copiar.");
              } else {
                alert("‚úÖ Documento Gerado!\n\n" + fullText.substring(0, 500) + "...\n\n(Copie do console)");
                console.log(fullText);
              }
            }

          } catch (e) {
            alert('‚ùå Erro: ' + e.message);
          } finally {
            btnAdmin.innerText = 'üëë Gerar Admin';
            btnAdmin.disabled = false;
          }
        };

        btnArea.appendChild(btnAdmin);
      }
    })();
  </script>
</body>

</html>
